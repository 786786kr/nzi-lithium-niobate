
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="..">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.43">
    
    
      
        <title>Photonic Crystal - My Docs</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.0253249f.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#src.photonic_crystal" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="My Docs" class="md-header__button md-logo" aria-label="My Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            My Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Photonic Crystal
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="My Docs" class="md-nav__button md-logo" aria-label="My Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    My Docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    API Reference
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Photonic Crystal
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Photonic Crystal
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#src.photonic_crystal" class="md-nav__link">
    <span class="md-ellipsis">
      photonic_crystal
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.photonic_crystal.Crystal2D" class="md-nav__link">
    <span class="md-ellipsis">
      Crystal2D
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Crystal2D">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.Crystal2D.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.Crystal2D.advanced_material_geometry" class="md-nav__link">
    <span class="md-ellipsis">
      advanced_material_geometry
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.Crystal2D.basic_geometry" class="md-nav__link">
    <span class="md-ellipsis">
      basic_geometry
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.Crystal2D.basic_lattice" class="md-nav__link">
    <span class="md-ellipsis">
      basic_lattice
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.Crystal2D.ellipsoid_geometry" class="md-nav__link">
    <span class="md-ellipsis">
      ellipsoid_geometry
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.Crystal2D.plot_epsilon" class="md-nav__link">
    <span class="md-ellipsis">
      plot_epsilon
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.Crystal2D.plot_field" class="md-nav__link">
    <span class="md-ellipsis">
      plot_field
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.Crystal2D.square_lattice" class="md-nav__link">
    <span class="md-ellipsis">
      square_lattice
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.Crystal2D.triangular_lattice" class="md-nav__link">
    <span class="md-ellipsis">
      triangular_lattice
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.photonic_crystal.CrystalSlab" class="md-nav__link">
    <span class="md-ellipsis">
      CrystalSlab
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CrystalSlab">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.CrystalSlab.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.CrystalSlab.advanced_material_geometry" class="md-nav__link">
    <span class="md-ellipsis">
      advanced_material_geometry
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.CrystalSlab.basic_geometry" class="md-nav__link">
    <span class="md-ellipsis">
      basic_geometry
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.CrystalSlab.basic_lattice" class="md-nav__link">
    <span class="md-ellipsis">
      basic_lattice
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.CrystalSlab.ellipsoid_geometry" class="md-nav__link">
    <span class="md-ellipsis">
      ellipsoid_geometry
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.CrystalSlab.plot_epsilon" class="md-nav__link">
    <span class="md-ellipsis">
      plot_epsilon
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.CrystalSlab.plot_field" class="md-nav__link">
    <span class="md-ellipsis">
      plot_field
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.CrystalSlab.plot_field_components" class="md-nav__link">
    <span class="md-ellipsis">
      plot_field_components
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.CrystalSlab.square_lattice" class="md-nav__link">
    <span class="md-ellipsis">
      square_lattice
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.CrystalSlab.triangular_lattice" class="md-nav__link">
    <span class="md-ellipsis">
      triangular_lattice
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal" class="md-nav__link">
    <span class="md-ellipsis">
      PhotonicCrystal
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PhotonicCrystal">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.basic_geometry" class="md-nav__link">
    <span class="md-ellipsis">
      basic_geometry
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.basic_lattice" class="md-nav__link">
    <span class="md-ellipsis">
      basic_lattice
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.convert_mode_fields" class="md-nav__link">
    <span class="md-ellipsis">
      convert_mode_fields
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.extract_data" class="md-nav__link">
    <span class="md-ellipsis">
      extract_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.find_modes_symmetries" class="md-nav__link">
    <span class="md-ellipsis">
      find_modes_symmetries
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.get_XY_k_points_near_gamma" class="md-nav__link">
    <span class="md-ellipsis">
      get_XY_k_points_near_gamma
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.get_high_symmetry_points" class="md-nav__link">
    <span class="md-ellipsis">
      get_high_symmetry_points
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.load_photonic_crystal" class="md-nav__link">
    <span class="md-ellipsis">
      load_photonic_crystal
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.look_for_mode" class="md-nav__link">
    <span class="md-ellipsis">
      look_for_mode
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.pickle_photonic_crystal" class="md-nav__link">
    <span class="md-ellipsis">
      pickle_photonic_crystal
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.plot_bands" class="md-nav__link">
    <span class="md-ellipsis">
      plot_bands
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.plot_epsilon" class="md-nav__link">
    <span class="md-ellipsis">
      plot_epsilon
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.plot_mode_fields_normal_to_k" class="md-nav__link">
    <span class="md-ellipsis">
      plot_mode_fields_normal_to_k
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.plot_modes_vectorial_fields" class="md-nav__link">
    <span class="md-ellipsis">
      plot_modes_vectorial_fields
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.plot_vectorial_fields" class="md-nav__link">
    <span class="md-ellipsis">
      plot_vectorial_fields
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.run_dumb_simulation" class="md-nav__link">
    <span class="md-ellipsis">
      run_dumb_simulation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.run_simulation" class="md-nav__link">
    <span class="md-ellipsis">
      run_simulation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.set_solver" class="md-nav__link">
    <span class="md-ellipsis">
      set_solver
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.photonic_crystal.suppress_output" class="md-nav__link">
    <span class="md-ellipsis">
      suppress_output
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#src.photonic_crystal" class="md-nav__link">
    <span class="md-ellipsis">
      photonic_crystal
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.photonic_crystal.Crystal2D" class="md-nav__link">
    <span class="md-ellipsis">
      Crystal2D
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Crystal2D">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.Crystal2D.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.Crystal2D.advanced_material_geometry" class="md-nav__link">
    <span class="md-ellipsis">
      advanced_material_geometry
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.Crystal2D.basic_geometry" class="md-nav__link">
    <span class="md-ellipsis">
      basic_geometry
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.Crystal2D.basic_lattice" class="md-nav__link">
    <span class="md-ellipsis">
      basic_lattice
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.Crystal2D.ellipsoid_geometry" class="md-nav__link">
    <span class="md-ellipsis">
      ellipsoid_geometry
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.Crystal2D.plot_epsilon" class="md-nav__link">
    <span class="md-ellipsis">
      plot_epsilon
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.Crystal2D.plot_field" class="md-nav__link">
    <span class="md-ellipsis">
      plot_field
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.Crystal2D.square_lattice" class="md-nav__link">
    <span class="md-ellipsis">
      square_lattice
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.Crystal2D.triangular_lattice" class="md-nav__link">
    <span class="md-ellipsis">
      triangular_lattice
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.photonic_crystal.CrystalSlab" class="md-nav__link">
    <span class="md-ellipsis">
      CrystalSlab
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CrystalSlab">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.CrystalSlab.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.CrystalSlab.advanced_material_geometry" class="md-nav__link">
    <span class="md-ellipsis">
      advanced_material_geometry
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.CrystalSlab.basic_geometry" class="md-nav__link">
    <span class="md-ellipsis">
      basic_geometry
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.CrystalSlab.basic_lattice" class="md-nav__link">
    <span class="md-ellipsis">
      basic_lattice
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.CrystalSlab.ellipsoid_geometry" class="md-nav__link">
    <span class="md-ellipsis">
      ellipsoid_geometry
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.CrystalSlab.plot_epsilon" class="md-nav__link">
    <span class="md-ellipsis">
      plot_epsilon
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.CrystalSlab.plot_field" class="md-nav__link">
    <span class="md-ellipsis">
      plot_field
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.CrystalSlab.plot_field_components" class="md-nav__link">
    <span class="md-ellipsis">
      plot_field_components
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.CrystalSlab.square_lattice" class="md-nav__link">
    <span class="md-ellipsis">
      square_lattice
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.CrystalSlab.triangular_lattice" class="md-nav__link">
    <span class="md-ellipsis">
      triangular_lattice
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal" class="md-nav__link">
    <span class="md-ellipsis">
      PhotonicCrystal
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PhotonicCrystal">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.basic_geometry" class="md-nav__link">
    <span class="md-ellipsis">
      basic_geometry
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.basic_lattice" class="md-nav__link">
    <span class="md-ellipsis">
      basic_lattice
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.convert_mode_fields" class="md-nav__link">
    <span class="md-ellipsis">
      convert_mode_fields
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.extract_data" class="md-nav__link">
    <span class="md-ellipsis">
      extract_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.find_modes_symmetries" class="md-nav__link">
    <span class="md-ellipsis">
      find_modes_symmetries
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.get_XY_k_points_near_gamma" class="md-nav__link">
    <span class="md-ellipsis">
      get_XY_k_points_near_gamma
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.get_high_symmetry_points" class="md-nav__link">
    <span class="md-ellipsis">
      get_high_symmetry_points
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.load_photonic_crystal" class="md-nav__link">
    <span class="md-ellipsis">
      load_photonic_crystal
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.look_for_mode" class="md-nav__link">
    <span class="md-ellipsis">
      look_for_mode
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.pickle_photonic_crystal" class="md-nav__link">
    <span class="md-ellipsis">
      pickle_photonic_crystal
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.plot_bands" class="md-nav__link">
    <span class="md-ellipsis">
      plot_bands
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.plot_epsilon" class="md-nav__link">
    <span class="md-ellipsis">
      plot_epsilon
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.plot_mode_fields_normal_to_k" class="md-nav__link">
    <span class="md-ellipsis">
      plot_mode_fields_normal_to_k
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.plot_modes_vectorial_fields" class="md-nav__link">
    <span class="md-ellipsis">
      plot_modes_vectorial_fields
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.plot_vectorial_fields" class="md-nav__link">
    <span class="md-ellipsis">
      plot_vectorial_fields
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.run_dumb_simulation" class="md-nav__link">
    <span class="md-ellipsis">
      run_dumb_simulation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.run_simulation" class="md-nav__link">
    <span class="md-ellipsis">
      run_simulation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.set_solver" class="md-nav__link">
    <span class="md-ellipsis">
      set_solver
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.photonic_crystal.suppress_output" class="md-nav__link">
    <span class="md-ellipsis">
      suppress_output
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>Photonic Crystal</h1>

<div class="doc doc-object doc-module">



<a id="src.photonic_crystal"></a>
    <div class="doc doc-contents first">








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="src.photonic_crystal.Crystal2D" class="doc doc-heading">
            <code>Crystal2D</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="src.photonic_crystal.PhotonicCrystal" href="#src.photonic_crystal.PhotonicCrystal">PhotonicCrystal</a></code></p>


        <p>This class provides methods to define and simulate 2D photonic crystals with various lattice types and geometries. 
It allows for the calculation and visualization of dielectric distributions and electromagnetic fields within the crystal.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.photonic_crystal.Crystal2D.geometry_lattice">geometry_lattice</span></code></td>
            <td>
                  <code><span title="meep.Lattice">Lattice</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The lattice structure of the photonic crystal.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.photonic_crystal.Crystal2D.k_points">k_points</span></code></td>
            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of k-points for the simulation.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.photonic_crystal.Crystal2D.geometry">geometry</span></code></td>
            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of geometric objects defining the photonic crystal.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.photonic_crystal.Crystal2D.k_points_interpolated">k_points_interpolated</span></code></td>
            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Interpolated k-points for the simulation.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.photonic_crystal.Crystal2D.epsilon">epsilon</span></code></td>
            <td>
                  <code>ndarray</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dielectric distribution of the photonic crystal.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Methods:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="src.photonic_crystal.Crystal2D.__init__" href="#src.photonic_crystal.Crystal2D.__init__">__init__</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Initializes the Crystal2D object with the specified parameters.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="src.photonic_crystal.Crystal2D.plot_epsilon" href="#src.photonic_crystal.Crystal2D.plot_epsilon">plot_epsilon</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Plots the dielectric distribution interactively using Plotly.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="src.photonic_crystal.Crystal2D.plot_field" href="#src.photonic_crystal.Crystal2D.plot_field">plot_field</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Plots the electromagnetic field distribution interactively using Plotly.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="src.photonic_crystal.Crystal2D.basic_geometry" href="#src.photonic_crystal.Crystal2D.basic_geometry">basic_geometry</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Defines a basic geometry for the photonic crystal.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="src.photonic_crystal.Crystal2D.ellipsoid_geometry" href="#src.photonic_crystal.Crystal2D.ellipsoid_geometry">ellipsoid_geometry</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Defines an ellipsoid geometry for the photonic crystal.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="src.photonic_crystal.Crystal2D.advanced_material_geometry" href="#src.photonic_crystal.Crystal2D.advanced_material_geometry">advanced_material_geometry</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Defines an advanced material geometry for the photonic crystal.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="src.photonic_crystal.Crystal2D.basic_lattice" href="#src.photonic_crystal.Crystal2D.basic_lattice">basic_lattice</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Defines the basic lattice structure for the photonic crystal.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="src.photonic_crystal.Crystal2D.square_lattice" href="#src.photonic_crystal.Crystal2D.square_lattice">square_lattice</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Defines a square lattice for the photonic crystal.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="src.photonic_crystal.Crystal2D.triangular_lattice" href="#src.photonic_crystal.Crystal2D.triangular_lattice">triangular_lattice</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Defines a triangular lattice for the photonic crystal.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>src/photonic_crystal.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 865</span>
<span class="normal"> 866</span>
<span class="normal"> 867</span>
<span class="normal"> 868</span>
<span class="normal"> 869</span>
<span class="normal"> 870</span>
<span class="normal"> 871</span>
<span class="normal"> 872</span>
<span class="normal"> 873</span>
<span class="normal"> 874</span>
<span class="normal"> 875</span>
<span class="normal"> 876</span>
<span class="normal"> 877</span>
<span class="normal"> 878</span>
<span class="normal"> 879</span>
<span class="normal"> 880</span>
<span class="normal"> 881</span>
<span class="normal"> 882</span>
<span class="normal"> 883</span>
<span class="normal"> 884</span>
<span class="normal"> 885</span>
<span class="normal"> 886</span>
<span class="normal"> 887</span>
<span class="normal"> 888</span>
<span class="normal"> 889</span>
<span class="normal"> 890</span>
<span class="normal"> 891</span>
<span class="normal"> 892</span>
<span class="normal"> 893</span>
<span class="normal"> 894</span>
<span class="normal"> 895</span>
<span class="normal"> 896</span>
<span class="normal"> 897</span>
<span class="normal"> 898</span>
<span class="normal"> 899</span>
<span class="normal"> 900</span>
<span class="normal"> 901</span>
<span class="normal"> 902</span>
<span class="normal"> 903</span>
<span class="normal"> 904</span>
<span class="normal"> 905</span>
<span class="normal"> 906</span>
<span class="normal"> 907</span>
<span class="normal"> 908</span>
<span class="normal"> 909</span>
<span class="normal"> 910</span>
<span class="normal"> 911</span>
<span class="normal"> 912</span>
<span class="normal"> 913</span>
<span class="normal"> 914</span>
<span class="normal"> 915</span>
<span class="normal"> 916</span>
<span class="normal"> 917</span>
<span class="normal"> 918</span>
<span class="normal"> 919</span>
<span class="normal"> 920</span>
<span class="normal"> 921</span>
<span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Crystal2D</span><span class="p">(</span><span class="n">PhotonicCrystal</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class provides methods to define and simulate 2D photonic crystals with various lattice types and geometries. </span>
<span class="sd">    It allows for the calculation and visualization of dielectric distributions and electromagnetic fields within the crystal.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        geometry_lattice (mp.Lattice): The lattice structure of the photonic crystal.</span>
<span class="sd">        k_points (list): List of k-points for the simulation.</span>
<span class="sd">        geometry (list): List of geometric objects defining the photonic crystal.</span>
<span class="sd">        k_points_interpolated (list): Interpolated k-points for the simulation.</span>
<span class="sd">        epsilon (ndarray): Dielectric distribution of the photonic crystal.</span>

<span class="sd">    Methods:</span>
<span class="sd">        __init__(self, lattice_type=None, num_bands=6, resolution=(32, 32), interp=4, periods=3, pickle_id=None, geometry=None, use_XY=True, k_point_max=0.2):</span>
<span class="sd">            Initializes the Crystal2D object with the specified parameters.</span>
<span class="sd">        plot_epsilon(self, fig=None, title=&#39;Epsilon&#39;, **kwargs):</span>
<span class="sd">            Plots the dielectric distribution interactively using Plotly.</span>
<span class="sd">        plot_field(self, runner=&quot;run_tm&quot;, k_point=mp.Vector3(0, 0), periods=5, fig=None, title=&quot;Field Visualization&quot;, colorscale=&#39;RdBu&#39;):</span>
<span class="sd">            Plots the electromagnetic field distribution interactively using Plotly.</span>
<span class="sd">        basic_geometry(radius_1=0.2, eps_atom_1=1, radius_2=None, eps_atom_2=None, eps_bulk=12):</span>
<span class="sd">            Defines a basic geometry for the photonic crystal.</span>
<span class="sd">        ellipsoid_geometry(e1=0.2, e2=0.3, eps_atom=1, eps_bulk=12):</span>
<span class="sd">            Defines an ellipsoid geometry for the photonic crystal.</span>
<span class="sd">        advanced_material_geometry(radius_1=0.2, epsilon_diag=mp.Vector3(12, 12, 12), epsilon_offdiag=mp.Vector3(0, 0, 0), chi2_diag=mp.Vector3(0, 0, 0), chi3_diag=mp.Vector3(0, 0, 0), eps_atom_1=1):</span>
<span class="sd">            Defines an advanced material geometry for the photonic crystal.</span>
<span class="sd">        basic_lattice(lattice_type=&#39;square&#39;):</span>
<span class="sd">            Defines the basic lattice structure for the photonic crystal.</span>
<span class="sd">        square_lattice():</span>
<span class="sd">            Defines a square lattice for the photonic crystal.</span>
<span class="sd">        triangular_lattice():</span>
<span class="sd">            Defines a triangular lattice for the photonic crystal.</span>
<span class="sd">    &quot;&quot;&quot;</span>



    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                <span class="n">lattice_type</span> <span class="o">=</span> <span class="s2">&quot;square&quot;</span><span class="p">,</span>
                <span class="n">num_bands</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span>
                <span class="n">resolution</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">32</span><span class="p">,</span>
                <span class="n">interp</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                <span class="n">periods</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span><span class="mi">3</span><span class="p">,</span> 
                <span class="n">pickle_id</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">geometry</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">use_XY</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                <span class="n">k_point_max</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes the Crystal2D object with the specified parameters.</span>

<span class="sd">        Args:</span>
<span class="sd">            lattice_type (str): The type of lattice. Default is &#39;square&#39; other option is &#39;triangular&#39;. It determines the k-points if use_XY is False.</span>
<span class="sd">            num_bands (int): The number of bands to calculate. Default is 6.</span>
<span class="sd">            resolution (tuple[int, int] | int): The resolution of the simulation. Default is (32, 32).</span>
<span class="sd">            interp (int): The interpolation factor for k-points. Default is 4.</span>
<span class="sd">            periods (int): The number of periods to simulate. Default is 3.</span>
<span class="sd">            pickle_id (str): The ID for pickling the simulation. Default is None.</span>
<span class="sd">            geometry (list): The geometry of the photonic crystal. Default is None.</span>
<span class="sd">            use_XY (bool): Whether to use the X and Y directions for the x-axis or high symmetry points. Default is True.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">lattice_type</span><span class="p">,</span> <span class="n">num_bands</span><span class="p">,</span> <span class="n">resolution</span><span class="p">,</span> <span class="n">interp</span><span class="p">,</span> <span class="n">periods</span><span class="p">,</span> <span class="n">pickle_id</span><span class="p">,</span> <span class="n">use_XY</span><span class="o">=</span><span class="n">use_XY</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">geometry_lattice</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">basic_lattice</span><span class="p">(</span><span class="n">lattice_type</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">use_XY</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">k_points</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="n">k_point_max</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>      <span class="c1"># X</span>
                <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">),</span>       <span class="c1"># Gamma</span>
                <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">k_point_max</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>        <span class="c1"># Y</span>
            <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">geometry</span> <span class="o">=</span> <span class="n">geometry</span> <span class="k">if</span> <span class="n">geometry</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">basic_geometry</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k_points_interpolated</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">interp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_points</span><span class="p">)</span>



    <span class="k">def</span> <span class="nf">plot_epsilon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Epsilon&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">-&gt;</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the dielectric distribution interactively using Plotly.</span>

<span class="sd">        Args:</span>
<span class="sd">            fig (go.Figure, optional): The Plotly figure to add the epsilon plot to. Default is None.</span>
<span class="sd">            title (str, optional): The title of the plot. Default is &#39;Epsilon&#39;.</span>
<span class="sd">            **kwargs: Additional keyword arguments for Plotly.</span>

<span class="sd">        Returns:</span>
<span class="sd">            go.Figure: The Plotly figure object.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">with</span> <span class="n">suppress_output</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">md</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">MPBData</span><span class="p">(</span><span class="n">rectify</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">periods</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">resolution</span><span class="p">)</span>
                <span class="n">converted_eps</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_epsilon</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">converted_eps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span>
            <span class="k">if</span> <span class="n">fig</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>

            <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Heatmap</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">converted_eps</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">colorscale</span><span class="o">=</span><span class="s1">&#39;Viridis&#39;</span><span class="p">))</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
                <span class="n">title</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                    <span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">&lt;br&gt;Dielectric Distribution&quot;</span><span class="p">,</span>
                    <span class="n">x</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                    <span class="n">y</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span>
                    <span class="n">xanchor</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                    <span class="n">yanchor</span><span class="o">=</span><span class="s1">&#39;top&#39;</span>
                <span class="p">),</span>
                <span class="n">coloraxis_colorbar</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;$</span><span class="se">\\</span><span class="s1">epsilon $&#39;</span><span class="p">),</span>
                <span class="n">xaxis_showgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                <span class="n">yaxis_showgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">xaxis_zeroline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                <span class="n">yaxis_zeroline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">xaxis_visible</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                <span class="n">yaxis_visible</span><span class="o">=</span><span class="kc">False</span>
            <span class="p">)</span>       
        <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span> <span class="o">=</span> <span class="n">converted_eps</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">)</span>    
        <span class="k">return</span> <span class="n">fig</span>





    <span class="k">def</span> <span class="nf">plot_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                <span class="n">runner</span><span class="o">=</span><span class="s2">&quot;run_tm&quot;</span><span class="p">,</span> 
                <span class="n">k_point</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> 
                <span class="n">periods</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> 
                <span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Field Visualization&quot;</span><span class="p">,</span> 
                <span class="n">colorscale</span><span class="o">=</span><span class="s1">&#39;RdBu&#39;</span><span class="p">)</span><span class="o">-&gt;</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the electromagnetic field distribution interactively using Plotly.</span>

<span class="sd">        Args:</span>
<span class="sd">            runner (str): The runner for the simulation. Default is &#39;run_tm&#39;.</span>
<span class="sd">            k_point (mp.Vector3): The k-point for the simulation. Default is mp.Vector3(0, 0).</span>
<span class="sd">            periods (int): The number of periods to extract. Default is 5.</span>
<span class="sd">            fig (go.Figure): The Plotly figure to add the field plot to. Default is None.</span>
<span class="sd">            title (str): The title of the plot. Default is &#39;Field Visualization&#39;.</span>
<span class="sd">            colorscale (str): The colorscale for the heatmap. Default is &#39;RdBu&#39;.</span>

<span class="sd">        Returns:</span>
<span class="sd">            go.Figure: The Plotly figure object.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">raw_fields</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">freqs</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ms</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">ModeSolver</span><span class="p">(</span><span class="n">geometry</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">geometry</span><span class="p">,</span>
                                <span class="n">geometry_lattice</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">geometry_lattice</span><span class="p">,</span>
                                <span class="n">k_points</span><span class="o">=</span><span class="p">[</span><span class="n">k_point</span><span class="p">],</span>
                                <span class="n">resolution</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">resolution</span><span class="p">,</span>
                                <span class="n">num_bands</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_bands</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">get_zodd_fields</span><span class="p">(</span><span class="n">ms</span><span class="p">,</span> <span class="n">band</span><span class="p">):</span>
            <span class="n">raw_fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ms</span><span class="o">.</span><span class="n">get_hfield</span><span class="p">(</span><span class="n">band</span><span class="p">,</span> <span class="n">bloch_phase</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
        <span class="k">def</span> <span class="nf">get_zeven_fields</span><span class="p">(</span><span class="n">ms</span><span class="p">,</span> <span class="n">band</span><span class="p">):</span>
            <span class="n">raw_fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ms</span><span class="o">.</span><span class="n">get_efield</span><span class="p">(</span><span class="n">band</span><span class="p">,</span> <span class="n">bloch_phase</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
        <span class="k">def</span> <span class="nf">get_freqs</span><span class="p">(</span><span class="n">ms</span><span class="p">,</span> <span class="n">band</span><span class="p">):</span>
            <span class="n">freqs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ms</span><span class="o">.</span><span class="n">freqs</span><span class="p">[</span><span class="n">band</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>


        <span class="k">with</span> <span class="n">suppress_output</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">runner</span> <span class="o">==</span> <span class="s2">&quot;run_te&quot;</span> <span class="ow">or</span> <span class="n">runner</span> <span class="o">==</span> <span class="s2">&quot;run_zeven&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">run_te</span><span class="p">(</span><span class="n">mpb</span><span class="o">.</span><span class="n">output_at_kpoint</span><span class="p">(</span><span class="n">k_point</span><span class="p">,</span> <span class="n">mpb</span><span class="o">.</span><span class="n">fix_hfield_phase</span><span class="p">,</span> <span class="n">get_zodd_fields</span><span class="p">,</span> <span class="n">get_freqs</span><span class="p">))</span>
                <span class="n">field_type</span> <span class="o">=</span> <span class="s2">&quot;H-field&quot;</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;frequencies: </span><span class="si">{</span><span class="n">freqs</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">runner</span> <span class="o">==</span> <span class="s2">&quot;run_tm&quot;</span> <span class="ow">or</span> <span class="n">runner</span> <span class="o">==</span> <span class="s2">&quot;run_zodd&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">run_tm</span><span class="p">(</span><span class="n">mpb</span><span class="o">.</span><span class="n">output_at_kpoint</span><span class="p">(</span><span class="n">k_point</span><span class="p">,</span> <span class="n">mpb</span><span class="o">.</span><span class="n">fix_efield_phase</span><span class="p">,</span> <span class="n">get_zeven_fields</span><span class="p">,</span> <span class="n">get_freqs</span><span class="p">))</span>
                <span class="n">field_type</span> <span class="o">=</span> <span class="s2">&quot;E-field&quot;</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;frequencies: </span><span class="si">{</span><span class="n">freqs</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid runner. Please enter &#39;run_te&#39;, &#39;run_zeven&#39;, or &#39;run_tm&#39; or &#39;run_zodd&#39;.&quot;</span><span class="p">)</span>

            <span class="n">md</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">MPBData</span><span class="p">(</span><span class="n">rectify</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="n">periods</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">resolution</span><span class="p">)</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="p">[]</span>        
            <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">raw_fields</span><span class="p">:</span>
                <span class="n">field</span> <span class="o">=</span> <span class="n">field</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>  <span class="c1"># Get just the z component of the fields</span>

                <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">field</span><span class="p">))</span>



            <span class="n">eps</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_epsilon</span><span class="p">())</span>
        <span class="c1">#print(fields)</span>
        <span class="n">num_plots</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">num_plots</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No field data to plot.&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">fig</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>

        <span class="c1"># Automatically generate the subtitle with the k-vector and field type</span>
        <span class="n">subtitle</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field_type</span><span class="si">}</span><span class="s2">, z-component&lt;br&gt;k = (</span><span class="si">{</span><span class="n">k_point</span><span class="o">.</span><span class="n">x</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">k_point</span><span class="o">.</span><span class="n">y</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">)&quot;</span>

        <span class="c1"># Initialize an empty list for dropdown menu options</span>
        <span class="n">dropdown_buttons</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Calculate the midpoint between min and max of the permittivity (eps)</span>
        <span class="n">min_eps</span><span class="p">,</span> <span class="n">max_eps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">eps</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">eps</span><span class="p">)</span>
        <span class="n">midpoint</span> <span class="o">=</span> <span class="p">(</span><span class="n">min_eps</span> <span class="o">+</span> <span class="n">max_eps</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>  <span class="c1"># The level to be plotted</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">freq</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">fields</span><span class="p">,</span> <span class="n">freqs</span><span class="p">)):</span>
            <span class="n">visible_status</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">num_plots</span><span class="p">)</span>
            <span class="n">visible_status</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Make the current contour (eps) visible</span>
            <span class="n">visible_status</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Make the current heatmap (field) visible</span>

            <span class="c1"># Add the contour plot for permittivity (eps) at the midpoint</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Contour</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">eps</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
                                    <span class="n">contours</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                                        <span class="n">start</span><span class="o">=</span><span class="n">midpoint</span><span class="p">,</span>  <span class="c1"># Start and end at the midpoint to ensure a single level</span>
                                        <span class="n">end</span><span class="o">=</span><span class="n">midpoint</span><span class="p">,</span>
                                        <span class="n">size</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>  <span class="c1"># A small size to keep it as a single contour</span>
                                        <span class="n">coloring</span><span class="o">=</span><span class="s1">&#39;none&#39;</span>  <span class="c1"># No filling</span>
                                    <span class="p">),</span>
                                    <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>
                                    <span class="n">showscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                    <span class="n">opacity</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
                                    <span class="n">visible</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">False</span><span class="p">))</span>  <span class="c1"># Initially visible only for the first plot</span>

            <span class="c1"># Add the heatmap for the real part of the electric field</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Heatmap</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">field</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscale</span><span class="p">,</span> <span class="n">zsmooth</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span>
                                    <span class="n">showscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">False</span><span class="p">))</span>

            <span class="c1"># Create a button for each field dataset for the dropdown</span>
            <span class="n">dropdown_buttons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mode </span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                                        <span class="n">method</span><span class="o">=</span><span class="s1">&#39;update&#39;</span><span class="p">,</span>
                                        <span class="n">args</span><span class="o">=</span><span class="p">[{</span><span class="s1">&#39;visible&#39;</span><span class="p">:</span> <span class="n">visible_status</span><span class="p">},</span>  <span class="c1"># Update visibility for both eps and field</span>
                                            <span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">&lt;br&gt;Mode </span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">, freq=</span><span class="si">{</span><span class="n">freq</span><span class="si">:</span><span class="s2">0.3f</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">subtitle</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}</span>
                                        <span class="p">]))</span>
            <span class="n">mode</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;k_point&quot;</span> <span class="p">:</span> <span class="n">k_point</span><span class="p">,</span>
                <span class="s2">&quot;frequency&quot;</span> <span class="p">:</span> <span class="n">freq</span><span class="p">,</span>
                <span class="s2">&quot;field&quot;</span> <span class="p">:</span> <span class="n">field</span><span class="p">,</span>
                <span class="s2">&quot;field_type&quot;</span> <span class="p">:</span> <span class="n">field_type</span><span class="p">,</span>
            <span class="p">}</span>



        <span class="c1"># Add the dropdown menu to the layout</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
            <span class="n">updatemenus</span><span class="o">=</span><span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="n">active</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>  <span class="c1"># The first dataset is active by default</span>
                            <span class="n">buttons</span><span class="o">=</span><span class="n">dropdown_buttons</span><span class="p">,</span>
                            <span class="n">x</span><span class="o">=</span><span class="mf">1.15</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.15</span><span class="p">,</span>  <span class="c1"># Positioning the dropdown to the top right</span>
                            <span class="n">xanchor</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">yanchor</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)],</span>
            <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">&lt;br&gt;Mode </span><span class="si">{</span><span class="mi">1</span><span class="si">}</span><span class="s2">, freq=</span><span class="si">{</span><span class="n">freqs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">0.3f</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">subtitle</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>  <span class="c1"># Main title + subtitle</span>
            <span class="n">xaxis_showgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">yaxis_showgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">xaxis_zeroline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">yaxis_zeroline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">xaxis_visible</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">yaxis_visible</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">hovermode</span><span class="o">=</span><span class="s2">&quot;closest&quot;</span><span class="p">,</span>
            <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">800</span>
        <span class="p">)</span>


        <span class="c1"># Display the plot</span>
        <span class="k">return</span> <span class="n">fig</span>




    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">basic_lattice</span><span class="p">(</span><span class="n">lattice_type</span><span class="o">=</span><span class="s1">&#39;square&#39;</span><span class="p">)</span><span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">mp</span><span class="o">.</span><span class="n">Lattice</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Define the basic lattice of the photonic crystal.</span>

<span class="sd">        Args:</span>
<span class="sd">            lattice_type (str): The type of lattice. Default is &#39;square&#39;.</span>

<span class="sd">        Returns:</span>
<span class="sd">            tuple: A tuple containing the lattice object representing the lattice and a list of k-points for the simulation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">lattice_type</span> <span class="o">==</span> <span class="s1">&#39;square&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Crystal2D</span><span class="o">.</span><span class="n">square_lattice</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">lattice_type</span> <span class="o">==</span> <span class="s1">&#39;triangular&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Crystal2D</span><span class="o">.</span><span class="n">triangular_lattice</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid lattice type. Choose &#39;square&#39; or &#39;triangular&#39;.&quot;</span><span class="p">)</span>



    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">square_lattice</span><span class="p">()</span><span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">mp</span><span class="o">.</span><span class="n">Lattice</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Define the square lattice for the photonic crystal.</span>

<span class="sd">        Returns:</span>
<span class="sd">            tuple: A tuple containing the lattice object representing the square lattice and a list of k-points for the simulation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">lattice</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Lattice</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                          <span class="n">basis1</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                          <span class="n">basis2</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">k_points</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(),</span>               <span class="c1"># Gamma</span>
            <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mf">0.5</span><span class="p">),</span>          <span class="c1"># M</span>
            <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>       <span class="c1"># X</span>
            <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(),</span>               <span class="c1"># Gamma</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="n">lattice</span><span class="p">,</span> <span class="n">k_points</span>


    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">triangular_lattice</span><span class="p">()</span><span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">mp</span><span class="o">.</span><span class="n">Lattice</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Define the triangular lattice for the photonic crystal.</span>

<span class="sd">        Returns:</span>
<span class="sd">            tuple: A tuple containing the lattice object representing the triangular lattice and a list of k-points for the simulation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">lattice</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Lattice</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                          <span class="n">basis1</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                          <span class="n">basis2</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">k_points</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(),</span>               <span class="c1"># Gamma</span>
            <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mf">0.5</span><span class="p">),</span>          <span class="c1"># K</span>
            <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="o">-</span><span class="mf">1.</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span> <span class="mf">1.</span><span class="o">/</span><span class="mi">3</span><span class="p">),</span>    <span class="c1"># M</span>
            <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(),</span>               <span class="c1"># Gamma</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="n">lattice</span><span class="p">,</span> <span class="n">k_points</span>


    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">basic_geometry</span><span class="p">(</span><span class="n">radius_1</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> 
                       <span class="n">eps_atom_1</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> 
                       <span class="n">radius_2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                       <span class="n">eps_atom_2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">eps_bulk</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span> 
                       <span class="p">)</span><span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span> 
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Define a basic geometry for the photonic crystal.</span>
<span class="sd">        So far only one atom has been tested. It uses cylinders to define the geometry.</span>

<span class="sd">        Args:</span>
<span class="sd">            radius_1 (float): The radius of the first atom. Default is 0.2.</span>
<span class="sd">            eps_atom_1 (float): The dielectric constant of the first atom. Default is 1.</span>
<span class="sd">            radius_2 (float, optional): The radius of the second atom. Default is None.</span>
<span class="sd">            eps_atom_2 (float, optional): The dielectric constant of the second atom. Default is None.</span>
<span class="sd">            eps_bulk (float): The dielectric constant of the bulk. Default is 12.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: A list of geometric objects defining the photonic crystal.</span>


<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">geometry</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">mp</span><span class="o">.</span><span class="n">Block</span><span class="p">(</span>
                <span class="n">size</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="n">mp</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">mp</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span>
                <span class="n">material</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Medium</span><span class="p">(</span><span class="n">epsilon</span><span class="o">=</span><span class="n">eps_bulk</span><span class="p">)),</span>
            <span class="p">]</span>
        <span class="k">if</span> <span class="n">radius_2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">geometry</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mp</span><span class="o">.</span><span class="n">Cylinder</span><span class="p">(</span><span class="n">radius_1</span><span class="p">,</span> 
                                        <span class="n">material</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Medium</span><span class="p">(</span><span class="n">epsilon</span><span class="o">=</span><span class="n">eps_atom_1</span><span class="p">),</span>
                                        <span class="n">center</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">geometry</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mp</span><span class="o">.</span><span class="n">Cylinder</span><span class="p">(</span><span class="n">radius_1</span><span class="p">,</span> 
                                        <span class="n">material</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Medium</span><span class="p">(</span><span class="n">epsilon</span><span class="o">=</span><span class="n">eps_atom_1</span><span class="p">),</span>
                                        <span class="n">center</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)))</span>
            <span class="n">geometry</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mp</span><span class="o">.</span><span class="n">Cylinder</span><span class="p">(</span><span class="n">radius_2</span><span class="p">,</span> 
                                        <span class="n">material</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Medium</span><span class="p">(</span><span class="n">epsilon</span><span class="o">=</span><span class="n">eps_atom_2</span><span class="p">),</span>
                                        <span class="n">center</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mf">.5</span><span class="p">,</span><span class="mf">.5</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">geometry</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">ellipsoid_geometry</span><span class="p">(</span><span class="n">e1</span><span class="p">:</span> <span class="nb">float</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> 
                           <span class="n">e2</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span>
                           <span class="n">eps_atom</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> 
                           <span class="n">eps_bulk</span><span class="p">:</span> <span class="nb">float</span><span class="o">=</span> <span class="mi">12</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">update</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Define an ellipsoid geometry for the photonic crystal.</span>

<span class="sd">        Args:</span>
<span class="sd">            e1 (float): The first radius of the ellipsoid. Default is 0.2.</span>
<span class="sd">            e2 (float): The second radius of the ellipsoid. Default is 0.3.</span>
<span class="sd">            eps_atom (float): The dielectric constant of the atom. Default is 1.</span>
<span class="sd">            eps_bulk (float): The dielectric constant of the bulk. Default is 12.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: A list of geometric objects defining the photonic crystal.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">geometry</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">mp</span><span class="o">.</span><span class="n">Block</span><span class="p">(</span>
                <span class="n">size</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="n">mp</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">mp</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span>
                <span class="n">material</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Medium</span><span class="p">(</span><span class="n">epsilon</span><span class="o">=</span><span class="n">eps_bulk</span><span class="p">)),</span>
            <span class="p">]</span>   

        <span class="n">size</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="n">e1</span><span class="p">,</span><span class="n">e2</span><span class="p">,</span> <span class="n">mp</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
        <span class="n">geometry</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mp</span><span class="o">.</span><span class="n">Ellipsoid</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span>
                                     <span class="n">material</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Medium</span><span class="p">(</span><span class="n">epsilon</span><span class="o">=</span><span class="n">eps_atom</span><span class="p">),</span>
                                     <span class="n">center</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">geometry</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">advanced_material_geometry</span><span class="p">(</span>
        <span class="n">radius_1</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span>
        <span class="n">epsilon_diag</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span>
        <span class="n">epsilon_offdiag</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="n">chi2_diag</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>

        <span class="n">chi3_diag</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>

        <span class="n">eps_atom_1</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="p">)</span><span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Define an advanced material geometry for the photonic crystal.</span>

<span class="sd">        Args:</span>
<span class="sd">            radius_1 (float): The radius of the atom. Default is 0.2.</span>
<span class="sd">            epsilon_diag (mp.Vector3): The diagonal components of the dielectric tensor. Default is (12, 12, 12).</span>
<span class="sd">            epsilon_offdiag (mp.Vector3): The off-diagonal components of the dielectric tensor. Default is (0, 0, 0).</span>
<span class="sd">            chi2_diag (mp.Vector3): The diagonal components of the second-order nonlinear susceptibility tensor. Default is (0, 0, 0).</span>
<span class="sd">            chi3_diag (mp.Vector3): The diagonal components of the third-order nonlinear susceptibility tensor. Default is (0, 0, 0).</span>
<span class="sd">            eps_atom_1 (float): The dielectric constant of the atom. Default is 1.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: A list of geometric objects defining the photonic crystal.</span>
<span class="sd">        &quot;&quot;&quot;</span>


        <span class="n">geometry</span> <span class="o">=</span><span class="p">[</span>
            <span class="n">mp</span><span class="o">.</span><span class="n">Block</span><span class="p">(</span>
                <span class="n">size</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="n">mp</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">mp</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span>
                <span class="n">material</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Medium</span><span class="p">(</span>
                    <span class="n">epsilon_diag</span><span class="o">=</span><span class="n">epsilon_diag</span><span class="p">,</span>
                    <span class="n">epsilon_offdiag</span> <span class="o">=</span> <span class="n">epsilon_offdiag</span><span class="p">,</span> 
                    <span class="n">E_chi2_diag</span> <span class="o">=</span> <span class="n">chi2_diag</span><span class="p">,</span> 
                    <span class="n">E_chi3_diag</span> <span class="o">=</span> <span class="n">chi3_diag</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="p">]</span>

        <span class="n">geometry</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mp</span><span class="o">.</span><span class="n">Cylinder</span><span class="p">(</span><span class="n">radius_1</span><span class="p">,</span> 
                                        <span class="n">material</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Medium</span><span class="p">(</span><span class="n">epsilon</span><span class="o">=</span><span class="n">eps_atom_1</span><span class="p">),</span>
                                        <span class="n">center</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">geometry</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="src.photonic_crystal.Crystal2D.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">lattice_type</span><span class="o">=</span><span class="s1">&#39;square&#39;</span><span class="p">,</span> <span class="n">num_bands</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">interp</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">pickle_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">use_XY</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">k_point_max</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Initializes the Crystal2D object with the specified parameters.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>lattice_type</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The type of lattice. Default is 'square' other option is 'triangular'. It determines the k-points if use_XY is False.</p>
              </div>
            </td>
            <td>
                  <code>&#39;square&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_bands</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of bands to calculate. Default is 6.</p>
              </div>
            </td>
            <td>
                  <code>6</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>resolution</code>
            </td>
            <td>
                  <code>tuple[int, int] | int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The resolution of the simulation. Default is (32, 32).</p>
              </div>
            </td>
            <td>
                  <code>32</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>interp</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The interpolation factor for k-points. Default is 4.</p>
              </div>
            </td>
            <td>
                  <code>4</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>periods</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of periods to simulate. Default is 3.</p>
              </div>
            </td>
            <td>
                  <code>3</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pickle_id</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The ID for pickling the simulation. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>geometry</code>
            </td>
            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The geometry of the photonic crystal. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>use_XY</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to use the X and Y directions for the x-axis or high symmetry points. Default is True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/photonic_crystal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">lattice_type</span> <span class="o">=</span> <span class="s2">&quot;square&quot;</span><span class="p">,</span>
            <span class="n">num_bands</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span>
            <span class="n">resolution</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">32</span><span class="p">,</span>
            <span class="n">interp</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span><span class="mi">4</span><span class="p">,</span>
            <span class="n">periods</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span><span class="mi">3</span><span class="p">,</span> 
            <span class="n">pickle_id</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">geometry</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">use_XY</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="n">k_point_max</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initializes the Crystal2D object with the specified parameters.</span>

<span class="sd">    Args:</span>
<span class="sd">        lattice_type (str): The type of lattice. Default is &#39;square&#39; other option is &#39;triangular&#39;. It determines the k-points if use_XY is False.</span>
<span class="sd">        num_bands (int): The number of bands to calculate. Default is 6.</span>
<span class="sd">        resolution (tuple[int, int] | int): The resolution of the simulation. Default is (32, 32).</span>
<span class="sd">        interp (int): The interpolation factor for k-points. Default is 4.</span>
<span class="sd">        periods (int): The number of periods to simulate. Default is 3.</span>
<span class="sd">        pickle_id (str): The ID for pickling the simulation. Default is None.</span>
<span class="sd">        geometry (list): The geometry of the photonic crystal. Default is None.</span>
<span class="sd">        use_XY (bool): Whether to use the X and Y directions for the x-axis or high symmetry points. Default is True.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">lattice_type</span><span class="p">,</span> <span class="n">num_bands</span><span class="p">,</span> <span class="n">resolution</span><span class="p">,</span> <span class="n">interp</span><span class="p">,</span> <span class="n">periods</span><span class="p">,</span> <span class="n">pickle_id</span><span class="p">,</span> <span class="n">use_XY</span><span class="o">=</span><span class="n">use_XY</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">geometry_lattice</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">basic_lattice</span><span class="p">(</span><span class="n">lattice_type</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">use_XY</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k_points</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="n">k_point_max</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>      <span class="c1"># X</span>
            <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">),</span>       <span class="c1"># Gamma</span>
            <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">k_point_max</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>        <span class="c1"># Y</span>
        <span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">geometry</span> <span class="o">=</span> <span class="n">geometry</span> <span class="k">if</span> <span class="n">geometry</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">basic_geometry</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">k_points_interpolated</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">interp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_points</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.photonic_crystal.Crystal2D.advanced_material_geometry" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">advanced_material_geometry</span><span class="p">(</span><span class="n">radius_1</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">epsilon_diag</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span> <span class="n">epsilon_offdiag</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">chi2_diag</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">chi3_diag</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">eps_atom_1</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Define an advanced material geometry for the photonic crystal.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>radius_1</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The radius of the atom. Default is 0.2.</p>
              </div>
            </td>
            <td>
                  <code>0.2</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>epsilon_diag</code>
            </td>
            <td>
                  <code><span title="meep.Vector3">Vector3</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The diagonal components of the dielectric tensor. Default is (12, 12, 12).</p>
              </div>
            </td>
            <td>
                  <code><span title="meep.Vector3">Vector3</span>(12, 12, 12)</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>epsilon_offdiag</code>
            </td>
            <td>
                  <code><span title="meep.Vector3">Vector3</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The off-diagonal components of the dielectric tensor. Default is (0, 0, 0).</p>
              </div>
            </td>
            <td>
                  <code><span title="meep.Vector3">Vector3</span>(0, 0, 0)</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>chi2_diag</code>
            </td>
            <td>
                  <code><span title="meep.Vector3">Vector3</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The diagonal components of the second-order nonlinear susceptibility tensor. Default is (0, 0, 0).</p>
              </div>
            </td>
            <td>
                  <code><span title="meep.Vector3">Vector3</span>(0, 0, 0)</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>chi3_diag</code>
            </td>
            <td>
                  <code><span title="meep.Vector3">Vector3</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The diagonal components of the third-order nonlinear susceptibility tensor. Default is (0, 0, 0).</p>
              </div>
            </td>
            <td>
                  <code><span title="meep.Vector3">Vector3</span>(0, 0, 0)</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>eps_atom_1</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The dielectric constant of the atom. Default is 1.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>list</code></td>            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of geometric objects defining the photonic crystal.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/photonic_crystal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">advanced_material_geometry</span><span class="p">(</span>
    <span class="n">radius_1</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span>
    <span class="n">epsilon_diag</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span>
    <span class="n">epsilon_offdiag</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">chi2_diag</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>

    <span class="n">chi3_diag</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>

    <span class="n">eps_atom_1</span> <span class="o">=</span> <span class="mi">1</span>
<span class="p">)</span><span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Define an advanced material geometry for the photonic crystal.</span>

<span class="sd">    Args:</span>
<span class="sd">        radius_1 (float): The radius of the atom. Default is 0.2.</span>
<span class="sd">        epsilon_diag (mp.Vector3): The diagonal components of the dielectric tensor. Default is (12, 12, 12).</span>
<span class="sd">        epsilon_offdiag (mp.Vector3): The off-diagonal components of the dielectric tensor. Default is (0, 0, 0).</span>
<span class="sd">        chi2_diag (mp.Vector3): The diagonal components of the second-order nonlinear susceptibility tensor. Default is (0, 0, 0).</span>
<span class="sd">        chi3_diag (mp.Vector3): The diagonal components of the third-order nonlinear susceptibility tensor. Default is (0, 0, 0).</span>
<span class="sd">        eps_atom_1 (float): The dielectric constant of the atom. Default is 1.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: A list of geometric objects defining the photonic crystal.</span>
<span class="sd">    &quot;&quot;&quot;</span>


    <span class="n">geometry</span> <span class="o">=</span><span class="p">[</span>
        <span class="n">mp</span><span class="o">.</span><span class="n">Block</span><span class="p">(</span>
            <span class="n">size</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="n">mp</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">mp</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span>
            <span class="n">material</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Medium</span><span class="p">(</span>
                <span class="n">epsilon_diag</span><span class="o">=</span><span class="n">epsilon_diag</span><span class="p">,</span>
                <span class="n">epsilon_offdiag</span> <span class="o">=</span> <span class="n">epsilon_offdiag</span><span class="p">,</span> 
                <span class="n">E_chi2_diag</span> <span class="o">=</span> <span class="n">chi2_diag</span><span class="p">,</span> 
                <span class="n">E_chi3_diag</span> <span class="o">=</span> <span class="n">chi3_diag</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="p">]</span>

    <span class="n">geometry</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mp</span><span class="o">.</span><span class="n">Cylinder</span><span class="p">(</span><span class="n">radius_1</span><span class="p">,</span> 
                                    <span class="n">material</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Medium</span><span class="p">(</span><span class="n">epsilon</span><span class="o">=</span><span class="n">eps_atom_1</span><span class="p">),</span>
                                    <span class="n">center</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">geometry</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.photonic_crystal.Crystal2D.basic_geometry" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">basic_geometry</span><span class="p">(</span><span class="n">radius_1</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">eps_atom_1</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">radius_2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">eps_atom_2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">eps_bulk</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Define a basic geometry for the photonic crystal.
So far only one atom has been tested. It uses cylinders to define the geometry.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>radius_1</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The radius of the first atom. Default is 0.2.</p>
              </div>
            </td>
            <td>
                  <code>0.2</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>eps_atom_1</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The dielectric constant of the first atom. Default is 1.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>radius_2</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The radius of the second atom. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>eps_atom_2</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The dielectric constant of the second atom. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>eps_bulk</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The dielectric constant of the bulk. Default is 12.</p>
              </div>
            </td>
            <td>
                  <code>12</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>list</code></td>            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of geometric objects defining the photonic crystal.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/photonic_crystal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">basic_geometry</span><span class="p">(</span><span class="n">radius_1</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> 
                   <span class="n">eps_atom_1</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> 
                   <span class="n">radius_2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                   <span class="n">eps_atom_2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">eps_bulk</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span> 
                   <span class="p">)</span><span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span> 
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Define a basic geometry for the photonic crystal.</span>
<span class="sd">    So far only one atom has been tested. It uses cylinders to define the geometry.</span>

<span class="sd">    Args:</span>
<span class="sd">        radius_1 (float): The radius of the first atom. Default is 0.2.</span>
<span class="sd">        eps_atom_1 (float): The dielectric constant of the first atom. Default is 1.</span>
<span class="sd">        radius_2 (float, optional): The radius of the second atom. Default is None.</span>
<span class="sd">        eps_atom_2 (float, optional): The dielectric constant of the second atom. Default is None.</span>
<span class="sd">        eps_bulk (float): The dielectric constant of the bulk. Default is 12.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: A list of geometric objects defining the photonic crystal.</span>


<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">geometry</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">mp</span><span class="o">.</span><span class="n">Block</span><span class="p">(</span>
            <span class="n">size</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="n">mp</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">mp</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span>
            <span class="n">material</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Medium</span><span class="p">(</span><span class="n">epsilon</span><span class="o">=</span><span class="n">eps_bulk</span><span class="p">)),</span>
        <span class="p">]</span>
    <span class="k">if</span> <span class="n">radius_2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">geometry</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mp</span><span class="o">.</span><span class="n">Cylinder</span><span class="p">(</span><span class="n">radius_1</span><span class="p">,</span> 
                                    <span class="n">material</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Medium</span><span class="p">(</span><span class="n">epsilon</span><span class="o">=</span><span class="n">eps_atom_1</span><span class="p">),</span>
                                    <span class="n">center</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">geometry</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mp</span><span class="o">.</span><span class="n">Cylinder</span><span class="p">(</span><span class="n">radius_1</span><span class="p">,</span> 
                                    <span class="n">material</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Medium</span><span class="p">(</span><span class="n">epsilon</span><span class="o">=</span><span class="n">eps_atom_1</span><span class="p">),</span>
                                    <span class="n">center</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)))</span>
        <span class="n">geometry</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mp</span><span class="o">.</span><span class="n">Cylinder</span><span class="p">(</span><span class="n">radius_2</span><span class="p">,</span> 
                                    <span class="n">material</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Medium</span><span class="p">(</span><span class="n">epsilon</span><span class="o">=</span><span class="n">eps_atom_2</span><span class="p">),</span>
                                    <span class="n">center</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mf">.5</span><span class="p">,</span><span class="mf">.5</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">geometry</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.photonic_crystal.Crystal2D.basic_lattice" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">basic_lattice</span><span class="p">(</span><span class="n">lattice_type</span><span class="o">=</span><span class="s1">&#39;square&#39;</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Define the basic lattice of the photonic crystal.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>lattice_type</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The type of lattice. Default is 'square'.</p>
              </div>
            </td>
            <td>
                  <code>&#39;square&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>tuple</code></td>            <td>
                  <code>tuple[<span title="meep.Lattice">Lattice</span>, list[<span title="meep.Vector3">Vector3</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tuple containing the lattice object representing the lattice and a list of k-points for the simulation.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/photonic_crystal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">basic_lattice</span><span class="p">(</span><span class="n">lattice_type</span><span class="o">=</span><span class="s1">&#39;square&#39;</span><span class="p">)</span><span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">mp</span><span class="o">.</span><span class="n">Lattice</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Define the basic lattice of the photonic crystal.</span>

<span class="sd">    Args:</span>
<span class="sd">        lattice_type (str): The type of lattice. Default is &#39;square&#39;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: A tuple containing the lattice object representing the lattice and a list of k-points for the simulation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">lattice_type</span> <span class="o">==</span> <span class="s1">&#39;square&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Crystal2D</span><span class="o">.</span><span class="n">square_lattice</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">lattice_type</span> <span class="o">==</span> <span class="s1">&#39;triangular&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Crystal2D</span><span class="o">.</span><span class="n">triangular_lattice</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid lattice type. Choose &#39;square&#39; or &#39;triangular&#39;.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.photonic_crystal.Crystal2D.ellipsoid_geometry" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ellipsoid_geometry</span><span class="p">(</span><span class="n">e1</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">e2</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">eps_atom</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">eps_bulk</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Define an ellipsoid geometry for the photonic crystal.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>e1</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The first radius of the ellipsoid. Default is 0.2.</p>
              </div>
            </td>
            <td>
                  <code>0.2</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>e2</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The second radius of the ellipsoid. Default is 0.3.</p>
              </div>
            </td>
            <td>
                  <code>0.3</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>eps_atom</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The dielectric constant of the atom. Default is 1.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>eps_bulk</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The dielectric constant of the bulk. Default is 12.</p>
              </div>
            </td>
            <td>
                  <code>12</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>list</code></td>            <td>
                  <code>update</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of geometric objects defining the photonic crystal.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/photonic_crystal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">ellipsoid_geometry</span><span class="p">(</span><span class="n">e1</span><span class="p">:</span> <span class="nb">float</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> 
                       <span class="n">e2</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span>
                       <span class="n">eps_atom</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> 
                       <span class="n">eps_bulk</span><span class="p">:</span> <span class="nb">float</span><span class="o">=</span> <span class="mi">12</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">update</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Define an ellipsoid geometry for the photonic crystal.</span>

<span class="sd">    Args:</span>
<span class="sd">        e1 (float): The first radius of the ellipsoid. Default is 0.2.</span>
<span class="sd">        e2 (float): The second radius of the ellipsoid. Default is 0.3.</span>
<span class="sd">        eps_atom (float): The dielectric constant of the atom. Default is 1.</span>
<span class="sd">        eps_bulk (float): The dielectric constant of the bulk. Default is 12.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: A list of geometric objects defining the photonic crystal.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">geometry</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">mp</span><span class="o">.</span><span class="n">Block</span><span class="p">(</span>
            <span class="n">size</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="n">mp</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">mp</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span>
            <span class="n">material</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Medium</span><span class="p">(</span><span class="n">epsilon</span><span class="o">=</span><span class="n">eps_bulk</span><span class="p">)),</span>
        <span class="p">]</span>   

    <span class="n">size</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="n">e1</span><span class="p">,</span><span class="n">e2</span><span class="p">,</span> <span class="n">mp</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
    <span class="n">geometry</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mp</span><span class="o">.</span><span class="n">Ellipsoid</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span>
                                 <span class="n">material</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Medium</span><span class="p">(</span><span class="n">epsilon</span><span class="o">=</span><span class="n">eps_atom</span><span class="p">),</span>
                                 <span class="n">center</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">geometry</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.photonic_crystal.Crystal2D.plot_epsilon" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_epsilon</span><span class="p">(</span><span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Epsilon&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Plot the dielectric distribution interactively using Plotly.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>fig</code>
            </td>
            <td>
                  <code><span title="plotly.graph_objects.Figure">Figure</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The Plotly figure to add the epsilon plot to. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>title</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The title of the plot. Default is 'Epsilon'.</p>
              </div>
            </td>
            <td>
                  <code>&#39;Epsilon&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional keyword arguments for Plotly.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="plotly.graph_objects.Figure">Figure</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>go.Figure: The Plotly figure object.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/photonic_crystal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">939</span>
<span class="normal">940</span>
<span class="normal">941</span>
<span class="normal">942</span>
<span class="normal">943</span>
<span class="normal">944</span>
<span class="normal">945</span>
<span class="normal">946</span>
<span class="normal">947</span>
<span class="normal">948</span>
<span class="normal">949</span>
<span class="normal">950</span>
<span class="normal">951</span>
<span class="normal">952</span>
<span class="normal">953</span>
<span class="normal">954</span>
<span class="normal">955</span>
<span class="normal">956</span>
<span class="normal">957</span>
<span class="normal">958</span>
<span class="normal">959</span>
<span class="normal">960</span>
<span class="normal">961</span>
<span class="normal">962</span>
<span class="normal">963</span>
<span class="normal">964</span>
<span class="normal">965</span>
<span class="normal">966</span>
<span class="normal">967</span>
<span class="normal">968</span>
<span class="normal">969</span>
<span class="normal">970</span>
<span class="normal">971</span>
<span class="normal">972</span>
<span class="normal">973</span>
<span class="normal">974</span>
<span class="normal">975</span>
<span class="normal">976</span>
<span class="normal">977</span>
<span class="normal">978</span>
<span class="normal">979</span>
<span class="normal">980</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">plot_epsilon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Epsilon&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">-&gt;</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the dielectric distribution interactively using Plotly.</span>

<span class="sd">    Args:</span>
<span class="sd">        fig (go.Figure, optional): The Plotly figure to add the epsilon plot to. Default is None.</span>
<span class="sd">        title (str, optional): The title of the plot. Default is &#39;Epsilon&#39;.</span>
<span class="sd">        **kwargs: Additional keyword arguments for Plotly.</span>

<span class="sd">    Returns:</span>
<span class="sd">        go.Figure: The Plotly figure object.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">with</span> <span class="n">suppress_output</span><span class="p">():</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">md</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">MPBData</span><span class="p">(</span><span class="n">rectify</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">periods</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">resolution</span><span class="p">)</span>
            <span class="n">converted_eps</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_epsilon</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">converted_eps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span>
        <span class="k">if</span> <span class="n">fig</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Heatmap</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">converted_eps</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">colorscale</span><span class="o">=</span><span class="s1">&#39;Viridis&#39;</span><span class="p">))</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">&lt;br&gt;Dielectric Distribution&quot;</span><span class="p">,</span>
                <span class="n">x</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                <span class="n">y</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span>
                <span class="n">xanchor</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                <span class="n">yanchor</span><span class="o">=</span><span class="s1">&#39;top&#39;</span>
            <span class="p">),</span>
            <span class="n">coloraxis_colorbar</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;$</span><span class="se">\\</span><span class="s1">epsilon $&#39;</span><span class="p">),</span>
            <span class="n">xaxis_showgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
            <span class="n">yaxis_showgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">xaxis_zeroline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
            <span class="n">yaxis_zeroline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">xaxis_visible</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
            <span class="n">yaxis_visible</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>       
    <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span> <span class="o">=</span> <span class="n">converted_eps</span>
    <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">)</span>    
    <span class="k">return</span> <span class="n">fig</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.photonic_crystal.Crystal2D.plot_field" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_field</span><span class="p">(</span><span class="n">runner</span><span class="o">=</span><span class="s1">&#39;run_tm&#39;</span><span class="p">,</span> <span class="n">k_point</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">periods</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Field Visualization&#39;</span><span class="p">,</span> <span class="n">colorscale</span><span class="o">=</span><span class="s1">&#39;RdBu&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Plot the electromagnetic field distribution interactively using Plotly.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>runner</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The runner for the simulation. Default is 'run_tm'.</p>
              </div>
            </td>
            <td>
                  <code>&#39;run_tm&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>k_point</code>
            </td>
            <td>
                  <code><span title="meep.Vector3">Vector3</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The k-point for the simulation. Default is mp.Vector3(0, 0).</p>
              </div>
            </td>
            <td>
                  <code><span title="meep.Vector3">Vector3</span>(0, 0)</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>periods</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of periods to extract. Default is 5.</p>
              </div>
            </td>
            <td>
                  <code>5</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fig</code>
            </td>
            <td>
                  <code><span title="plotly.graph_objects.Figure">Figure</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The Plotly figure to add the field plot to. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>title</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The title of the plot. Default is 'Field Visualization'.</p>
              </div>
            </td>
            <td>
                  <code>&#39;Field Visualization&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>colorscale</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The colorscale for the heatmap. Default is 'RdBu'.</p>
              </div>
            </td>
            <td>
                  <code>&#39;RdBu&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="plotly.graph_objects.Figure">Figure</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>go.Figure: The Plotly figure object.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/photonic_crystal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">plot_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
            <span class="n">runner</span><span class="o">=</span><span class="s2">&quot;run_tm&quot;</span><span class="p">,</span> 
            <span class="n">k_point</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> 
            <span class="n">periods</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> 
            <span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Field Visualization&quot;</span><span class="p">,</span> 
            <span class="n">colorscale</span><span class="o">=</span><span class="s1">&#39;RdBu&#39;</span><span class="p">)</span><span class="o">-&gt;</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the electromagnetic field distribution interactively using Plotly.</span>

<span class="sd">    Args:</span>
<span class="sd">        runner (str): The runner for the simulation. Default is &#39;run_tm&#39;.</span>
<span class="sd">        k_point (mp.Vector3): The k-point for the simulation. Default is mp.Vector3(0, 0).</span>
<span class="sd">        periods (int): The number of periods to extract. Default is 5.</span>
<span class="sd">        fig (go.Figure): The Plotly figure to add the field plot to. Default is None.</span>
<span class="sd">        title (str): The title of the plot. Default is &#39;Field Visualization&#39;.</span>
<span class="sd">        colorscale (str): The colorscale for the heatmap. Default is &#39;RdBu&#39;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        go.Figure: The Plotly figure object.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">raw_fields</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">freqs</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">ms</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">ModeSolver</span><span class="p">(</span><span class="n">geometry</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">geometry</span><span class="p">,</span>
                            <span class="n">geometry_lattice</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">geometry_lattice</span><span class="p">,</span>
                            <span class="n">k_points</span><span class="o">=</span><span class="p">[</span><span class="n">k_point</span><span class="p">],</span>
                            <span class="n">resolution</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">resolution</span><span class="p">,</span>
                            <span class="n">num_bands</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_bands</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_zodd_fields</span><span class="p">(</span><span class="n">ms</span><span class="p">,</span> <span class="n">band</span><span class="p">):</span>
        <span class="n">raw_fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ms</span><span class="o">.</span><span class="n">get_hfield</span><span class="p">(</span><span class="n">band</span><span class="p">,</span> <span class="n">bloch_phase</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">get_zeven_fields</span><span class="p">(</span><span class="n">ms</span><span class="p">,</span> <span class="n">band</span><span class="p">):</span>
        <span class="n">raw_fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ms</span><span class="o">.</span><span class="n">get_efield</span><span class="p">(</span><span class="n">band</span><span class="p">,</span> <span class="n">bloch_phase</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">get_freqs</span><span class="p">(</span><span class="n">ms</span><span class="p">,</span> <span class="n">band</span><span class="p">):</span>
        <span class="n">freqs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ms</span><span class="o">.</span><span class="n">freqs</span><span class="p">[</span><span class="n">band</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>


    <span class="k">with</span> <span class="n">suppress_output</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">runner</span> <span class="o">==</span> <span class="s2">&quot;run_te&quot;</span> <span class="ow">or</span> <span class="n">runner</span> <span class="o">==</span> <span class="s2">&quot;run_zeven&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">run_te</span><span class="p">(</span><span class="n">mpb</span><span class="o">.</span><span class="n">output_at_kpoint</span><span class="p">(</span><span class="n">k_point</span><span class="p">,</span> <span class="n">mpb</span><span class="o">.</span><span class="n">fix_hfield_phase</span><span class="p">,</span> <span class="n">get_zodd_fields</span><span class="p">,</span> <span class="n">get_freqs</span><span class="p">))</span>
            <span class="n">field_type</span> <span class="o">=</span> <span class="s2">&quot;H-field&quot;</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;frequencies: </span><span class="si">{</span><span class="n">freqs</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">runner</span> <span class="o">==</span> <span class="s2">&quot;run_tm&quot;</span> <span class="ow">or</span> <span class="n">runner</span> <span class="o">==</span> <span class="s2">&quot;run_zodd&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">run_tm</span><span class="p">(</span><span class="n">mpb</span><span class="o">.</span><span class="n">output_at_kpoint</span><span class="p">(</span><span class="n">k_point</span><span class="p">,</span> <span class="n">mpb</span><span class="o">.</span><span class="n">fix_efield_phase</span><span class="p">,</span> <span class="n">get_zeven_fields</span><span class="p">,</span> <span class="n">get_freqs</span><span class="p">))</span>
            <span class="n">field_type</span> <span class="o">=</span> <span class="s2">&quot;E-field&quot;</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;frequencies: </span><span class="si">{</span><span class="n">freqs</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid runner. Please enter &#39;run_te&#39;, &#39;run_zeven&#39;, or &#39;run_tm&#39; or &#39;run_zodd&#39;.&quot;</span><span class="p">)</span>

        <span class="n">md</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">MPBData</span><span class="p">(</span><span class="n">rectify</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="n">periods</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">resolution</span><span class="p">)</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[]</span>        
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">raw_fields</span><span class="p">:</span>
            <span class="n">field</span> <span class="o">=</span> <span class="n">field</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>  <span class="c1"># Get just the z component of the fields</span>

            <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">field</span><span class="p">))</span>



        <span class="n">eps</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_epsilon</span><span class="p">())</span>
    <span class="c1">#print(fields)</span>
    <span class="n">num_plots</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">num_plots</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No field data to plot.&quot;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="k">if</span> <span class="n">fig</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>

    <span class="c1"># Automatically generate the subtitle with the k-vector and field type</span>
    <span class="n">subtitle</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field_type</span><span class="si">}</span><span class="s2">, z-component&lt;br&gt;k = (</span><span class="si">{</span><span class="n">k_point</span><span class="o">.</span><span class="n">x</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">k_point</span><span class="o">.</span><span class="n">y</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">)&quot;</span>

    <span class="c1"># Initialize an empty list for dropdown menu options</span>
    <span class="n">dropdown_buttons</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Calculate the midpoint between min and max of the permittivity (eps)</span>
    <span class="n">min_eps</span><span class="p">,</span> <span class="n">max_eps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">eps</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">eps</span><span class="p">)</span>
    <span class="n">midpoint</span> <span class="o">=</span> <span class="p">(</span><span class="n">min_eps</span> <span class="o">+</span> <span class="n">max_eps</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>  <span class="c1"># The level to be plotted</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">freq</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">fields</span><span class="p">,</span> <span class="n">freqs</span><span class="p">)):</span>
        <span class="n">visible_status</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">num_plots</span><span class="p">)</span>
        <span class="n">visible_status</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Make the current contour (eps) visible</span>
        <span class="n">visible_status</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Make the current heatmap (field) visible</span>

        <span class="c1"># Add the contour plot for permittivity (eps) at the midpoint</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Contour</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">eps</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
                                <span class="n">contours</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                                    <span class="n">start</span><span class="o">=</span><span class="n">midpoint</span><span class="p">,</span>  <span class="c1"># Start and end at the midpoint to ensure a single level</span>
                                    <span class="n">end</span><span class="o">=</span><span class="n">midpoint</span><span class="p">,</span>
                                    <span class="n">size</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>  <span class="c1"># A small size to keep it as a single contour</span>
                                    <span class="n">coloring</span><span class="o">=</span><span class="s1">&#39;none&#39;</span>  <span class="c1"># No filling</span>
                                <span class="p">),</span>
                                <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>
                                <span class="n">showscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                <span class="n">opacity</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
                                <span class="n">visible</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">False</span><span class="p">))</span>  <span class="c1"># Initially visible only for the first plot</span>

        <span class="c1"># Add the heatmap for the real part of the electric field</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Heatmap</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">field</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscale</span><span class="p">,</span> <span class="n">zsmooth</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span>
                                <span class="n">showscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">False</span><span class="p">))</span>

        <span class="c1"># Create a button for each field dataset for the dropdown</span>
        <span class="n">dropdown_buttons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mode </span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                                    <span class="n">method</span><span class="o">=</span><span class="s1">&#39;update&#39;</span><span class="p">,</span>
                                    <span class="n">args</span><span class="o">=</span><span class="p">[{</span><span class="s1">&#39;visible&#39;</span><span class="p">:</span> <span class="n">visible_status</span><span class="p">},</span>  <span class="c1"># Update visibility for both eps and field</span>
                                        <span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">&lt;br&gt;Mode </span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">, freq=</span><span class="si">{</span><span class="n">freq</span><span class="si">:</span><span class="s2">0.3f</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">subtitle</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}</span>
                                    <span class="p">]))</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;k_point&quot;</span> <span class="p">:</span> <span class="n">k_point</span><span class="p">,</span>
            <span class="s2">&quot;frequency&quot;</span> <span class="p">:</span> <span class="n">freq</span><span class="p">,</span>
            <span class="s2">&quot;field&quot;</span> <span class="p">:</span> <span class="n">field</span><span class="p">,</span>
            <span class="s2">&quot;field_type&quot;</span> <span class="p">:</span> <span class="n">field_type</span><span class="p">,</span>
        <span class="p">}</span>



    <span class="c1"># Add the dropdown menu to the layout</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
        <span class="n">updatemenus</span><span class="o">=</span><span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="n">active</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>  <span class="c1"># The first dataset is active by default</span>
                        <span class="n">buttons</span><span class="o">=</span><span class="n">dropdown_buttons</span><span class="p">,</span>
                        <span class="n">x</span><span class="o">=</span><span class="mf">1.15</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.15</span><span class="p">,</span>  <span class="c1"># Positioning the dropdown to the top right</span>
                        <span class="n">xanchor</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">yanchor</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)],</span>
        <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">&lt;br&gt;Mode </span><span class="si">{</span><span class="mi">1</span><span class="si">}</span><span class="s2">, freq=</span><span class="si">{</span><span class="n">freqs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">0.3f</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">subtitle</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>  <span class="c1"># Main title + subtitle</span>
        <span class="n">xaxis_showgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">yaxis_showgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">xaxis_zeroline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">yaxis_zeroline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">xaxis_visible</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">yaxis_visible</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">hovermode</span><span class="o">=</span><span class="s2">&quot;closest&quot;</span><span class="p">,</span>
        <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">800</span>
    <span class="p">)</span>


    <span class="c1"># Display the plot</span>
    <span class="k">return</span> <span class="n">fig</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.photonic_crystal.Crystal2D.square_lattice" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">square_lattice</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Define the square lattice for the photonic crystal.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>tuple</code></td>            <td>
                  <code>tuple[<span title="meep.Lattice">Lattice</span>, list[<span title="meep.Vector3">Vector3</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tuple containing the lattice object representing the square lattice and a list of k-points for the simulation.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/photonic_crystal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">square_lattice</span><span class="p">()</span><span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">mp</span><span class="o">.</span><span class="n">Lattice</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Define the square lattice for the photonic crystal.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: A tuple containing the lattice object representing the square lattice and a list of k-points for the simulation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lattice</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Lattice</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                      <span class="n">basis1</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                      <span class="n">basis2</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">k_points</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(),</span>               <span class="c1"># Gamma</span>
        <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mf">0.5</span><span class="p">),</span>          <span class="c1"># M</span>
        <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>       <span class="c1"># X</span>
        <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(),</span>               <span class="c1"># Gamma</span>
    <span class="p">]</span>
    <span class="k">return</span> <span class="n">lattice</span><span class="p">,</span> <span class="n">k_points</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.photonic_crystal.Crystal2D.triangular_lattice" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">triangular_lattice</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Define the triangular lattice for the photonic crystal.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>tuple</code></td>            <td>
                  <code>tuple[<span title="meep.Lattice">Lattice</span>, list[<span title="meep.Vector3">Vector3</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tuple containing the lattice object representing the triangular lattice and a list of k-points for the simulation.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/photonic_crystal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">triangular_lattice</span><span class="p">()</span><span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">mp</span><span class="o">.</span><span class="n">Lattice</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Define the triangular lattice for the photonic crystal.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: A tuple containing the lattice object representing the triangular lattice and a list of k-points for the simulation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lattice</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Lattice</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                      <span class="n">basis1</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                      <span class="n">basis2</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">k_points</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(),</span>               <span class="c1"># Gamma</span>
        <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mf">0.5</span><span class="p">),</span>          <span class="c1"># K</span>
        <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="o">-</span><span class="mf">1.</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span> <span class="mf">1.</span><span class="o">/</span><span class="mi">3</span><span class="p">),</span>    <span class="c1"># M</span>
        <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(),</span>               <span class="c1"># Gamma</span>
    <span class="p">]</span>
    <span class="k">return</span> <span class="n">lattice</span><span class="p">,</span> <span class="n">k_points</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.photonic_crystal.CrystalSlab" class="doc doc-heading">
            <code>CrystalSlab</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="src.photonic_crystal.PhotonicCrystal" href="#src.photonic_crystal.PhotonicCrystal">PhotonicCrystal</a></code></p>


        <p>CrystalSlab class represents a photonic crystal slab structure, inheriting from the PhotonicCrystal class.
This class provides methods to define the lattice, geometry, and to plot various properties of the photonic crystal slab.
Geometries can be added using mpb functions such as Cylinder, Ellipsoid, etc.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.photonic_crystal.CrystalSlab.geometry_lattice">geometry_lattice</span></code></td>
            <td>
                  <code><span title="meep.Lattice">Lattice</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The lattice structure of the photonic crystal.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.photonic_crystal.CrystalSlab.k_points">k_points</span></code></td>
            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of k-points for the simulation.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.photonic_crystal.CrystalSlab.geometry">geometry</span></code></td>
            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of geometric objects defining the photonic crystal.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.photonic_crystal.CrystalSlab.k_points_interpolated">k_points_interpolated</span></code></td>
            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Interpolated k-points for the simulation.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.photonic_crystal.CrystalSlab.epsilon">epsilon</span></code></td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dielectric function values obtained from the simulation.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Methods:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="src.photonic_crystal.CrystalSlab.__init__" href="#src.photonic_crystal.CrystalSlab.__init__">__init__</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Initializes the CrystalSlab object with the given parameters.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="src.photonic_crystal.CrystalSlab.plot_epsilon" href="#src.photonic_crystal.CrystalSlab.plot_epsilon">plot_epsilon</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Plots the epsilon values obtained from the simulation using Plotly.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="src.photonic_crystal.CrystalSlab.basic_lattice" href="#src.photonic_crystal.CrystalSlab.basic_lattice">basic_lattice</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Defines the basic lattice structure for the photonic crystal.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="src.photonic_crystal.CrystalSlab.square_lattice" href="#src.photonic_crystal.CrystalSlab.square_lattice">square_lattice</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Defines the square lattice for the photonic crystal.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="src.photonic_crystal.CrystalSlab.triangular_lattice" href="#src.photonic_crystal.CrystalSlab.triangular_lattice">triangular_lattice</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Defines the triangular lattice for the photonic crystal.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="src.photonic_crystal.CrystalSlab.basic_geometry" href="#src.photonic_crystal.CrystalSlab.basic_geometry">basic_geometry</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Defines the basic geometry for the photonic crystal.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="src.photonic_crystal.CrystalSlab.ellipsoid_geometry" href="#src.photonic_crystal.CrystalSlab.ellipsoid_geometry">ellipsoid_geometry</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Defines the geometry with ellipsoidal atoms for the photonic crystal.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="src.photonic_crystal.CrystalSlab.advanced_material_geometry" href="#src.photonic_crystal.CrystalSlab.advanced_material_geometry">advanced_material_geometry</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Defines the advanced material geometry for the photonic crystal.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="src.photonic_crystal.CrystalSlab.plot_field" href="#src.photonic_crystal.CrystalSlab.plot_field">plot_field</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Plots the field for a specific mode based on the given parameters.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="src.photonic_crystal.CrystalSlab.plot_field_components" href="#src.photonic_crystal.CrystalSlab.plot_field_components">plot_field_components</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Plots the field components (Ex, Ey, Ez) and (Hx, Hy, Hz) for specific modes with consistent color scales.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>src/photonic_crystal.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span>
<span class="normal">1422</span>
<span class="normal">1423</span>
<span class="normal">1424</span>
<span class="normal">1425</span>
<span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span>
<span class="normal">1433</span>
<span class="normal">1434</span>
<span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span>
<span class="normal">1442</span>
<span class="normal">1443</span>
<span class="normal">1444</span>
<span class="normal">1445</span>
<span class="normal">1446</span>
<span class="normal">1447</span>
<span class="normal">1448</span>
<span class="normal">1449</span>
<span class="normal">1450</span>
<span class="normal">1451</span>
<span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span>
<span class="normal">1456</span>
<span class="normal">1457</span>
<span class="normal">1458</span>
<span class="normal">1459</span>
<span class="normal">1460</span>
<span class="normal">1461</span>
<span class="normal">1462</span>
<span class="normal">1463</span>
<span class="normal">1464</span>
<span class="normal">1465</span>
<span class="normal">1466</span>
<span class="normal">1467</span>
<span class="normal">1468</span>
<span class="normal">1469</span>
<span class="normal">1470</span>
<span class="normal">1471</span>
<span class="normal">1472</span>
<span class="normal">1473</span>
<span class="normal">1474</span>
<span class="normal">1475</span>
<span class="normal">1476</span>
<span class="normal">1477</span>
<span class="normal">1478</span>
<span class="normal">1479</span>
<span class="normal">1480</span>
<span class="normal">1481</span>
<span class="normal">1482</span>
<span class="normal">1483</span>
<span class="normal">1484</span>
<span class="normal">1485</span>
<span class="normal">1486</span>
<span class="normal">1487</span>
<span class="normal">1488</span>
<span class="normal">1489</span>
<span class="normal">1490</span>
<span class="normal">1491</span>
<span class="normal">1492</span>
<span class="normal">1493</span>
<span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span>
<span class="normal">1497</span>
<span class="normal">1498</span>
<span class="normal">1499</span>
<span class="normal">1500</span>
<span class="normal">1501</span>
<span class="normal">1502</span>
<span class="normal">1503</span>
<span class="normal">1504</span>
<span class="normal">1505</span>
<span class="normal">1506</span>
<span class="normal">1507</span>
<span class="normal">1508</span>
<span class="normal">1509</span>
<span class="normal">1510</span>
<span class="normal">1511</span>
<span class="normal">1512</span>
<span class="normal">1513</span>
<span class="normal">1514</span>
<span class="normal">1515</span>
<span class="normal">1516</span>
<span class="normal">1517</span>
<span class="normal">1518</span>
<span class="normal">1519</span>
<span class="normal">1520</span>
<span class="normal">1521</span>
<span class="normal">1522</span>
<span class="normal">1523</span>
<span class="normal">1524</span>
<span class="normal">1525</span>
<span class="normal">1526</span>
<span class="normal">1527</span>
<span class="normal">1528</span>
<span class="normal">1529</span>
<span class="normal">1530</span>
<span class="normal">1531</span>
<span class="normal">1532</span>
<span class="normal">1533</span>
<span class="normal">1534</span>
<span class="normal">1535</span>
<span class="normal">1536</span>
<span class="normal">1537</span>
<span class="normal">1538</span>
<span class="normal">1539</span>
<span class="normal">1540</span>
<span class="normal">1541</span>
<span class="normal">1542</span>
<span class="normal">1543</span>
<span class="normal">1544</span>
<span class="normal">1545</span>
<span class="normal">1546</span>
<span class="normal">1547</span>
<span class="normal">1548</span>
<span class="normal">1549</span>
<span class="normal">1550</span>
<span class="normal">1551</span>
<span class="normal">1552</span>
<span class="normal">1553</span>
<span class="normal">1554</span>
<span class="normal">1555</span>
<span class="normal">1556</span>
<span class="normal">1557</span>
<span class="normal">1558</span>
<span class="normal">1559</span>
<span class="normal">1560</span>
<span class="normal">1561</span>
<span class="normal">1562</span>
<span class="normal">1563</span>
<span class="normal">1564</span>
<span class="normal">1565</span>
<span class="normal">1566</span>
<span class="normal">1567</span>
<span class="normal">1568</span>
<span class="normal">1569</span>
<span class="normal">1570</span>
<span class="normal">1571</span>
<span class="normal">1572</span>
<span class="normal">1573</span>
<span class="normal">1574</span>
<span class="normal">1575</span>
<span class="normal">1576</span>
<span class="normal">1577</span>
<span class="normal">1578</span>
<span class="normal">1579</span>
<span class="normal">1580</span>
<span class="normal">1581</span>
<span class="normal">1582</span>
<span class="normal">1583</span>
<span class="normal">1584</span>
<span class="normal">1585</span>
<span class="normal">1586</span>
<span class="normal">1587</span>
<span class="normal">1588</span>
<span class="normal">1589</span>
<span class="normal">1590</span>
<span class="normal">1591</span>
<span class="normal">1592</span>
<span class="normal">1593</span>
<span class="normal">1594</span>
<span class="normal">1595</span>
<span class="normal">1596</span>
<span class="normal">1597</span>
<span class="normal">1598</span>
<span class="normal">1599</span>
<span class="normal">1600</span>
<span class="normal">1601</span>
<span class="normal">1602</span>
<span class="normal">1603</span>
<span class="normal">1604</span>
<span class="normal">1605</span>
<span class="normal">1606</span>
<span class="normal">1607</span>
<span class="normal">1608</span>
<span class="normal">1609</span>
<span class="normal">1610</span>
<span class="normal">1611</span>
<span class="normal">1612</span>
<span class="normal">1613</span>
<span class="normal">1614</span>
<span class="normal">1615</span>
<span class="normal">1616</span>
<span class="normal">1617</span>
<span class="normal">1618</span>
<span class="normal">1619</span>
<span class="normal">1620</span>
<span class="normal">1621</span>
<span class="normal">1622</span>
<span class="normal">1623</span>
<span class="normal">1624</span>
<span class="normal">1625</span>
<span class="normal">1626</span>
<span class="normal">1627</span>
<span class="normal">1628</span>
<span class="normal">1629</span>
<span class="normal">1630</span>
<span class="normal">1631</span>
<span class="normal">1632</span>
<span class="normal">1633</span>
<span class="normal">1634</span>
<span class="normal">1635</span>
<span class="normal">1636</span>
<span class="normal">1637</span>
<span class="normal">1638</span>
<span class="normal">1639</span>
<span class="normal">1640</span>
<span class="normal">1641</span>
<span class="normal">1642</span>
<span class="normal">1643</span>
<span class="normal">1644</span>
<span class="normal">1645</span>
<span class="normal">1646</span>
<span class="normal">1647</span>
<span class="normal">1648</span>
<span class="normal">1649</span>
<span class="normal">1650</span>
<span class="normal">1651</span>
<span class="normal">1652</span>
<span class="normal">1653</span>
<span class="normal">1654</span>
<span class="normal">1655</span>
<span class="normal">1656</span>
<span class="normal">1657</span>
<span class="normal">1658</span>
<span class="normal">1659</span>
<span class="normal">1660</span>
<span class="normal">1661</span>
<span class="normal">1662</span>
<span class="normal">1663</span>
<span class="normal">1664</span>
<span class="normal">1665</span>
<span class="normal">1666</span>
<span class="normal">1667</span>
<span class="normal">1668</span>
<span class="normal">1669</span>
<span class="normal">1670</span>
<span class="normal">1671</span>
<span class="normal">1672</span>
<span class="normal">1673</span>
<span class="normal">1674</span>
<span class="normal">1675</span>
<span class="normal">1676</span>
<span class="normal">1677</span>
<span class="normal">1678</span>
<span class="normal">1679</span>
<span class="normal">1680</span>
<span class="normal">1681</span>
<span class="normal">1682</span>
<span class="normal">1683</span>
<span class="normal">1684</span>
<span class="normal">1685</span>
<span class="normal">1686</span>
<span class="normal">1687</span>
<span class="normal">1688</span>
<span class="normal">1689</span>
<span class="normal">1690</span>
<span class="normal">1691</span>
<span class="normal">1692</span>
<span class="normal">1693</span>
<span class="normal">1694</span>
<span class="normal">1695</span>
<span class="normal">1696</span>
<span class="normal">1697</span>
<span class="normal">1698</span>
<span class="normal">1699</span>
<span class="normal">1700</span>
<span class="normal">1701</span>
<span class="normal">1702</span>
<span class="normal">1703</span>
<span class="normal">1704</span>
<span class="normal">1705</span>
<span class="normal">1706</span>
<span class="normal">1707</span>
<span class="normal">1708</span>
<span class="normal">1709</span>
<span class="normal">1710</span>
<span class="normal">1711</span>
<span class="normal">1712</span>
<span class="normal">1713</span>
<span class="normal">1714</span>
<span class="normal">1715</span>
<span class="normal">1716</span>
<span class="normal">1717</span>
<span class="normal">1718</span>
<span class="normal">1719</span>
<span class="normal">1720</span>
<span class="normal">1721</span>
<span class="normal">1722</span>
<span class="normal">1723</span>
<span class="normal">1724</span>
<span class="normal">1725</span>
<span class="normal">1726</span>
<span class="normal">1727</span>
<span class="normal">1728</span>
<span class="normal">1729</span>
<span class="normal">1730</span>
<span class="normal">1731</span>
<span class="normal">1732</span>
<span class="normal">1733</span>
<span class="normal">1734</span>
<span class="normal">1735</span>
<span class="normal">1736</span>
<span class="normal">1737</span>
<span class="normal">1738</span>
<span class="normal">1739</span>
<span class="normal">1740</span>
<span class="normal">1741</span>
<span class="normal">1742</span>
<span class="normal">1743</span>
<span class="normal">1744</span>
<span class="normal">1745</span>
<span class="normal">1746</span>
<span class="normal">1747</span>
<span class="normal">1748</span>
<span class="normal">1749</span>
<span class="normal">1750</span>
<span class="normal">1751</span>
<span class="normal">1752</span>
<span class="normal">1753</span>
<span class="normal">1754</span>
<span class="normal">1755</span>
<span class="normal">1756</span>
<span class="normal">1757</span>
<span class="normal">1758</span>
<span class="normal">1759</span>
<span class="normal">1760</span>
<span class="normal">1761</span>
<span class="normal">1762</span>
<span class="normal">1763</span>
<span class="normal">1764</span>
<span class="normal">1765</span>
<span class="normal">1766</span>
<span class="normal">1767</span>
<span class="normal">1768</span>
<span class="normal">1769</span>
<span class="normal">1770</span>
<span class="normal">1771</span>
<span class="normal">1772</span>
<span class="normal">1773</span>
<span class="normal">1774</span>
<span class="normal">1775</span>
<span class="normal">1776</span>
<span class="normal">1777</span>
<span class="normal">1778</span>
<span class="normal">1779</span>
<span class="normal">1780</span>
<span class="normal">1781</span>
<span class="normal">1782</span>
<span class="normal">1783</span>
<span class="normal">1784</span>
<span class="normal">1785</span>
<span class="normal">1786</span>
<span class="normal">1787</span>
<span class="normal">1788</span>
<span class="normal">1789</span>
<span class="normal">1790</span>
<span class="normal">1791</span>
<span class="normal">1792</span>
<span class="normal">1793</span>
<span class="normal">1794</span>
<span class="normal">1795</span>
<span class="normal">1796</span>
<span class="normal">1797</span>
<span class="normal">1798</span>
<span class="normal">1799</span>
<span class="normal">1800</span>
<span class="normal">1801</span>
<span class="normal">1802</span>
<span class="normal">1803</span>
<span class="normal">1804</span>
<span class="normal">1805</span>
<span class="normal">1806</span>
<span class="normal">1807</span>
<span class="normal">1808</span>
<span class="normal">1809</span>
<span class="normal">1810</span>
<span class="normal">1811</span>
<span class="normal">1812</span>
<span class="normal">1813</span>
<span class="normal">1814</span>
<span class="normal">1815</span>
<span class="normal">1816</span>
<span class="normal">1817</span>
<span class="normal">1818</span>
<span class="normal">1819</span>
<span class="normal">1820</span>
<span class="normal">1821</span>
<span class="normal">1822</span>
<span class="normal">1823</span>
<span class="normal">1824</span>
<span class="normal">1825</span>
<span class="normal">1826</span>
<span class="normal">1827</span>
<span class="normal">1828</span>
<span class="normal">1829</span>
<span class="normal">1830</span>
<span class="normal">1831</span>
<span class="normal">1832</span>
<span class="normal">1833</span>
<span class="normal">1834</span>
<span class="normal">1835</span>
<span class="normal">1836</span>
<span class="normal">1837</span>
<span class="normal">1838</span>
<span class="normal">1839</span>
<span class="normal">1840</span>
<span class="normal">1841</span>
<span class="normal">1842</span>
<span class="normal">1843</span>
<span class="normal">1844</span>
<span class="normal">1845</span>
<span class="normal">1846</span>
<span class="normal">1847</span>
<span class="normal">1848</span>
<span class="normal">1849</span>
<span class="normal">1850</span>
<span class="normal">1851</span>
<span class="normal">1852</span>
<span class="normal">1853</span>
<span class="normal">1854</span>
<span class="normal">1855</span>
<span class="normal">1856</span>
<span class="normal">1857</span>
<span class="normal">1858</span>
<span class="normal">1859</span>
<span class="normal">1860</span>
<span class="normal">1861</span>
<span class="normal">1862</span>
<span class="normal">1863</span>
<span class="normal">1864</span>
<span class="normal">1865</span>
<span class="normal">1866</span>
<span class="normal">1867</span>
<span class="normal">1868</span>
<span class="normal">1869</span>
<span class="normal">1870</span>
<span class="normal">1871</span>
<span class="normal">1872</span>
<span class="normal">1873</span>
<span class="normal">1874</span>
<span class="normal">1875</span>
<span class="normal">1876</span>
<span class="normal">1877</span>
<span class="normal">1878</span>
<span class="normal">1879</span>
<span class="normal">1880</span>
<span class="normal">1881</span>
<span class="normal">1882</span>
<span class="normal">1883</span>
<span class="normal">1884</span>
<span class="normal">1885</span>
<span class="normal">1886</span>
<span class="normal">1887</span>
<span class="normal">1888</span>
<span class="normal">1889</span>
<span class="normal">1890</span>
<span class="normal">1891</span>
<span class="normal">1892</span>
<span class="normal">1893</span>
<span class="normal">1894</span>
<span class="normal">1895</span>
<span class="normal">1896</span>
<span class="normal">1897</span>
<span class="normal">1898</span>
<span class="normal">1899</span>
<span class="normal">1900</span>
<span class="normal">1901</span>
<span class="normal">1902</span>
<span class="normal">1903</span>
<span class="normal">1904</span>
<span class="normal">1905</span>
<span class="normal">1906</span>
<span class="normal">1907</span>
<span class="normal">1908</span>
<span class="normal">1909</span>
<span class="normal">1910</span>
<span class="normal">1911</span>
<span class="normal">1912</span>
<span class="normal">1913</span>
<span class="normal">1914</span>
<span class="normal">1915</span>
<span class="normal">1916</span>
<span class="normal">1917</span>
<span class="normal">1918</span>
<span class="normal">1919</span>
<span class="normal">1920</span>
<span class="normal">1921</span>
<span class="normal">1922</span>
<span class="normal">1923</span>
<span class="normal">1924</span>
<span class="normal">1925</span>
<span class="normal">1926</span>
<span class="normal">1927</span>
<span class="normal">1928</span>
<span class="normal">1929</span>
<span class="normal">1930</span>
<span class="normal">1931</span>
<span class="normal">1932</span>
<span class="normal">1933</span>
<span class="normal">1934</span>
<span class="normal">1935</span>
<span class="normal">1936</span>
<span class="normal">1937</span>
<span class="normal">1938</span>
<span class="normal">1939</span>
<span class="normal">1940</span>
<span class="normal">1941</span>
<span class="normal">1942</span>
<span class="normal">1943</span>
<span class="normal">1944</span>
<span class="normal">1945</span>
<span class="normal">1946</span>
<span class="normal">1947</span>
<span class="normal">1948</span>
<span class="normal">1949</span>
<span class="normal">1950</span>
<span class="normal">1951</span>
<span class="normal">1952</span>
<span class="normal">1953</span>
<span class="normal">1954</span>
<span class="normal">1955</span>
<span class="normal">1956</span>
<span class="normal">1957</span>
<span class="normal">1958</span>
<span class="normal">1959</span>
<span class="normal">1960</span>
<span class="normal">1961</span>
<span class="normal">1962</span>
<span class="normal">1963</span>
<span class="normal">1964</span>
<span class="normal">1965</span>
<span class="normal">1966</span>
<span class="normal">1967</span>
<span class="normal">1968</span>
<span class="normal">1969</span>
<span class="normal">1970</span>
<span class="normal">1971</span>
<span class="normal">1972</span>
<span class="normal">1973</span>
<span class="normal">1974</span>
<span class="normal">1975</span>
<span class="normal">1976</span>
<span class="normal">1977</span>
<span class="normal">1978</span>
<span class="normal">1979</span>
<span class="normal">1980</span>
<span class="normal">1981</span>
<span class="normal">1982</span>
<span class="normal">1983</span>
<span class="normal">1984</span>
<span class="normal">1985</span>
<span class="normal">1986</span>
<span class="normal">1987</span>
<span class="normal">1988</span>
<span class="normal">1989</span>
<span class="normal">1990</span>
<span class="normal">1991</span>
<span class="normal">1992</span>
<span class="normal">1993</span>
<span class="normal">1994</span>
<span class="normal">1995</span>
<span class="normal">1996</span>
<span class="normal">1997</span>
<span class="normal">1998</span>
<span class="normal">1999</span>
<span class="normal">2000</span>
<span class="normal">2001</span>
<span class="normal">2002</span>
<span class="normal">2003</span>
<span class="normal">2004</span>
<span class="normal">2005</span>
<span class="normal">2006</span>
<span class="normal">2007</span>
<span class="normal">2008</span>
<span class="normal">2009</span>
<span class="normal">2010</span>
<span class="normal">2011</span>
<span class="normal">2012</span>
<span class="normal">2013</span>
<span class="normal">2014</span>
<span class="normal">2015</span>
<span class="normal">2016</span>
<span class="normal">2017</span>
<span class="normal">2018</span>
<span class="normal">2019</span>
<span class="normal">2020</span>
<span class="normal">2021</span>
<span class="normal">2022</span>
<span class="normal">2023</span>
<span class="normal">2024</span>
<span class="normal">2025</span>
<span class="normal">2026</span>
<span class="normal">2027</span>
<span class="normal">2028</span>
<span class="normal">2029</span>
<span class="normal">2030</span>
<span class="normal">2031</span>
<span class="normal">2032</span>
<span class="normal">2033</span>
<span class="normal">2034</span>
<span class="normal">2035</span>
<span class="normal">2036</span>
<span class="normal">2037</span>
<span class="normal">2038</span>
<span class="normal">2039</span>
<span class="normal">2040</span>
<span class="normal">2041</span>
<span class="normal">2042</span>
<span class="normal">2043</span>
<span class="normal">2044</span>
<span class="normal">2045</span>
<span class="normal">2046</span>
<span class="normal">2047</span>
<span class="normal">2048</span>
<span class="normal">2049</span>
<span class="normal">2050</span>
<span class="normal">2051</span>
<span class="normal">2052</span>
<span class="normal">2053</span>
<span class="normal">2054</span>
<span class="normal">2055</span>
<span class="normal">2056</span>
<span class="normal">2057</span>
<span class="normal">2058</span>
<span class="normal">2059</span>
<span class="normal">2060</span>
<span class="normal">2061</span>
<span class="normal">2062</span>
<span class="normal">2063</span>
<span class="normal">2064</span>
<span class="normal">2065</span>
<span class="normal">2066</span>
<span class="normal">2067</span>
<span class="normal">2068</span>
<span class="normal">2069</span>
<span class="normal">2070</span>
<span class="normal">2071</span>
<span class="normal">2072</span>
<span class="normal">2073</span>
<span class="normal">2074</span>
<span class="normal">2075</span>
<span class="normal">2076</span>
<span class="normal">2077</span>
<span class="normal">2078</span>
<span class="normal">2079</span>
<span class="normal">2080</span>
<span class="normal">2081</span>
<span class="normal">2082</span>
<span class="normal">2083</span>
<span class="normal">2084</span>
<span class="normal">2085</span>
<span class="normal">2086</span>
<span class="normal">2087</span>
<span class="normal">2088</span>
<span class="normal">2089</span>
<span class="normal">2090</span>
<span class="normal">2091</span>
<span class="normal">2092</span>
<span class="normal">2093</span>
<span class="normal">2094</span>
<span class="normal">2095</span>
<span class="normal">2096</span>
<span class="normal">2097</span>
<span class="normal">2098</span>
<span class="normal">2099</span>
<span class="normal">2100</span>
<span class="normal">2101</span>
<span class="normal">2102</span>
<span class="normal">2103</span>
<span class="normal">2104</span>
<span class="normal">2105</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">CrystalSlab</span><span class="p">(</span><span class="n">PhotonicCrystal</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    CrystalSlab class represents a photonic crystal slab structure, inheriting from the PhotonicCrystal class.</span>
<span class="sd">    This class provides methods to define the lattice, geometry, and to plot various properties of the photonic crystal slab.</span>
<span class="sd">    Geometries can be added using mpb functions such as Cylinder, Ellipsoid, etc.</span>


<span class="sd">    Attributes:</span>
<span class="sd">        geometry_lattice (mp.Lattice): The lattice structure of the photonic crystal.</span>
<span class="sd">        k_points (list): List of k-points for the simulation.</span>
<span class="sd">        geometry (list): List of geometric objects defining the photonic crystal.</span>
<span class="sd">        k_points_interpolated (list): Interpolated k-points for the simulation.</span>
<span class="sd">        epsilon (np.ndarray): Dielectric function values obtained from the simulation.</span>

<span class="sd">    Methods:</span>
<span class="sd">        __init__(self, lattice_type=None, num_bands=4, resolution=mp.Vector3(32,32,16), interp=2, periods=3, pickle_id=None, geometry=None, use_XY=True, k_point_max=0.2):</span>
<span class="sd">            Initializes the CrystalSlab object with the given parameters.</span>
<span class="sd">        plot_epsilon(self, fig=None, opacity=0.3, colorscale=&#39;PuBuGn&#39;, override_resolution_with=None, periods=1):</span>
<span class="sd">            Plots the epsilon values obtained from the simulation using Plotly.</span>
<span class="sd">        basic_lattice(lattice_type=&#39;square&#39;, height_supercell=4):</span>
<span class="sd">            Defines the basic lattice structure for the photonic crystal.</span>
<span class="sd">        square_lattice(height_supercell=4):</span>
<span class="sd">            Defines the square lattice for the photonic crystal.</span>
<span class="sd">        triangular_lattice(height_supercell=4):</span>
<span class="sd">            Defines the triangular lattice for the photonic crystal.</span>
<span class="sd">        basic_geometry(radius_1=0.2, eps_atom_1=1, radius_2=None, eps_atom_2=None, eps_bulk=12, height_supercell=4, height_slab=0.5, eps_background=1, eps_substrate=None):</span>
<span class="sd">            Defines the basic geometry for the photonic crystal.</span>
<span class="sd">        ellipsoid_geometry(e1=0.2, e2=0.3, eps_atom=1, height_supercell=4, height_slab=0.5, eps_background=1, eps_substrate=1, eps_diag=mp.Vector3(12, 12, 12), eps_offdiag=mp.Vector3(0, 0, 0), E_chi2_diag=mp.Vector3(0,0,0), E_chi3_diag=mp.Vector3(0,0,0)):</span>
<span class="sd">            Defines the geometry with ellipsoidal atoms for the photonic crystal.</span>
<span class="sd">        advanced_material_geometry(radius_1=0.2, epsilon_diag=mp.Vector3(12, 12, 12), epsilon_offdiag=mp.Vector3(0, 0, 0), chi2_diag=mp.Vector3(0,0,0), chi3_diag=mp.Vector3(0,0,0), eps_atom_1=1, eps_background=1, eps_substrate=1, height_supercell=4, height_slab=0.5):</span>
<span class="sd">            Defines the advanced material geometry for the photonic crystal.</span>
<span class="sd">        plot_field(self, target_polarization, target_k_point, target_frequency, frequency_tolerance=0.01, k_point_max_distance=None, periods=1, component=2, quantity=&#39;real&#39;, colorscale=&#39;RdBu&#39;):</span>
<span class="sd">            Plots the field for a specific mode based on the given parameters.</span>
<span class="sd">        plot_field_components(self, target_polarization, target_k_point, target_frequency, frequency_tolerance=0.01, k_point_max_distance=None, periods=1, quantity=&#39;real&#39;, colorscale=&#39;RdBu&#39;):</span>
<span class="sd">            Plots the field components (Ex, Ey, Ez) and (Hx, Hy, Hz) for specific modes with consistent color scales.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                <span class="n">lattice_type</span> <span class="o">=</span> <span class="s2">&quot;square&quot;</span><span class="p">,</span>
                <span class="n">num_bands</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
                <span class="n">resolution</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">16</span><span class="p">),</span>
                <span class="n">interp</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                <span class="n">periods</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span><span class="mi">3</span><span class="p">,</span> 
                <span class="n">pickle_id</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">geometry</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                <span class="n">use_XY</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                <span class="n">k_point_max</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes the CrystalSlab object with the given parameters.</span>

<span class="sd">        Args:</span>
<span class="sd">            lattice_type (str): The type of lattice. It can be &#39;square&#39; or &#39;triangular&#39;. Default is &#39;square&#39;.</span>
<span class="sd">            num_bands (int): The number of bands to calculate. Default is 4.</span>
<span class="sd">            resolution (mp.Vector3): The resolution of the simulation. Default is mp.Vector3(32, 32, 16).</span>
<span class="sd">            interp (int): The interpolation factor for k-points. Default is 2.</span>
<span class="sd">            periods (int): The number of periods to use in some plotting functions. Default is 3.</span>
<span class="sd">            pickle_id (str): The ID for pickling the simulation. Default is None.</span>
<span class="sd">            geometry (list): The geometry of the photonic crystal. Default is None. If it is none, the basic geometry is used.</span>
<span class="sd">            use_XY (bool): Whether to use the X and Y directions for the x-axis or high symmetry points. Default is True.</span>
<span class="sd">            k_point_max (float): The maximum k-point value. Default is 0.2.</span>
<span class="sd">        &quot;&quot;&quot;</span>


        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">lattice_type</span><span class="p">,</span> <span class="n">num_bands</span><span class="p">,</span> <span class="n">resolution</span><span class="p">,</span> <span class="n">interp</span><span class="p">,</span> <span class="n">periods</span><span class="p">,</span> <span class="n">pickle_id</span><span class="p">,</span> <span class="n">use_XY</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">geometry_lattice</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">basic_lattice</span><span class="p">(</span><span class="n">lattice_type</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">use_XY</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">k_points</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="n">k_point_max</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>      <span class="c1"># X</span>
                <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">),</span>               <span class="c1"># Gamma</span>
                <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">k_point_max</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>       <span class="c1"># Y</span>
            <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">geometry</span> <span class="o">=</span> <span class="n">geometry</span> <span class="k">if</span> <span class="n">geometry</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">basic_geometry</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k_points_interpolated</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">interp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_points</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">plot_epsilon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                    <span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                    <span class="n">opacity</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> 
                    <span class="n">colorscale</span><span class="o">=</span><span class="s1">&#39;PuBuGn&#39;</span><span class="p">,</span> 
                    <span class="n">override_resolution_with</span><span class="p">:</span> <span class="kc">None</span><span class="o">|</span><span class="nb">int</span><span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                    <span class="n">periods</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="p">)</span><span class="o">-&gt;</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the epsilon values obtained from the simulation using Plotly.</span>

<span class="sd">        Args:</span>
<span class="sd">            fig (go.Figure, optional): The Plotly figure to add the epsilon plot to. Default is None.</span>
<span class="sd">            opacity (float, optional): The opacity of the plot. Default is 0.3.</span>
<span class="sd">            colorscale (str, optional): The colorscale for the plot. Default is &#39;PuBuGn&#39;.</span>
<span class="sd">            override_resolution_with (int, optional): The resolution to use for plotting. You can change the resolution just for the plot, but the simulation will still use the value set in the __init__ method. Default is None.</span>
<span class="sd">            periods (int, optional): The number of periods to plot. Default is 1.</span>

<span class="sd">        Returns:</span>
<span class="sd">            go.Figure: The Plotly figure object.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">override_resolution_with</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">resolution</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">resolution</span> <span class="o">=</span> <span class="n">override_resolution_with</span>
            <span class="n">md</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">MPBData</span><span class="p">(</span><span class="n">rectify</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="n">periods</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">)</span>


            <span class="n">converted_eps</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_epsilon</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">converted_eps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span> <span class="o">=</span> <span class="n">converted_eps</span>
        <span class="k">if</span> <span class="n">fig</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>

        <span class="n">z_points</span> <span class="o">=</span> <span class="n">converted_eps</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">//</span><span class="n">periods</span>
        <span class="n">z_mid</span> <span class="o">=</span> <span class="n">converted_eps</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">//</span><span class="mi">2</span>
        <span class="n">epsilon</span> <span class="o">=</span> <span class="n">converted_eps</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">z_mid</span><span class="o">-</span><span class="n">z_points</span><span class="o">//</span><span class="mi">2</span><span class="p">:</span><span class="n">z_mid</span><span class="o">+</span><span class="n">z_points</span><span class="o">//</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> 
        <span class="nb">print</span><span class="p">(</span><span class="n">epsilon</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">epsilon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">epsilon</span><span class="p">,(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span> 

        <span class="c1"># Create indices for x, y, z axes (meshgrid)</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">epsilon</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">epsilon</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">epsilon</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>

        <span class="c1"># Flatten the arrays for Plotly</span>
        <span class="n">x_flat</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">y_flat</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">z_flat</span> <span class="o">=</span> <span class="n">z</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">epsilon_flat</span> <span class="o">=</span> <span class="n">epsilon</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

        <span class="c1"># Get the minimum and maximum values from the epsilon array (ensure they are floats)</span>
        <span class="n">isomin_value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">epsilon_flat</span><span class="p">))</span>
        <span class="n">isomax_value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">epsilon_flat</span><span class="p">))</span>

        <span class="c1"># Create the 3D volume plot using Plotly</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">go</span><span class="o">.</span><span class="n">Volume</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">x_flat</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y_flat</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="n">z_flat</span><span class="p">,</span>
            <span class="n">value</span><span class="o">=</span><span class="n">epsilon_flat</span><span class="p">,</span>  <span class="c1"># Use the dielectric function values</span>
            <span class="n">isomin</span><span class="o">=</span><span class="n">isomin_value</span><span class="p">,</span>
            <span class="n">isomax</span><span class="o">=</span><span class="n">isomax_value</span><span class="p">,</span>
            <span class="n">opacity</span><span class="o">=</span><span class="n">opacity</span><span class="p">,</span>  <span class="c1"># Adjust opacity to visualize internal structure</span>
            <span class="n">surface_count</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>  <span class="c1"># Number of surfaces to display</span>
            <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscale</span><span class="p">,</span>  <span class="c1"># Color scale for the dielectric function</span>
            <span class="n">colorbar</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Dielectric Constant&#39;</span><span class="p">)</span>
        <span class="p">))</span>

        <span class="c1"># Add layout details</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="s1">&#39;3D Volume Plot of Dielectric Function&#39;</span><span class="p">,</span>
            <span class="n">scene</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
            <span class="n">xaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
            <span class="n">yaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
            <span class="n">zaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fig</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">basic_lattice</span><span class="p">(</span><span class="n">lattice_type</span><span class="o">=</span><span class="s1">&#39;square&#39;</span><span class="p">,</span> <span class="n">height_supercell</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span><span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">mp</span><span class="o">.</span><span class="n">Lattice</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Define the basic lattice structure for the photonic crystal.</span>

<span class="sd">        Args:</span>
<span class="sd">            lattice_type (str): The type of lattice. Default is &#39;square&#39;.</span>
<span class="sd">            height_supercell (int): The height of the supercell. Default is 4.</span>

<span class="sd">        Returns:</span>
<span class="sd">            tuple: A tuple containing the lattice object representing the lattice and a list of k-points for the simulation.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">lattice_type</span> <span class="o">==</span> <span class="s1">&#39;square&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">CrystalSlab</span><span class="o">.</span><span class="n">square_lattice</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">lattice_type</span> <span class="o">==</span> <span class="s1">&#39;triangular&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">CrystalSlab</span><span class="o">.</span><span class="n">triangular_lattice</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid lattice type. Choose &#39;square&#39; or &#39;triangular&#39;.&quot;</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">square_lattice</span><span class="p">(</span><span class="n">height_supercell</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span><span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">mp</span><span class="o">.</span><span class="n">Lattice</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Define the square lattice for the photonic crystal.</span>

<span class="sd">        Returns:</span>
<span class="sd">            tuple: A tuple containing the lattice object representing the square lattice and a list of k-points for the simulation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">lattice</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Lattice</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">height_supercell</span><span class="p">),</span>
                          <span class="n">basis1</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                          <span class="n">basis2</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">k_points</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(),</span>               <span class="c1"># Gamma</span>
            <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mf">0.5</span><span class="p">),</span>          <span class="c1"># M</span>
            <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>       <span class="c1"># X</span>
            <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(),</span>               <span class="c1"># Gamma</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="n">lattice</span><span class="p">,</span> <span class="n">k_points</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">triangular_lattice</span><span class="p">(</span><span class="n">height_supercell</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span><span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">mp</span><span class="o">.</span><span class="n">Lattice</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Define the triangular lattice for the photonic crystal.</span>

<span class="sd">        Returns:</span>
<span class="sd">            tuple: A tuple containing the lattice object representing the triangular lattice and a list of k-points for the simulation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">lattice</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Lattice</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">height_supercell</span><span class="p">),</span>
                          <span class="n">basis1</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                          <span class="n">basis2</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">k_points</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(),</span>               <span class="c1"># Gamma</span>
            <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mf">0.5</span><span class="p">),</span>          <span class="c1"># K</span>
            <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="o">-</span><span class="mf">1.</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span> <span class="mf">1.</span><span class="o">/</span><span class="mi">3</span><span class="p">),</span>    <span class="c1"># M</span>
            <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(),</span>               <span class="c1"># Gamma</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="n">lattice</span><span class="p">,</span> <span class="n">k_points</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">basic_geometry</span><span class="p">(</span><span class="n">radius_1</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>  
                       <span class="n">eps_atom_1</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> 
                       <span class="n">radius_2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                       <span class="n">eps_atom_2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">eps_bulk</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span>
                       <span class="n">height_supercell</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> 
                       <span class="n">height_slab</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                       <span class="n">eps_background</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                       <span class="n">eps_substrate</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="p">)</span><span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Define the basic geometry for the photonic crystal.</span>
<span class="sd">        Biatomic structures have not been tested. </span>

<span class="sd">        Args:</span>
<span class="sd">            radius_1 (float): The radius of the first atom. Default is 0.2.</span>
<span class="sd">            eps_atom_1 (float): The dielectric constant of the first atom. Default is 1.</span>
<span class="sd">            radius_2 (float, optional): The radius of the second atom. Default is None.</span>
<span class="sd">            eps_atom_2 (float, optional): The dielectric constant of the second atom. Default is None.</span>
<span class="sd">            eps_bulk (float): The dielectric constant of the bulk. Default is 12.</span>
<span class="sd">            height_supercell (float): The height of the supercell. Default is 4.</span>
<span class="sd">            height_slab (float): The height of the slab. Default is 0.5.</span>
<span class="sd">            eps_background (float): The dielectric constant of the background. Default is 1.</span>
<span class="sd">            eps_substrate (float, optional): The dielectric constant of the substrate. Default is None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: A list of geometric objects defining the photonic crystal.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">geometry</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1">#background</span>
        <span class="n">geometry</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">mp</span><span class="o">.</span><span class="n">Block</span><span class="p">(</span>
                <span class="n">size</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="n">mp</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">mp</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">height_supercell</span><span class="p">),</span>
                <span class="n">material</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Medium</span><span class="p">(</span><span class="n">epsilon</span><span class="o">=</span><span class="n">eps_background</span><span class="p">)),</span>

        <span class="p">)</span>

        <span class="c1">#substrate</span>
        <span class="k">if</span> <span class="n">eps_substrate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">geometry</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mp</span><span class="o">.</span><span class="n">Block</span><span class="p">(</span>
                <span class="n">size</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="n">mp</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">mp</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">height_supercell</span><span class="o">*</span><span class="mf">0.5</span><span class="p">),</span>
                <span class="n">center</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">height_supercell</span><span class="o">*</span><span class="mf">0.25</span><span class="p">),</span>
                <span class="n">material</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Medium</span><span class="p">(</span><span class="n">epsilon</span><span class="o">=</span><span class="n">eps_substrate</span><span class="p">)))</span>


        <span class="c1">#slab</span>
        <span class="n">geometry</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">mp</span><span class="o">.</span><span class="n">Block</span><span class="p">(</span>
                <span class="n">size</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="n">mp</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">mp</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">height_slab</span><span class="p">),</span>
                <span class="n">material</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Medium</span><span class="p">(</span><span class="n">epsilon</span><span class="o">=</span><span class="n">eps_bulk</span><span class="p">)),</span>
        <span class="p">)</span>

        <span class="c1">#atoms    </span>
        <span class="k">if</span> <span class="n">radius_2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">geometry</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mp</span><span class="o">.</span><span class="n">Cylinder</span><span class="p">(</span><span class="n">radius_1</span><span class="p">,</span> 
                                        <span class="n">material</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Medium</span><span class="p">(</span><span class="n">epsilon</span><span class="o">=</span><span class="n">eps_atom_1</span><span class="p">),</span>
                                        <span class="n">height</span><span class="o">=</span><span class="n">height_slab</span><span class="p">))</span>


        <span class="k">else</span><span class="p">:</span>
            <span class="n">geometry</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mp</span><span class="o">.</span><span class="n">Cylinder</span><span class="p">(</span><span class="n">radius_1</span><span class="p">,</span> 
                                        <span class="n">material</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Medium</span><span class="p">(</span><span class="n">epsilon</span><span class="o">=</span><span class="n">eps_atom_1</span><span class="p">),</span>
                                        <span class="n">height</span><span class="o">=</span><span class="n">height_slab</span><span class="p">))</span>
            <span class="n">geometry</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mp</span><span class="o">.</span><span class="n">Cylinder</span><span class="p">(</span><span class="n">radius_2</span><span class="p">,</span> 
                                        <span class="n">material</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Medium</span><span class="p">(</span><span class="n">epsilon</span><span class="o">=</span><span class="n">eps_atom_2</span><span class="p">),</span>
                                        <span class="n">height</span><span class="o">=</span><span class="n">height_slab</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">geometry</span>


    <span class="k">def</span> <span class="nf">ellipsoid_geometry</span><span class="p">(</span><span class="n">e1</span><span class="p">:</span> <span class="nb">float</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
                           <span class="n">e2</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span>
                           <span class="n">eps_atom</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                           <span class="n">height_supercell</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                           <span class="n">height_slab</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                           <span class="n">eps_background</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                           <span class="n">eps_substrate</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                           <span class="n">eps_diag</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span>
                           <span class="n">eps_offdiag</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                           <span class="n">E_chi2_diag</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
                           <span class="n">E_chi3_diag</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
                           <span class="p">)</span><span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>       
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Define an ellipsoid geometry for the photonic crystal.</span>

<span class="sd">        Args:</span>
<span class="sd">            e1 (float): The first radius of the ellipsoid. Default is 0.2.</span>
<span class="sd">            e2 (float): The second radius of the ellipsoid. Default is 0.3.</span>
<span class="sd">            eps_atom (float): The dielectric constant of the atom. Default is 1.</span>
<span class="sd">            height_supercell (float): The height of the supercell. Default is 4.</span>
<span class="sd">            height_slab (float): The height of the slab. Default is 0.5.</span>
<span class="sd">            eps_background (float): The dielectric constant of the background. Default is 1.</span>
<span class="sd">            eps_substrate (float): The dielectric constant of the substrate. Default is 1.</span>
<span class="sd">            eps_diag (mp.Vector3): The diagonal components of the dielectric tensor. Default is (12, 12, 12).</span>
<span class="sd">            eps_offdiag (mp.Vector3): The off-diagonal components of the dielectric tensor. Default is (0, 0, 0).</span>
<span class="sd">            E_chi2_diag (mp.Vector3): The diagonal components of the second-order nonlinear susceptibility tensor. Default is (0, 0, 0).</span>
<span class="sd">            E_chi3_diag (mp.Vector3): The diagonal components of the third-order nonlinear susceptibility tensor. Default is (0, 0, 0).</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: A list of mpb geometric objects defining the photonic crystal.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">geometry</span> <span class="o">=</span> <span class="p">[</span>
            <span class="c1">#background</span>
            <span class="n">mp</span><span class="o">.</span><span class="n">Block</span><span class="p">(</span>
                <span class="n">size</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="n">mp</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">mp</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">height_supercell</span><span class="p">),</span>
                <span class="n">material</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Medium</span><span class="p">(</span><span class="n">epsilon</span><span class="o">=</span><span class="n">eps_background</span><span class="p">)),</span>
            <span class="c1">#substrate</span>
            <span class="n">mp</span><span class="o">.</span><span class="n">Block</span><span class="p">(</span>
                <span class="n">size</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="n">mp</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">mp</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">height_supercell</span><span class="o">*</span><span class="mf">0.5</span><span class="p">),</span>
                <span class="n">center</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">height_supercell</span><span class="o">*</span><span class="mf">0.25</span><span class="p">),</span>
                <span class="n">material</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Medium</span><span class="p">(</span><span class="n">epsilon</span><span class="o">=</span><span class="n">eps_substrate</span><span class="p">)),</span>
            <span class="c1">#slab</span>
            <span class="n">mp</span><span class="o">.</span><span class="n">Block</span><span class="p">(</span>
                <span class="n">size</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="n">mp</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">mp</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">height_slab</span><span class="p">),</span>
                <span class="n">material</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Medium</span><span class="p">(</span><span class="n">epsilon_diag</span><span class="o">=</span><span class="n">eps_diag</span><span class="p">,</span>
                                   <span class="n">epsilon_offdiag</span> <span class="o">=</span> <span class="n">eps_offdiag</span><span class="p">,</span>
                                   <span class="n">E_chi2_diag</span> <span class="o">=</span> <span class="n">E_chi2_diag</span><span class="p">,</span>
                                   <span class="n">E_chi3_diag</span> <span class="o">=</span> <span class="n">E_chi3_diag</span><span class="p">)),</span>
            <span class="c1">#atom</span>
            <span class="n">mp</span><span class="o">.</span><span class="n">Ellipsoid</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="n">e1</span><span class="p">,</span><span class="n">e2</span><span class="p">,</span> <span class="n">mp</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span>
                         <span class="n">material</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Medium</span><span class="p">(</span><span class="n">epsilon</span><span class="o">=</span><span class="n">eps_atom</span><span class="p">),</span>
                         <span class="n">center</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="n">geometry</span>



    <span class="k">def</span> <span class="nf">advanced_material_geometry</span><span class="p">(</span>
        <span class="n">radius_1</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span>
        <span class="n">epsilon_diag</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span>
        <span class="n">epsilon_offdiag</span> <span class="o">=</span>  <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="n">chi2_diag</span> <span class="o">=</span>  <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>  
        <span class="n">chi3_diag</span> <span class="o">=</span>  <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
        <span class="n">eps_atom_1</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> 
        <span class="n">eps_background</span>  <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> 
        <span class="n">eps_substrate</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">height_supercell</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> 
        <span class="n">height_slab</span> <span class="o">=</span> <span class="mf">0.5</span>
    <span class="p">)</span><span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Define an advanced material geometry for the photonic crystal.</span>

<span class="sd">        Args:</span>
<span class="sd">            radius_1 (float): The radius of the atom. Default is 0.2.</span>
<span class="sd">            epsilon_diag (mp.Vector3): The diagonal components of the dielectric tensor. Default is (12, 12, 12).</span>
<span class="sd">            epsilon_offdiag (mp.Vector3): The off-diagonal components of the dielectric tensor. Default is (0, 0, 0).</span>
<span class="sd">            chi2_diag (mp.Vector3): The diagonal components of the second-order nonlinear susceptibility tensor. Default is (0, 0, 0).</span>
<span class="sd">            chi3_diag (mp.Vector3): The diagonal components of the third-order nonlinear susceptibility tensor. Default is (0, 0, 0).</span>
<span class="sd">            eps_atom_1 (float): The dielectric constant of the atom. Default is 1.</span>
<span class="sd">            eps_background (float): The dielectric constant of the background. Default is 1.</span>
<span class="sd">            eps_substrate (float): The dielectric constant of the substrate. Default is 1.</span>
<span class="sd">            height_supercell (float): The height of the supercell. Default is 4.</span>
<span class="sd">            height_slab (float): The height of the slab. Default is 0.5.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: A list of geometric objects defining the photonic crystal.</span>
<span class="sd">        &quot;&quot;&quot;</span>


        <span class="n">geometry</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1">#background</span>
        <span class="n">geometry</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">mp</span><span class="o">.</span><span class="n">Block</span><span class="p">(</span>
                <span class="n">size</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="n">mp</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">mp</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">height_supercell</span><span class="p">),</span>
                <span class="n">material</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Medium</span><span class="p">(</span><span class="n">epsilon</span><span class="o">=</span><span class="n">eps_background</span><span class="p">)),</span>

        <span class="p">)</span>

        <span class="c1">#substrate</span>
        <span class="k">if</span> <span class="n">eps_substrate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">geometry</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mp</span><span class="o">.</span><span class="n">Block</span><span class="p">(</span>
                <span class="n">size</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="n">mp</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">mp</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">height_supercell</span><span class="o">*</span><span class="mf">0.5</span><span class="p">),</span>
                <span class="n">center</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">height_supercell</span><span class="o">*</span><span class="mf">0.25</span><span class="p">),</span>
                <span class="n">material</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Medium</span><span class="p">(</span><span class="n">epsilon</span><span class="o">=</span><span class="n">eps_substrate</span><span class="p">)))</span>

        <span class="c1">#slab</span>
        <span class="n">geometry</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">mp</span><span class="o">.</span><span class="n">Block</span><span class="p">(</span>
                <span class="n">size</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="n">mp</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">mp</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">height_slab</span><span class="p">),</span>
                <span class="n">material</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Medium</span><span class="p">(</span><span class="n">epsilon_diag</span><span class="o">=</span><span class="n">epsilon_diag</span><span class="p">,</span> 
                                   <span class="n">epsilon_offdiag</span> <span class="o">=</span> <span class="n">epsilon_offdiag</span><span class="p">,</span>
                                   <span class="n">E_chi2_diag</span> <span class="o">=</span> <span class="n">chi2_diag</span><span class="p">,</span>
                                   <span class="n">E_chi3_diag</span> <span class="o">=</span> <span class="n">chi3_diag</span><span class="p">,)</span>
                                <span class="p">),</span>
        <span class="p">)</span>

        <span class="c1">#atom 1</span>
        <span class="n">geometry</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mp</span><span class="o">.</span><span class="n">Cylinder</span><span class="p">(</span><span class="n">radius_1</span><span class="p">,</span> 
                                        <span class="n">material</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Medium</span><span class="p">(</span><span class="n">epsilon</span><span class="o">=</span><span class="n">eps_atom_1</span><span class="p">),</span>
                                        <span class="n">height</span><span class="o">=</span><span class="n">height_slab</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">geometry</span>



    <span class="k">def</span> <span class="nf">plot_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
            <span class="n">target_polarization</span><span class="p">,</span> 
            <span class="n">target_k_point</span><span class="p">,</span> 
            <span class="n">target_frequency</span><span class="p">,</span> 
            <span class="n">frequency_tolerance</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span> 
            <span class="n">k_point_max_distance</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">periods</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> 
            <span class="n">component</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> 
            <span class="n">quantity</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;real&quot;</span><span class="p">,</span> 
            <span class="n">colorscale</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;RdBu&#39;</span><span class="p">,</span>                  
            <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the field for a specific mode based on the given parameters.</span>

<span class="sd">        Args:</span>
<span class="sd">            target_polarization (str): The polarization of the target mode.</span>
<span class="sd">            target_k_point (tuple): The k-point of the target mode.</span>
<span class="sd">            target_frequency (float): The frequency of the target mode.</span>
<span class="sd">            frequency_tolerance (float): The tolerance for frequency similarity.</span>
<span class="sd">            periods (int): The number of periods to extract. Default is 1.</span>
<span class="sd">            component (int): The component of the field to plot (0 for x, 1 for y, 2 for z). Default is 2.</span>
<span class="sd">            quantity (str): The quantity to plot (&#39;real&#39;, &#39;imag&#39;, or &#39;abs&#39;). Default is &#39;real&#39;.</span>
<span class="sd">            colorscale (str): The colorscale to use for the plot. Default is &#39;RdBu&#39;.</span>

<span class="sd">        Returns:</span>
<span class="sd">            tuple: A tuple containing the electric field figure and the magnetic field figure.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">target_modes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">look_for_mode</span><span class="p">(</span><span class="n">target_polarization</span><span class="p">,</span> <span class="n">target_k_point</span><span class="p">,</span> <span class="n">target_frequency</span><span class="p">,</span> <span class="n">freq_tolerance</span> <span class="o">=</span> <span class="n">frequency_tolerance</span><span class="p">,</span> <span class="n">k_point_max_distance</span> <span class="o">=</span> <span class="n">k_point_max_distance</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">))</span>

        <span class="k">with</span> <span class="n">suppress_output</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">run_dumb_simulation</span><span class="p">()</span>
            <span class="n">md</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">MPBData</span><span class="p">(</span><span class="n">rectify</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="n">periods</span><span class="p">,</span> <span class="n">lattice</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_lattice</span><span class="p">())</span>
            <span class="n">eps</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_epsilon</span><span class="p">())</span> 

        <span class="n">z_points</span> <span class="o">=</span> <span class="n">eps</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">//</span> <span class="n">periods</span>
        <span class="n">z_mid</span> <span class="o">=</span> <span class="n">eps</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span>

        <span class="c1"># Now take only epsilon in the center of the slab</span>
        <span class="n">eps</span> <span class="o">=</span> <span class="n">eps</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">z_mid</span><span class="p">]</span>
        <span class="c1"># Calculate the midpoint between min and max of the permittivity (eps)</span>
        <span class="n">min_eps</span><span class="p">,</span> <span class="n">max_eps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">eps</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">eps</span><span class="p">)</span>
        <span class="n">midpoint</span> <span class="o">=</span> <span class="p">(</span><span class="n">min_eps</span> <span class="o">+</span> <span class="n">max_eps</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>  <span class="c1"># The level to be plotted</span>

        <span class="n">fig_e</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
        <span class="n">fig_h</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
        <span class="n">dropdown_buttons_e</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">dropdown_buttons_h</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">num_plots</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">mode</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">target_modes</span><span class="p">):</span>
            <span class="c1"># Initialize visibility status: False for all traces</span>
            <span class="n">visible_status_e</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">num_plots</span><span class="p">)</span>  <span class="c1"># Each mode adds two traces</span>
            <span class="n">visible_status_h</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">num_plots</span><span class="p">)</span>

            <span class="n">visible_status_e</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Set the contour plot visible</span>
            <span class="n">visible_status_h</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">visible_status_e</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Set the heatmap visible</span>
            <span class="n">visible_status_h</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Set the heatmap visible</span>

            <span class="n">k_point</span> <span class="o">=</span> <span class="n">mode</span><span class="p">[</span><span class="s2">&quot;k_point&quot;</span><span class="p">]</span>
            <span class="n">freq</span>    <span class="o">=</span> <span class="n">mode</span><span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">]</span>
            <span class="n">polarization</span> <span class="o">=</span> <span class="n">mode</span><span class="p">[</span><span class="s2">&quot;polarization&quot;</span><span class="p">]</span>

            <span class="c1"># Take the specified component of the fields in the center of the slab</span>

            <span class="n">e_field</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">MPBArray</span><span class="p">(</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;e_field&quot;</span><span class="p">],</span> <span class="n">lattice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_lattice</span><span class="p">(),</span>  <span class="n">kpoint</span> <span class="o">=</span> <span class="n">mode</span><span class="p">[</span><span class="s2">&quot;k_point&quot;</span><span class="p">]</span> <span class="p">)</span>
            <span class="n">h_field</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">MPBArray</span><span class="p">(</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;h_field&quot;</span><span class="p">],</span> <span class="n">lattice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_lattice</span><span class="p">(),</span>  <span class="n">kpoint</span> <span class="o">=</span> <span class="n">mode</span><span class="p">[</span><span class="s2">&quot;k_point&quot;</span><span class="p">])</span>
            <span class="n">e_field</span> <span class="o">=</span> <span class="n">e_field</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">z_points</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">component</span><span class="p">]</span>
            <span class="n">h_field</span> <span class="o">=</span> <span class="n">h_field</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">z_points</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">component</span><span class="p">]</span>
            <span class="k">with</span> <span class="n">suppress_output</span><span class="p">():</span>
                <span class="n">e_field</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">e_field</span><span class="p">)</span> 
                <span class="n">h_field</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">h_field</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s2">&quot;real&quot;</span><span class="p">:</span>
                <span class="n">e_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">e_field</span><span class="p">)</span>
                <span class="n">h_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">h_field</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s2">&quot;imag&quot;</span><span class="p">:</span>
                <span class="n">e_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">e_field</span><span class="p">)</span>
                <span class="n">h_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">h_field</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s2">&quot;abs&quot;</span><span class="p">:</span>
                <span class="n">e_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">e_field</span><span class="p">)</span>
                <span class="n">h_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">h_field</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid quantity. Choose &#39;real&#39;, &#39;imag&#39;, or &#39;abs&#39;.&quot;</span><span class="p">)</span>

            <span class="c1"># Add the contour plot for permittivity (eps) at the midpoint</span>
            <span class="n">contour_e</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Contour</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">eps</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
                                <span class="n">contours</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                                    <span class="n">start</span><span class="o">=</span><span class="n">midpoint</span><span class="p">,</span>  <span class="c1"># Start and end at the midpoint to ensure a single level</span>
                                    <span class="n">end</span><span class="o">=</span><span class="n">midpoint</span><span class="p">,</span>
                                    <span class="n">size</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>  <span class="c1"># A small size to keep it as a single contour</span>
                                    <span class="n">coloring</span><span class="o">=</span><span class="s1">&#39;none&#39;</span>  <span class="c1"># No filling</span>
                                <span class="p">),</span>
                                <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>
                                <span class="n">showscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                <span class="n">opacity</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
                                <span class="n">visible</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span>  <span class="mi">0</span>  <span class="k">else</span> <span class="kc">False</span><span class="p">)</span>  <span class="c1"># Only the first mode is visible</span>
            <span class="n">contour_h</span> <span class="o">=</span> <span class="n">contour_e</span>  <span class="c1"># Same contour for H-field figure</span>

            <span class="c1"># Add the contour trace</span>
            <span class="n">fig_e</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">contour_e</span><span class="p">)</span>
            <span class="n">fig_h</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">contour_h</span><span class="p">)</span>

            <span class="c1"># Add the heatmap for the electric field</span>
            <span class="n">heatmap_e</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Heatmap</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">e_field</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscale</span><span class="p">,</span> <span class="n">zsmooth</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span>
                                    <span class="n">showscale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">False</span><span class="p">)</span>
            <span class="c1"># Add the heatmap for the magnetic field</span>
            <span class="n">heatmap_h</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Heatmap</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">h_field</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscale</span><span class="p">,</span> <span class="n">zsmooth</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span>
                                    <span class="n">showscale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">False</span><span class="p">)</span>

            <span class="c1"># Add the heatmap trace</span>
            <span class="n">fig_e</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">heatmap_e</span><span class="p">)</span>
            <span class="n">fig_h</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">heatmap_h</span><span class="p">)</span>



            <span class="n">data_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Mode </span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2"> &lt;br&gt; k = [</span><span class="si">{</span><span class="n">k_point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">0.2f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">k_point</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">0.2f</span><span class="si">}</span><span class="s2">], freq=</span><span class="si">{</span><span class="n">freq</span><span class="si">:</span><span class="s2">0.3f</span><span class="si">}</span><span class="s2">, polarization=</span><span class="si">{</span><span class="n">polarization</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="n">component</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> 
                <span class="n">component_str</span> <span class="o">=</span> <span class="s2">&quot;x-component&quot;</span>
            <span class="k">elif</span> <span class="n">component</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">component_str</span> <span class="o">=</span> <span class="s2">&quot;y-component&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">component_str</span> <span class="o">=</span> <span class="s2">&quot;z-component&quot;</span>
            <span class="n">subtitle_e</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;E-field, </span><span class="si">{</span><span class="n">component_str</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">quantity</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">subtitle_h</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;H-field, </span><span class="si">{</span><span class="n">component_str</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">quantity</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="c1"># Create a button for each field dataset for the dropdown</span>
            <span class="n">dropdown_buttons_e</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mode </span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                                        <span class="n">method</span><span class="o">=</span><span class="s1">&#39;update&#39;</span><span class="p">,</span>
                                        <span class="n">args</span><span class="o">=</span><span class="p">[{</span><span class="s1">&#39;visible&#39;</span><span class="p">:</span> <span class="n">visible_status_e</span><span class="p">},</span>  <span class="c1"># Update visibility for both eps and field</span>
                                            <span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">data_str</span><span class="si">}</span><span class="s2">:&lt;br&gt; </span><span class="si">{</span><span class="n">subtitle_e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}</span>
                                        <span class="p">]))</span>
            <span class="n">dropdown_buttons_h</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mode </span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                                        <span class="n">method</span><span class="o">=</span><span class="s1">&#39;update&#39;</span><span class="p">,</span>
                                        <span class="n">args</span><span class="o">=</span><span class="p">[{</span><span class="s1">&#39;visible&#39;</span><span class="p">:</span> <span class="n">visible_status_h</span><span class="p">},</span>  <span class="c1"># Update visibility for both eps and field</span>
                                            <span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">data_str</span><span class="si">}</span><span class="s2">:&lt;br&gt; </span><span class="si">{</span><span class="n">subtitle_h</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}</span>
                                        <span class="p">]))</span>

        <span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">))</span>
        <span class="n">k_point</span> <span class="o">=</span> <span class="n">target_modes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;k_point&quot;</span><span class="p">]</span>
        <span class="n">freq</span>    <span class="o">=</span> <span class="n">target_modes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;freq&quot;</span><span class="p">]</span>
        <span class="n">data_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Mode </span><span class="si">{</span><span class="mi">0</span><span class="si">}</span><span class="s2"> &lt;br&gt; k = [</span><span class="si">{</span><span class="n">k_point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">0.2f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">k_point</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">0.2f</span><span class="si">}</span><span class="s2">], freq=</span><span class="si">{</span><span class="n">freq</span><span class="si">:</span><span class="s2">0.3f</span><span class="si">}</span><span class="s2">, polarization=</span><span class="si">{</span><span class="n">polarization</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">fig_e</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
            <span class="n">updatemenus</span><span class="o">=</span><span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="n">active</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                            <span class="n">buttons</span><span class="o">=</span><span class="n">dropdown_buttons_e</span><span class="p">,</span>
                            <span class="n">x</span><span class="o">=</span><span class="mf">1.15</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.15</span><span class="p">,</span>
                            <span class="n">xanchor</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">yanchor</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)],</span>
            <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">data_str</span><span class="si">}</span><span class="s2">:&lt;br&gt; </span><span class="si">{</span><span class="n">subtitle_e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">xaxis_showgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">yaxis_showgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">xaxis_zeroline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">yaxis_zeroline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">xaxis_visible</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">yaxis_visible</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">hovermode</span><span class="o">=</span><span class="s2">&quot;closest&quot;</span><span class="p">,</span>
            <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
            <span class="n">xaxis_title</span><span class="o">=</span><span class="s2">&quot;X&quot;</span><span class="p">,</span>
            <span class="n">yaxis_title</span><span class="o">=</span><span class="s2">&quot;Y&quot;</span>

        <span class="p">)</span>

        <span class="n">fig_h</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
            <span class="n">updatemenus</span><span class="o">=</span><span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="n">active</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                            <span class="n">buttons</span><span class="o">=</span><span class="n">dropdown_buttons_h</span><span class="p">,</span>
                            <span class="n">x</span><span class="o">=</span><span class="mf">1.15</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.15</span><span class="p">,</span>
                            <span class="n">xanchor</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">yanchor</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)],</span>
            <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">data_str</span><span class="si">}</span><span class="s2">:&lt;br&gt; </span><span class="si">{</span><span class="n">subtitle_h</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">xaxis_showgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">yaxis_showgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">xaxis_zeroline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">yaxis_zeroline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">xaxis_visible</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">yaxis_visible</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">hovermode</span><span class="o">=</span><span class="s2">&quot;closest&quot;</span><span class="p">,</span>
            <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
            <span class="n">xaxis_title</span><span class="o">=</span><span class="s2">&quot;X&quot;</span><span class="p">,</span>
            <span class="n">yaxis_title</span><span class="o">=</span><span class="s2">&quot;Y&quot;</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">fig_e</span><span class="p">,</span> <span class="n">fig_h</span>



    <span class="k">def</span> <span class="nf">plot_field_components</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                            <span class="n">target_polarization</span><span class="p">,</span>
                            <span class="n">target_k_point</span><span class="p">,</span>
                            <span class="n">target_frequency</span><span class="p">,</span>
                            <span class="n">frequency_tolerance</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
                            <span class="n">k_point_max_distance</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                            <span class="n">periods</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                            <span class="n">quantity</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;real&quot;</span><span class="p">,</span>
                            <span class="n">colorscale</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;RdBu&#39;</span><span class="p">,</span>
                            <span class="p">)</span><span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the field components (Ex, Ey, Ez) and (Hx, Hy, Hz) for specific modes with consistent color scales.</span>

<span class="sd">        Args:</span>
<span class="sd">            target_polarization (str): The polarization of the target mode.</span>
<span class="sd">            target_k_point (tuple): The k-point of the target mode.</span>
<span class="sd">            target_frequency (float): The frequency of the target mode.</span>
<span class="sd">            frequency_tolerance (float): The tolerance for frequency similarity.</span>
<span class="sd">            periods (int): The number of periods to extract. Default is 1.</span>
<span class="sd">            quantity (str): The quantity to plot (&#39;real&#39;, &#39;imag&#39;, or &#39;abs&#39;). Default is &#39;real&#39;.</span>
<span class="sd">            colorscale (str): The colorscale to use for the plot. Default is &#39;RdBu&#39;.</span>

<span class="sd">        Returns:</span>
<span class="sd">            tuple: A tuple containing the electric field figure and the magnetic field figure.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">target_modes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">look_for_mode</span><span class="p">(</span><span class="n">target_polarization</span><span class="p">,</span> <span class="n">target_k_point</span><span class="p">,</span> <span class="n">target_frequency</span><span class="p">,</span>
                                        <span class="n">freq_tolerance</span><span class="o">=</span><span class="n">frequency_tolerance</span><span class="p">,</span> <span class="n">k_point_max_distance</span><span class="o">=</span><span class="n">k_point_max_distance</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of target modes found: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">suppress_output</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">run_dumb_simulation</span><span class="p">()</span>
            <span class="n">md</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">MPBData</span><span class="p">(</span><span class="n">rectify</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="n">periods</span><span class="p">,</span> <span class="n">lattice</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_lattice</span><span class="p">())</span>
            <span class="n">eps</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_epsilon</span><span class="p">())</span>

        <span class="n">z_points</span> <span class="o">=</span> <span class="n">eps</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">//</span> <span class="n">periods</span>
        <span class="n">z_mid</span> <span class="o">=</span> <span class="n">eps</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span>

        <span class="c1"># Now take only epsilon in the center of the slab</span>
        <span class="n">eps</span> <span class="o">=</span> <span class="n">eps</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">z_mid</span><span class="p">]</span>
        <span class="c1"># Calculate the midpoint between min and max of the permittivity (eps)</span>
        <span class="n">min_eps</span><span class="p">,</span> <span class="n">max_eps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">eps</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">eps</span><span class="p">)</span>
        <span class="n">midpoint</span> <span class="o">=</span> <span class="p">(</span><span class="n">min_eps</span> <span class="o">+</span> <span class="n">max_eps</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>  <span class="c1"># The level to be plotted</span>

        <span class="n">fig_e</span> <span class="o">=</span> <span class="n">make_subplots</span><span class="p">(</span><span class="n">rows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">subplot_titles</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Ex&quot;</span><span class="p">,</span> <span class="s2">&quot;Ey&quot;</span><span class="p">,</span> <span class="s2">&quot;Ez&quot;</span><span class="p">))</span>
        <span class="n">fig_h</span> <span class="o">=</span> <span class="n">make_subplots</span><span class="p">(</span><span class="n">rows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">subplot_titles</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Hx&quot;</span><span class="p">,</span> <span class="s2">&quot;Hy&quot;</span><span class="p">,</span> <span class="s2">&quot;Hz&quot;</span><span class="p">))</span>
        <span class="n">dropdown_buttons_e</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">dropdown_buttons_h</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># For each mode, calculate separate min and max values for Ex, Ey, Ez (and similarly Hx, Hy, Hz)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">mode</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">target_modes</span><span class="p">):</span>
            <span class="c1"># Get field arrays for this mode</span>
            <span class="n">e_field_array</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">MPBArray</span><span class="p">(</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;e_field&quot;</span><span class="p">],</span> <span class="n">lattice</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_lattice</span><span class="p">(),</span> <span class="n">kpoint</span><span class="o">=</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;k_point&quot;</span><span class="p">])</span>
            <span class="n">h_field_array</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">MPBArray</span><span class="p">(</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;h_field&quot;</span><span class="p">],</span> <span class="n">lattice</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_lattice</span><span class="p">(),</span> <span class="n">kpoint</span><span class="o">=</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;k_point&quot;</span><span class="p">])</span>

            <span class="c1"># Extract field components in the center of the slab</span>
            <span class="n">e_field_x</span> <span class="o">=</span> <span class="n">e_field_array</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">z_points</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>  <span class="c1"># Shape (Nx, Ny)</span>
            <span class="n">e_field_y</span> <span class="o">=</span> <span class="n">e_field_array</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">z_points</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># Shape (Nx, Ny)</span>
            <span class="n">e_field_z</span> <span class="o">=</span> <span class="n">e_field_array</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">z_points</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>  <span class="c1"># Shape (Nx, Ny)</span>
            <span class="n">h_field_x</span> <span class="o">=</span> <span class="n">h_field_array</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">z_points</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>  <span class="c1"># Shape (Nx, Ny)</span>
            <span class="n">h_field_y</span> <span class="o">=</span> <span class="n">h_field_array</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">z_points</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># Shape (Nx, Ny)</span>
            <span class="n">h_field_z</span> <span class="o">=</span> <span class="n">h_field_array</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">z_points</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>  <span class="c1"># Shape (Nx, Ny)</span>

            <span class="k">with</span> <span class="n">suppress_output</span><span class="p">():</span>
                <span class="n">e_field_x</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">e_field_x</span><span class="p">)</span>
                <span class="n">e_field_y</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">e_field_y</span><span class="p">)</span>
                <span class="n">e_field_z</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">e_field_z</span><span class="p">)</span>
                <span class="n">h_field_x</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">h_field_x</span><span class="p">)</span>
                <span class="n">h_field_y</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">h_field_y</span><span class="p">)</span>
                <span class="n">h_field_z</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">h_field_z</span><span class="p">)</span>

            <span class="n">e_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">e_field_x</span><span class="p">,</span> <span class="n">e_field_y</span><span class="p">,</span> <span class="n">e_field_z</span><span class="p">],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">h_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">h_field_x</span><span class="p">,</span> <span class="n">h_field_y</span><span class="p">,</span> <span class="n">h_field_z</span><span class="p">],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>                                    

            <span class="c1"># Select quantity to display (real, imag, abs)</span>
            <span class="k">if</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s2">&quot;real&quot;</span><span class="p">:</span>
                <span class="n">e_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">e_field</span><span class="p">)</span>
                <span class="n">h_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">h_field</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s2">&quot;imag&quot;</span><span class="p">:</span>
                <span class="n">e_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">e_field</span><span class="p">)</span>
                <span class="n">h_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">h_field</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s2">&quot;abs&quot;</span><span class="p">:</span>
                <span class="n">e_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">e_field</span><span class="p">)</span>
                <span class="n">h_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">h_field</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid quantity. Choose &#39;real&#39;, &#39;imag&#39;, or &#39;abs&#39;.&quot;</span><span class="p">)</span>

            <span class="c1"># Calculate the component-specific min/max for E and H fields of this mode</span>
            <span class="n">e_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">e_field</span><span class="p">)</span>
            <span class="n">e_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">e_field</span><span class="p">)</span>
            <span class="n">h_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">h_field</span><span class="p">)</span>
            <span class="n">h_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">h_field</span><span class="p">)</span>

            <span class="c1"># Components of the E and H fields</span>
            <span class="n">Ex</span><span class="p">,</span> <span class="n">Ey</span><span class="p">,</span> <span class="n">Ez</span> <span class="o">=</span> <span class="n">e_field</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">e_field</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">e_field</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
            <span class="n">Hx</span><span class="p">,</span> <span class="n">Hy</span><span class="p">,</span> <span class="n">Hz</span> <span class="o">=</span> <span class="n">h_field</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">h_field</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">h_field</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>

            <span class="c1"># Define visibility settings per mode, including contours as always visible</span>
            <span class="n">visible_status_e</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span> <span class="o">*</span> <span class="mi">6</span><span class="p">)</span>  <span class="c1"># 3 components per mode, with contour for each</span>
            <span class="n">visible_status_h</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span> <span class="o">*</span> <span class="mi">6</span><span class="p">)</span>
            <span class="c1"># Make the contour visible by default</span>




            <span class="c1"># Make this mode&#39;s components and the corresponding contour visible in the initial layout </span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span>
                <span class="n">visible_status_e</span><span class="p">[</span><span class="mi">6</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">visible_status_h</span><span class="p">[</span><span class="mi">6</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>


            <span class="c1"># Add contour traces for permittivity to each subplot of fig_e and fig_h for this mode</span>
            <span class="n">fig_e</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Contour</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">eps</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">contours</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">midpoint</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">midpoint</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">coloring</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">),</span> <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span> <span class="n">showscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="kc">False</span><span class="p">),</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">fig_e</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Contour</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">eps</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">contours</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">midpoint</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">midpoint</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">coloring</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">),</span> <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span> <span class="n">showscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="kc">False</span><span class="p">),</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">fig_e</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Contour</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">eps</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">contours</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">midpoint</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">midpoint</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">coloring</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">),</span> <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span> <span class="n">showscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="kc">False</span><span class="p">),</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

            <span class="n">fig_h</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Contour</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">eps</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">contours</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">midpoint</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">midpoint</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">coloring</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">),</span> <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span> <span class="n">showscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="kc">False</span><span class="p">),</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">fig_h</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Contour</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">eps</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">contours</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">midpoint</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">midpoint</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">coloring</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">),</span> <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span> <span class="n">showscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="kc">False</span><span class="p">),</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">fig_h</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Contour</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">eps</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">contours</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">midpoint</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">midpoint</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">coloring</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">),</span> <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span> <span class="n">showscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="kc">False</span><span class="p">),</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

            <span class="c1"># Add Ex, Ey, Ez with shared colorbar limits for the E field of this mode</span>
            <span class="n">fig_e</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Heatmap</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">Ex</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscale</span><span class="p">,</span> <span class="n">showscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">zmin</span><span class="o">=</span><span class="n">e_min</span><span class="p">,</span> <span class="n">zmax</span><span class="o">=</span><span class="n">e_max</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="kc">False</span><span class="p">,</span> <span class="n">zsmooth</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.8</span><span class="p">),</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">fig_e</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Heatmap</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">Ey</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscale</span><span class="p">,</span> <span class="n">showscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">zmin</span><span class="o">=</span><span class="n">e_min</span><span class="p">,</span> <span class="n">zmax</span><span class="o">=</span><span class="n">e_max</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="kc">False</span><span class="p">,</span> <span class="n">zsmooth</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.8</span><span class="p">),</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">fig_e</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Heatmap</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">Ez</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscale</span><span class="p">,</span> <span class="n">showscale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;E-field&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">thickness</span><span class="o">=</span><span class="mi">15</span><span class="p">),</span> <span class="n">zmin</span><span class="o">=</span><span class="n">e_min</span><span class="p">,</span> <span class="n">zmax</span><span class="o">=</span><span class="n">e_max</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="kc">False</span><span class="p">,</span> <span class="n">zsmooth</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.8</span><span class="p">),</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

            <span class="c1"># Add Hx, Hy, Hz with shared colorbar limits for the H field of this mode</span>
            <span class="n">fig_h</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Heatmap</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">Hx</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscale</span><span class="p">,</span> <span class="n">showscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">zmin</span><span class="o">=</span><span class="n">h_min</span><span class="p">,</span> <span class="n">zmax</span><span class="o">=</span><span class="n">h_max</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="kc">False</span><span class="p">,</span> <span class="n">zsmooth</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.8</span><span class="p">),</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">fig_h</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Heatmap</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">Hy</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscale</span><span class="p">,</span> <span class="n">showscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">zmin</span><span class="o">=</span><span class="n">h_min</span><span class="p">,</span> <span class="n">zmax</span><span class="o">=</span><span class="n">h_max</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="kc">False</span><span class="p">,</span> <span class="n">zsmooth</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.8</span><span class="p">),</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">fig_h</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Heatmap</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">Hz</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscale</span><span class="p">,</span> <span class="n">showscale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;H-field&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">thickness</span><span class="o">=</span><span class="mi">15</span><span class="p">),</span> <span class="n">zmin</span><span class="o">=</span><span class="n">h_min</span><span class="p">,</span> <span class="n">zmax</span><span class="o">=</span><span class="n">h_max</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="kc">False</span><span class="p">,</span> <span class="n">zsmooth</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.8</span><span class="p">),</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>



            <span class="c1"># Dropdown data for E-field</span>
            <span class="n">k_point</span> <span class="o">=</span> <span class="n">mode</span><span class="p">[</span><span class="s2">&quot;k_point&quot;</span><span class="p">]</span>
            <span class="n">freq</span> <span class="o">=</span> <span class="n">mode</span><span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">]</span>
            <span class="n">polarization</span> <span class="o">=</span> <span class="n">mode</span><span class="p">[</span><span class="s2">&quot;polarization&quot;</span><span class="p">]</span>
            <span class="n">mode_description</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Mode </span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&lt;br&gt;k = [</span><span class="si">{</span><span class="n">k_point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">0.2f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">k_point</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">0.2f</span><span class="si">}</span><span class="s2">], freq=</span><span class="si">{</span><span class="n">freq</span><span class="si">:</span><span class="s2">0.3f</span><span class="si">}</span><span class="s2">, polarization=</span><span class="si">{</span><span class="n">polarization</span><span class="si">}</span><span class="s2">&quot;</span>

            <span class="n">dropdown_buttons_e</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="nb">dict</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Mode </span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">method</span><span class="o">=</span><span class="s1">&#39;update&#39;</span><span class="p">,</span>
                    <span class="n">args</span><span class="o">=</span><span class="p">[{</span><span class="s1">&#39;visible&#39;</span><span class="p">:</span> <span class="n">visible_status_e</span><span class="p">},</span>
                        <span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mode_description</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">quantity</span><span class="si">}</span><span class="s2"> of E-field components&quot;</span><span class="p">}]))</span>

            <span class="n">dropdown_buttons_h</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="nb">dict</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Mode </span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">method</span><span class="o">=</span><span class="s1">&#39;update&#39;</span><span class="p">,</span>
                    <span class="n">args</span><span class="o">=</span><span class="p">[{</span><span class="s1">&#39;visible&#39;</span><span class="p">:</span> <span class="n">visible_status_h</span><span class="p">},</span>
                        <span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mode_description</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">quantity</span><span class="si">}</span><span class="s2"> of H-field components&quot;</span><span class="p">}]))</span>

        <span class="c1"># Layout and color settings</span>
        <span class="n">fig_e</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mode_description</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">quantity</span><span class="si">}</span><span class="s2"> of E-field components&quot;</span><span class="p">,</span>
            <span class="n">updatemenus</span><span class="o">=</span><span class="p">[</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">active</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                <span class="n">buttons</span><span class="o">=</span><span class="n">dropdown_buttons_e</span><span class="p">)],</span>
            <span class="n">coloraxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">colorbar</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)),</span>
            <span class="n">width</span><span class="o">=</span><span class="mi">1200</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span>
            <span class="n">xaxis_showgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">yaxis_showgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">xaxis_zeroline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">yaxis_zeroline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">hovermode</span><span class="o">=</span><span class="s2">&quot;closest&quot;</span>
        <span class="p">)</span>

        <span class="n">fig_h</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mode_description</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">quantity</span><span class="si">}</span><span class="s2"> of H-field components&quot;</span><span class="p">,</span>
            <span class="n">updatemenus</span><span class="o">=</span><span class="p">[</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">active</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                <span class="n">buttons</span><span class="o">=</span><span class="n">dropdown_buttons_h</span><span class="p">)],</span>
            <span class="n">coloraxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">colorbar</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)),</span>
            <span class="n">width</span><span class="o">=</span><span class="mi">1200</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span>
            <span class="n">xaxis_showgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">yaxis_showgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">xaxis_zeroline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">yaxis_zeroline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">hovermode</span><span class="o">=</span><span class="s2">&quot;closest&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Final adjustments</span>
        <span class="n">fig_e</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">showticklabels</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">fig_e</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">showticklabels</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">fig_h</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">showticklabels</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">fig_h</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">showticklabels</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">fig_e</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">yaxis_scaleanchor</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">yaxis_scaleratio</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">fig_h</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">yaxis_scaleanchor</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">yaxis_scaleratio</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">fig_e</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">yaxis2_scaleanchor</span><span class="o">=</span><span class="s2">&quot;x2&quot;</span><span class="p">,</span> <span class="n">yaxis2_scaleratio</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">fig_h</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">yaxis2_scaleanchor</span><span class="o">=</span><span class="s2">&quot;x2&quot;</span><span class="p">,</span> <span class="n">yaxis2_scaleratio</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">fig_e</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">yaxis3_scaleanchor</span><span class="o">=</span><span class="s2">&quot;x3&quot;</span><span class="p">,</span> <span class="n">yaxis3_scaleratio</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">fig_h</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">yaxis3_scaleanchor</span><span class="o">=</span><span class="s2">&quot;x3&quot;</span><span class="p">,</span> <span class="n">yaxis3_scaleratio</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>


        <span class="n">fig_e</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;X-axis&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">fig_e</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;Y-axis&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">fig_e</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;X-axis&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">fig_e</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;Y-axis&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">fig_e</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;X-axis&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">fig_e</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;Y-axis&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

        <span class="n">fig_h</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;X-axis&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">fig_h</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;Y-axis&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">fig_h</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;X-axis&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">fig_h</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;Y-axis&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">fig_h</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;X-axis&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">fig_h</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;Y-axis&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fig_e</span><span class="p">,</span> <span class="n">fig_h</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="src.photonic_crystal.CrystalSlab.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">lattice_type</span><span class="o">=</span><span class="s1">&#39;square&#39;</span><span class="p">,</span> <span class="n">num_bands</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">16</span><span class="p">),</span> <span class="n">interp</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">pickle_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">use_XY</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">k_point_max</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Initializes the CrystalSlab object with the given parameters.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>lattice_type</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The type of lattice. It can be 'square' or 'triangular'. Default is 'square'.</p>
              </div>
            </td>
            <td>
                  <code>&#39;square&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_bands</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of bands to calculate. Default is 4.</p>
              </div>
            </td>
            <td>
                  <code>4</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>resolution</code>
            </td>
            <td>
                  <code><span title="meep.Vector3">Vector3</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The resolution of the simulation. Default is mp.Vector3(32, 32, 16).</p>
              </div>
            </td>
            <td>
                  <code><span title="meep.Vector3">Vector3</span>(32, 32, 16)</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>interp</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The interpolation factor for k-points. Default is 2.</p>
              </div>
            </td>
            <td>
                  <code>2</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>periods</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of periods to use in some plotting functions. Default is 3.</p>
              </div>
            </td>
            <td>
                  <code>3</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pickle_id</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The ID for pickling the simulation. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>geometry</code>
            </td>
            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The geometry of the photonic crystal. Default is None. If it is none, the basic geometry is used.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>use_XY</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to use the X and Y directions for the x-axis or high symmetry points. Default is True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>k_point_max</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The maximum k-point value. Default is 0.2.</p>
              </div>
            </td>
            <td>
                  <code>0.2</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/photonic_crystal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">lattice_type</span> <span class="o">=</span> <span class="s2">&quot;square&quot;</span><span class="p">,</span>
            <span class="n">num_bands</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
            <span class="n">resolution</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">16</span><span class="p">),</span>
            <span class="n">interp</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">periods</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span><span class="mi">3</span><span class="p">,</span> 
            <span class="n">pickle_id</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">geometry</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
            <span class="n">use_XY</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="n">k_point_max</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initializes the CrystalSlab object with the given parameters.</span>

<span class="sd">    Args:</span>
<span class="sd">        lattice_type (str): The type of lattice. It can be &#39;square&#39; or &#39;triangular&#39;. Default is &#39;square&#39;.</span>
<span class="sd">        num_bands (int): The number of bands to calculate. Default is 4.</span>
<span class="sd">        resolution (mp.Vector3): The resolution of the simulation. Default is mp.Vector3(32, 32, 16).</span>
<span class="sd">        interp (int): The interpolation factor for k-points. Default is 2.</span>
<span class="sd">        periods (int): The number of periods to use in some plotting functions. Default is 3.</span>
<span class="sd">        pickle_id (str): The ID for pickling the simulation. Default is None.</span>
<span class="sd">        geometry (list): The geometry of the photonic crystal. Default is None. If it is none, the basic geometry is used.</span>
<span class="sd">        use_XY (bool): Whether to use the X and Y directions for the x-axis or high symmetry points. Default is True.</span>
<span class="sd">        k_point_max (float): The maximum k-point value. Default is 0.2.</span>
<span class="sd">    &quot;&quot;&quot;</span>


    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">lattice_type</span><span class="p">,</span> <span class="n">num_bands</span><span class="p">,</span> <span class="n">resolution</span><span class="p">,</span> <span class="n">interp</span><span class="p">,</span> <span class="n">periods</span><span class="p">,</span> <span class="n">pickle_id</span><span class="p">,</span> <span class="n">use_XY</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


    <span class="bp">self</span><span class="o">.</span><span class="n">geometry_lattice</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">basic_lattice</span><span class="p">(</span><span class="n">lattice_type</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">use_XY</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">k_points</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="n">k_point_max</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>      <span class="c1"># X</span>
            <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">),</span>               <span class="c1"># Gamma</span>
            <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">k_point_max</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>       <span class="c1"># Y</span>
        <span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">geometry</span> <span class="o">=</span> <span class="n">geometry</span> <span class="k">if</span> <span class="n">geometry</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">basic_geometry</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">k_points_interpolated</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">interp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_points</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.photonic_crystal.CrystalSlab.advanced_material_geometry" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">advanced_material_geometry</span><span class="p">(</span><span class="n">radius_1</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">epsilon_diag</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span> <span class="n">epsilon_offdiag</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">chi2_diag</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">chi3_diag</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">eps_atom_1</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">eps_background</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">eps_substrate</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">height_supercell</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">height_slab</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Define an advanced material geometry for the photonic crystal.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>radius_1</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The radius of the atom. Default is 0.2.</p>
              </div>
            </td>
            <td>
                  <code>0.2</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>epsilon_diag</code>
            </td>
            <td>
                  <code><span title="meep.Vector3">Vector3</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The diagonal components of the dielectric tensor. Default is (12, 12, 12).</p>
              </div>
            </td>
            <td>
                  <code><span title="meep.Vector3">Vector3</span>(12, 12, 12)</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>epsilon_offdiag</code>
            </td>
            <td>
                  <code><span title="meep.Vector3">Vector3</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The off-diagonal components of the dielectric tensor. Default is (0, 0, 0).</p>
              </div>
            </td>
            <td>
                  <code><span title="meep.Vector3">Vector3</span>(0, 0, 0)</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>chi2_diag</code>
            </td>
            <td>
                  <code><span title="meep.Vector3">Vector3</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The diagonal components of the second-order nonlinear susceptibility tensor. Default is (0, 0, 0).</p>
              </div>
            </td>
            <td>
                  <code><span title="meep.Vector3">Vector3</span>(0, 0, 0)</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>chi3_diag</code>
            </td>
            <td>
                  <code><span title="meep.Vector3">Vector3</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The diagonal components of the third-order nonlinear susceptibility tensor. Default is (0, 0, 0).</p>
              </div>
            </td>
            <td>
                  <code><span title="meep.Vector3">Vector3</span>(0, 0, 0)</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>eps_atom_1</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The dielectric constant of the atom. Default is 1.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>eps_background</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The dielectric constant of the background. Default is 1.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>eps_substrate</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The dielectric constant of the substrate. Default is 1.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>height_supercell</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The height of the supercell. Default is 4.</p>
              </div>
            </td>
            <td>
                  <code>4</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>height_slab</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The height of the slab. Default is 0.5.</p>
              </div>
            </td>
            <td>
                  <code>0.5</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>list</code></td>            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of geometric objects defining the photonic crystal.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/photonic_crystal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1656</span>
<span class="normal">1657</span>
<span class="normal">1658</span>
<span class="normal">1659</span>
<span class="normal">1660</span>
<span class="normal">1661</span>
<span class="normal">1662</span>
<span class="normal">1663</span>
<span class="normal">1664</span>
<span class="normal">1665</span>
<span class="normal">1666</span>
<span class="normal">1667</span>
<span class="normal">1668</span>
<span class="normal">1669</span>
<span class="normal">1670</span>
<span class="normal">1671</span>
<span class="normal">1672</span>
<span class="normal">1673</span>
<span class="normal">1674</span>
<span class="normal">1675</span>
<span class="normal">1676</span>
<span class="normal">1677</span>
<span class="normal">1678</span>
<span class="normal">1679</span>
<span class="normal">1680</span>
<span class="normal">1681</span>
<span class="normal">1682</span>
<span class="normal">1683</span>
<span class="normal">1684</span>
<span class="normal">1685</span>
<span class="normal">1686</span>
<span class="normal">1687</span>
<span class="normal">1688</span>
<span class="normal">1689</span>
<span class="normal">1690</span>
<span class="normal">1691</span>
<span class="normal">1692</span>
<span class="normal">1693</span>
<span class="normal">1694</span>
<span class="normal">1695</span>
<span class="normal">1696</span>
<span class="normal">1697</span>
<span class="normal">1698</span>
<span class="normal">1699</span>
<span class="normal">1700</span>
<span class="normal">1701</span>
<span class="normal">1702</span>
<span class="normal">1703</span>
<span class="normal">1704</span>
<span class="normal">1705</span>
<span class="normal">1706</span>
<span class="normal">1707</span>
<span class="normal">1708</span>
<span class="normal">1709</span>
<span class="normal">1710</span>
<span class="normal">1711</span>
<span class="normal">1712</span>
<span class="normal">1713</span>
<span class="normal">1714</span>
<span class="normal">1715</span>
<span class="normal">1716</span>
<span class="normal">1717</span>
<span class="normal">1718</span>
<span class="normal">1719</span>
<span class="normal">1720</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">advanced_material_geometry</span><span class="p">(</span>
    <span class="n">radius_1</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span>
    <span class="n">epsilon_diag</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span>
    <span class="n">epsilon_offdiag</span> <span class="o">=</span>  <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">chi2_diag</span> <span class="o">=</span>  <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>  
    <span class="n">chi3_diag</span> <span class="o">=</span>  <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
    <span class="n">eps_atom_1</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> 
    <span class="n">eps_background</span>  <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> 
    <span class="n">eps_substrate</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">height_supercell</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> 
    <span class="n">height_slab</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="p">)</span><span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Define an advanced material geometry for the photonic crystal.</span>

<span class="sd">    Args:</span>
<span class="sd">        radius_1 (float): The radius of the atom. Default is 0.2.</span>
<span class="sd">        epsilon_diag (mp.Vector3): The diagonal components of the dielectric tensor. Default is (12, 12, 12).</span>
<span class="sd">        epsilon_offdiag (mp.Vector3): The off-diagonal components of the dielectric tensor. Default is (0, 0, 0).</span>
<span class="sd">        chi2_diag (mp.Vector3): The diagonal components of the second-order nonlinear susceptibility tensor. Default is (0, 0, 0).</span>
<span class="sd">        chi3_diag (mp.Vector3): The diagonal components of the third-order nonlinear susceptibility tensor. Default is (0, 0, 0).</span>
<span class="sd">        eps_atom_1 (float): The dielectric constant of the atom. Default is 1.</span>
<span class="sd">        eps_background (float): The dielectric constant of the background. Default is 1.</span>
<span class="sd">        eps_substrate (float): The dielectric constant of the substrate. Default is 1.</span>
<span class="sd">        height_supercell (float): The height of the supercell. Default is 4.</span>
<span class="sd">        height_slab (float): The height of the slab. Default is 0.5.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: A list of geometric objects defining the photonic crystal.</span>
<span class="sd">    &quot;&quot;&quot;</span>


    <span class="n">geometry</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1">#background</span>
    <span class="n">geometry</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">mp</span><span class="o">.</span><span class="n">Block</span><span class="p">(</span>
            <span class="n">size</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="n">mp</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">mp</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">height_supercell</span><span class="p">),</span>
            <span class="n">material</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Medium</span><span class="p">(</span><span class="n">epsilon</span><span class="o">=</span><span class="n">eps_background</span><span class="p">)),</span>

    <span class="p">)</span>

    <span class="c1">#substrate</span>
    <span class="k">if</span> <span class="n">eps_substrate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">geometry</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mp</span><span class="o">.</span><span class="n">Block</span><span class="p">(</span>
            <span class="n">size</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="n">mp</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">mp</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">height_supercell</span><span class="o">*</span><span class="mf">0.5</span><span class="p">),</span>
            <span class="n">center</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">height_supercell</span><span class="o">*</span><span class="mf">0.25</span><span class="p">),</span>
            <span class="n">material</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Medium</span><span class="p">(</span><span class="n">epsilon</span><span class="o">=</span><span class="n">eps_substrate</span><span class="p">)))</span>

    <span class="c1">#slab</span>
    <span class="n">geometry</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">mp</span><span class="o">.</span><span class="n">Block</span><span class="p">(</span>
            <span class="n">size</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="n">mp</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">mp</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">height_slab</span><span class="p">),</span>
            <span class="n">material</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Medium</span><span class="p">(</span><span class="n">epsilon_diag</span><span class="o">=</span><span class="n">epsilon_diag</span><span class="p">,</span> 
                               <span class="n">epsilon_offdiag</span> <span class="o">=</span> <span class="n">epsilon_offdiag</span><span class="p">,</span>
                               <span class="n">E_chi2_diag</span> <span class="o">=</span> <span class="n">chi2_diag</span><span class="p">,</span>
                               <span class="n">E_chi3_diag</span> <span class="o">=</span> <span class="n">chi3_diag</span><span class="p">,)</span>
                            <span class="p">),</span>
    <span class="p">)</span>

    <span class="c1">#atom 1</span>
    <span class="n">geometry</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mp</span><span class="o">.</span><span class="n">Cylinder</span><span class="p">(</span><span class="n">radius_1</span><span class="p">,</span> 
                                    <span class="n">material</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Medium</span><span class="p">(</span><span class="n">epsilon</span><span class="o">=</span><span class="n">eps_atom_1</span><span class="p">),</span>
                                    <span class="n">height</span><span class="o">=</span><span class="n">height_slab</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">geometry</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.photonic_crystal.CrystalSlab.basic_geometry" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">basic_geometry</span><span class="p">(</span><span class="n">radius_1</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">eps_atom_1</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">radius_2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">eps_atom_2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">eps_bulk</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">height_supercell</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">height_slab</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">eps_background</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">eps_substrate</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Define the basic geometry for the photonic crystal.
Biatomic structures have not been tested. </p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>radius_1</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The radius of the first atom. Default is 0.2.</p>
              </div>
            </td>
            <td>
                  <code>0.2</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>eps_atom_1</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The dielectric constant of the first atom. Default is 1.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>radius_2</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The radius of the second atom. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>eps_atom_2</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The dielectric constant of the second atom. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>eps_bulk</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The dielectric constant of the bulk. Default is 12.</p>
              </div>
            </td>
            <td>
                  <code>12</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>height_supercell</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The height of the supercell. Default is 4.</p>
              </div>
            </td>
            <td>
                  <code>4</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>height_slab</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The height of the slab. Default is 0.5.</p>
              </div>
            </td>
            <td>
                  <code>0.5</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>eps_background</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The dielectric constant of the background. Default is 1.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>eps_substrate</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The dielectric constant of the substrate. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>list</code></td>            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of geometric objects defining the photonic crystal.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/photonic_crystal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1525</span>
<span class="normal">1526</span>
<span class="normal">1527</span>
<span class="normal">1528</span>
<span class="normal">1529</span>
<span class="normal">1530</span>
<span class="normal">1531</span>
<span class="normal">1532</span>
<span class="normal">1533</span>
<span class="normal">1534</span>
<span class="normal">1535</span>
<span class="normal">1536</span>
<span class="normal">1537</span>
<span class="normal">1538</span>
<span class="normal">1539</span>
<span class="normal">1540</span>
<span class="normal">1541</span>
<span class="normal">1542</span>
<span class="normal">1543</span>
<span class="normal">1544</span>
<span class="normal">1545</span>
<span class="normal">1546</span>
<span class="normal">1547</span>
<span class="normal">1548</span>
<span class="normal">1549</span>
<span class="normal">1550</span>
<span class="normal">1551</span>
<span class="normal">1552</span>
<span class="normal">1553</span>
<span class="normal">1554</span>
<span class="normal">1555</span>
<span class="normal">1556</span>
<span class="normal">1557</span>
<span class="normal">1558</span>
<span class="normal">1559</span>
<span class="normal">1560</span>
<span class="normal">1561</span>
<span class="normal">1562</span>
<span class="normal">1563</span>
<span class="normal">1564</span>
<span class="normal">1565</span>
<span class="normal">1566</span>
<span class="normal">1567</span>
<span class="normal">1568</span>
<span class="normal">1569</span>
<span class="normal">1570</span>
<span class="normal">1571</span>
<span class="normal">1572</span>
<span class="normal">1573</span>
<span class="normal">1574</span>
<span class="normal">1575</span>
<span class="normal">1576</span>
<span class="normal">1577</span>
<span class="normal">1578</span>
<span class="normal">1579</span>
<span class="normal">1580</span>
<span class="normal">1581</span>
<span class="normal">1582</span>
<span class="normal">1583</span>
<span class="normal">1584</span>
<span class="normal">1585</span>
<span class="normal">1586</span>
<span class="normal">1587</span>
<span class="normal">1588</span>
<span class="normal">1589</span>
<span class="normal">1590</span>
<span class="normal">1591</span>
<span class="normal">1592</span>
<span class="normal">1593</span>
<span class="normal">1594</span>
<span class="normal">1595</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">basic_geometry</span><span class="p">(</span><span class="n">radius_1</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>  
                   <span class="n">eps_atom_1</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> 
                   <span class="n">radius_2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                   <span class="n">eps_atom_2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">eps_bulk</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span>
                   <span class="n">height_supercell</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> 
                   <span class="n">height_slab</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                   <span class="n">eps_background</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                   <span class="n">eps_substrate</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="p">)</span><span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Define the basic geometry for the photonic crystal.</span>
<span class="sd">    Biatomic structures have not been tested. </span>

<span class="sd">    Args:</span>
<span class="sd">        radius_1 (float): The radius of the first atom. Default is 0.2.</span>
<span class="sd">        eps_atom_1 (float): The dielectric constant of the first atom. Default is 1.</span>
<span class="sd">        radius_2 (float, optional): The radius of the second atom. Default is None.</span>
<span class="sd">        eps_atom_2 (float, optional): The dielectric constant of the second atom. Default is None.</span>
<span class="sd">        eps_bulk (float): The dielectric constant of the bulk. Default is 12.</span>
<span class="sd">        height_supercell (float): The height of the supercell. Default is 4.</span>
<span class="sd">        height_slab (float): The height of the slab. Default is 0.5.</span>
<span class="sd">        eps_background (float): The dielectric constant of the background. Default is 1.</span>
<span class="sd">        eps_substrate (float, optional): The dielectric constant of the substrate. Default is None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: A list of geometric objects defining the photonic crystal.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">geometry</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1">#background</span>
    <span class="n">geometry</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">mp</span><span class="o">.</span><span class="n">Block</span><span class="p">(</span>
            <span class="n">size</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="n">mp</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">mp</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">height_supercell</span><span class="p">),</span>
            <span class="n">material</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Medium</span><span class="p">(</span><span class="n">epsilon</span><span class="o">=</span><span class="n">eps_background</span><span class="p">)),</span>

    <span class="p">)</span>

    <span class="c1">#substrate</span>
    <span class="k">if</span> <span class="n">eps_substrate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">geometry</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mp</span><span class="o">.</span><span class="n">Block</span><span class="p">(</span>
            <span class="n">size</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="n">mp</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">mp</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">height_supercell</span><span class="o">*</span><span class="mf">0.5</span><span class="p">),</span>
            <span class="n">center</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">height_supercell</span><span class="o">*</span><span class="mf">0.25</span><span class="p">),</span>
            <span class="n">material</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Medium</span><span class="p">(</span><span class="n">epsilon</span><span class="o">=</span><span class="n">eps_substrate</span><span class="p">)))</span>


    <span class="c1">#slab</span>
    <span class="n">geometry</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">mp</span><span class="o">.</span><span class="n">Block</span><span class="p">(</span>
            <span class="n">size</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="n">mp</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">mp</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">height_slab</span><span class="p">),</span>
            <span class="n">material</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Medium</span><span class="p">(</span><span class="n">epsilon</span><span class="o">=</span><span class="n">eps_bulk</span><span class="p">)),</span>
    <span class="p">)</span>

    <span class="c1">#atoms    </span>
    <span class="k">if</span> <span class="n">radius_2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">geometry</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mp</span><span class="o">.</span><span class="n">Cylinder</span><span class="p">(</span><span class="n">radius_1</span><span class="p">,</span> 
                                    <span class="n">material</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Medium</span><span class="p">(</span><span class="n">epsilon</span><span class="o">=</span><span class="n">eps_atom_1</span><span class="p">),</span>
                                    <span class="n">height</span><span class="o">=</span><span class="n">height_slab</span><span class="p">))</span>


    <span class="k">else</span><span class="p">:</span>
        <span class="n">geometry</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mp</span><span class="o">.</span><span class="n">Cylinder</span><span class="p">(</span><span class="n">radius_1</span><span class="p">,</span> 
                                    <span class="n">material</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Medium</span><span class="p">(</span><span class="n">epsilon</span><span class="o">=</span><span class="n">eps_atom_1</span><span class="p">),</span>
                                    <span class="n">height</span><span class="o">=</span><span class="n">height_slab</span><span class="p">))</span>
        <span class="n">geometry</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mp</span><span class="o">.</span><span class="n">Cylinder</span><span class="p">(</span><span class="n">radius_2</span><span class="p">,</span> 
                                    <span class="n">material</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Medium</span><span class="p">(</span><span class="n">epsilon</span><span class="o">=</span><span class="n">eps_atom_2</span><span class="p">),</span>
                                    <span class="n">height</span><span class="o">=</span><span class="n">height_slab</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">geometry</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.photonic_crystal.CrystalSlab.basic_lattice" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">basic_lattice</span><span class="p">(</span><span class="n">lattice_type</span><span class="o">=</span><span class="s1">&#39;square&#39;</span><span class="p">,</span> <span class="n">height_supercell</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Define the basic lattice structure for the photonic crystal.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>lattice_type</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The type of lattice. Default is 'square'.</p>
              </div>
            </td>
            <td>
                  <code>&#39;square&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>height_supercell</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The height of the supercell. Default is 4.</p>
              </div>
            </td>
            <td>
                  <code>4</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>tuple</code></td>            <td>
                  <code>tuple[<span title="meep.Lattice">Lattice</span>, list[<span title="meep.Vector3">Vector3</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tuple containing the lattice object representing the lattice and a list of k-points for the simulation.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/photonic_crystal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1467</span>
<span class="normal">1468</span>
<span class="normal">1469</span>
<span class="normal">1470</span>
<span class="normal">1471</span>
<span class="normal">1472</span>
<span class="normal">1473</span>
<span class="normal">1474</span>
<span class="normal">1475</span>
<span class="normal">1476</span>
<span class="normal">1477</span>
<span class="normal">1478</span>
<span class="normal">1479</span>
<span class="normal">1480</span>
<span class="normal">1481</span>
<span class="normal">1482</span>
<span class="normal">1483</span>
<span class="normal">1484</span>
<span class="normal">1485</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">basic_lattice</span><span class="p">(</span><span class="n">lattice_type</span><span class="o">=</span><span class="s1">&#39;square&#39;</span><span class="p">,</span> <span class="n">height_supercell</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span><span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">mp</span><span class="o">.</span><span class="n">Lattice</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Define the basic lattice structure for the photonic crystal.</span>

<span class="sd">    Args:</span>
<span class="sd">        lattice_type (str): The type of lattice. Default is &#39;square&#39;.</span>
<span class="sd">        height_supercell (int): The height of the supercell. Default is 4.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: A tuple containing the lattice object representing the lattice and a list of k-points for the simulation.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">lattice_type</span> <span class="o">==</span> <span class="s1">&#39;square&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">CrystalSlab</span><span class="o">.</span><span class="n">square_lattice</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">lattice_type</span> <span class="o">==</span> <span class="s1">&#39;triangular&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">CrystalSlab</span><span class="o">.</span><span class="n">triangular_lattice</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid lattice type. Choose &#39;square&#39; or &#39;triangular&#39;.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.photonic_crystal.CrystalSlab.ellipsoid_geometry" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ellipsoid_geometry</span><span class="p">(</span><span class="n">e1</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">e2</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">eps_atom</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">height_supercell</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">height_slab</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">eps_background</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">eps_substrate</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">eps_diag</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span> <span class="n">eps_offdiag</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">E_chi2_diag</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">E_chi3_diag</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Define an ellipsoid geometry for the photonic crystal.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>e1</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The first radius of the ellipsoid. Default is 0.2.</p>
              </div>
            </td>
            <td>
                  <code>0.2</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>e2</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The second radius of the ellipsoid. Default is 0.3.</p>
              </div>
            </td>
            <td>
                  <code>0.3</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>eps_atom</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The dielectric constant of the atom. Default is 1.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>height_supercell</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The height of the supercell. Default is 4.</p>
              </div>
            </td>
            <td>
                  <code>4</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>height_slab</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The height of the slab. Default is 0.5.</p>
              </div>
            </td>
            <td>
                  <code>0.5</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>eps_background</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The dielectric constant of the background. Default is 1.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>eps_substrate</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The dielectric constant of the substrate. Default is 1.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>eps_diag</code>
            </td>
            <td>
                  <code><span title="meep.Vector3">Vector3</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The diagonal components of the dielectric tensor. Default is (12, 12, 12).</p>
              </div>
            </td>
            <td>
                  <code><span title="meep.Vector3">Vector3</span>(12, 12, 12)</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>eps_offdiag</code>
            </td>
            <td>
                  <code><span title="meep.Vector3">Vector3</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The off-diagonal components of the dielectric tensor. Default is (0, 0, 0).</p>
              </div>
            </td>
            <td>
                  <code><span title="meep.Vector3">Vector3</span>(0, 0, 0)</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>E_chi2_diag</code>
            </td>
            <td>
                  <code><span title="meep.Vector3">Vector3</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The diagonal components of the second-order nonlinear susceptibility tensor. Default is (0, 0, 0).</p>
              </div>
            </td>
            <td>
                  <code><span title="meep.Vector3">Vector3</span>(0, 0, 0)</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>E_chi3_diag</code>
            </td>
            <td>
                  <code><span title="meep.Vector3">Vector3</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The diagonal components of the third-order nonlinear susceptibility tensor. Default is (0, 0, 0).</p>
              </div>
            </td>
            <td>
                  <code><span title="meep.Vector3">Vector3</span>(0, 0, 0)</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>list</code></td>            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of mpb geometric objects defining the photonic crystal.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/photonic_crystal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1598</span>
<span class="normal">1599</span>
<span class="normal">1600</span>
<span class="normal">1601</span>
<span class="normal">1602</span>
<span class="normal">1603</span>
<span class="normal">1604</span>
<span class="normal">1605</span>
<span class="normal">1606</span>
<span class="normal">1607</span>
<span class="normal">1608</span>
<span class="normal">1609</span>
<span class="normal">1610</span>
<span class="normal">1611</span>
<span class="normal">1612</span>
<span class="normal">1613</span>
<span class="normal">1614</span>
<span class="normal">1615</span>
<span class="normal">1616</span>
<span class="normal">1617</span>
<span class="normal">1618</span>
<span class="normal">1619</span>
<span class="normal">1620</span>
<span class="normal">1621</span>
<span class="normal">1622</span>
<span class="normal">1623</span>
<span class="normal">1624</span>
<span class="normal">1625</span>
<span class="normal">1626</span>
<span class="normal">1627</span>
<span class="normal">1628</span>
<span class="normal">1629</span>
<span class="normal">1630</span>
<span class="normal">1631</span>
<span class="normal">1632</span>
<span class="normal">1633</span>
<span class="normal">1634</span>
<span class="normal">1635</span>
<span class="normal">1636</span>
<span class="normal">1637</span>
<span class="normal">1638</span>
<span class="normal">1639</span>
<span class="normal">1640</span>
<span class="normal">1641</span>
<span class="normal">1642</span>
<span class="normal">1643</span>
<span class="normal">1644</span>
<span class="normal">1645</span>
<span class="normal">1646</span>
<span class="normal">1647</span>
<span class="normal">1648</span>
<span class="normal">1649</span>
<span class="normal">1650</span>
<span class="normal">1651</span>
<span class="normal">1652</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">ellipsoid_geometry</span><span class="p">(</span><span class="n">e1</span><span class="p">:</span> <span class="nb">float</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
                       <span class="n">e2</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span>
                       <span class="n">eps_atom</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                       <span class="n">height_supercell</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                       <span class="n">height_slab</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                       <span class="n">eps_background</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                       <span class="n">eps_substrate</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                       <span class="n">eps_diag</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span>
                       <span class="n">eps_offdiag</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                       <span class="n">E_chi2_diag</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
                       <span class="n">E_chi3_diag</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
                       <span class="p">)</span><span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>       
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Define an ellipsoid geometry for the photonic crystal.</span>

<span class="sd">    Args:</span>
<span class="sd">        e1 (float): The first radius of the ellipsoid. Default is 0.2.</span>
<span class="sd">        e2 (float): The second radius of the ellipsoid. Default is 0.3.</span>
<span class="sd">        eps_atom (float): The dielectric constant of the atom. Default is 1.</span>
<span class="sd">        height_supercell (float): The height of the supercell. Default is 4.</span>
<span class="sd">        height_slab (float): The height of the slab. Default is 0.5.</span>
<span class="sd">        eps_background (float): The dielectric constant of the background. Default is 1.</span>
<span class="sd">        eps_substrate (float): The dielectric constant of the substrate. Default is 1.</span>
<span class="sd">        eps_diag (mp.Vector3): The diagonal components of the dielectric tensor. Default is (12, 12, 12).</span>
<span class="sd">        eps_offdiag (mp.Vector3): The off-diagonal components of the dielectric tensor. Default is (0, 0, 0).</span>
<span class="sd">        E_chi2_diag (mp.Vector3): The diagonal components of the second-order nonlinear susceptibility tensor. Default is (0, 0, 0).</span>
<span class="sd">        E_chi3_diag (mp.Vector3): The diagonal components of the third-order nonlinear susceptibility tensor. Default is (0, 0, 0).</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: A list of mpb geometric objects defining the photonic crystal.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">geometry</span> <span class="o">=</span> <span class="p">[</span>
        <span class="c1">#background</span>
        <span class="n">mp</span><span class="o">.</span><span class="n">Block</span><span class="p">(</span>
            <span class="n">size</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="n">mp</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">mp</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">height_supercell</span><span class="p">),</span>
            <span class="n">material</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Medium</span><span class="p">(</span><span class="n">epsilon</span><span class="o">=</span><span class="n">eps_background</span><span class="p">)),</span>
        <span class="c1">#substrate</span>
        <span class="n">mp</span><span class="o">.</span><span class="n">Block</span><span class="p">(</span>
            <span class="n">size</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="n">mp</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">mp</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">height_supercell</span><span class="o">*</span><span class="mf">0.5</span><span class="p">),</span>
            <span class="n">center</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">height_supercell</span><span class="o">*</span><span class="mf">0.25</span><span class="p">),</span>
            <span class="n">material</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Medium</span><span class="p">(</span><span class="n">epsilon</span><span class="o">=</span><span class="n">eps_substrate</span><span class="p">)),</span>
        <span class="c1">#slab</span>
        <span class="n">mp</span><span class="o">.</span><span class="n">Block</span><span class="p">(</span>
            <span class="n">size</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="n">mp</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">mp</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">height_slab</span><span class="p">),</span>
            <span class="n">material</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Medium</span><span class="p">(</span><span class="n">epsilon_diag</span><span class="o">=</span><span class="n">eps_diag</span><span class="p">,</span>
                               <span class="n">epsilon_offdiag</span> <span class="o">=</span> <span class="n">eps_offdiag</span><span class="p">,</span>
                               <span class="n">E_chi2_diag</span> <span class="o">=</span> <span class="n">E_chi2_diag</span><span class="p">,</span>
                               <span class="n">E_chi3_diag</span> <span class="o">=</span> <span class="n">E_chi3_diag</span><span class="p">)),</span>
        <span class="c1">#atom</span>
        <span class="n">mp</span><span class="o">.</span><span class="n">Ellipsoid</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="n">e1</span><span class="p">,</span><span class="n">e2</span><span class="p">,</span> <span class="n">mp</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span>
                     <span class="n">material</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Medium</span><span class="p">(</span><span class="n">epsilon</span><span class="o">=</span><span class="n">eps_atom</span><span class="p">),</span>
                     <span class="n">center</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
    <span class="p">]</span>
    <span class="k">return</span> <span class="n">geometry</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.photonic_crystal.CrystalSlab.plot_epsilon" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_epsilon</span><span class="p">(</span><span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">colorscale</span><span class="o">=</span><span class="s1">&#39;PuBuGn&#39;</span><span class="p">,</span> <span class="n">override_resolution_with</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Plot the epsilon values obtained from the simulation using Plotly.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>fig</code>
            </td>
            <td>
                  <code><span title="plotly.graph_objects.Figure">Figure</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The Plotly figure to add the epsilon plot to. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>opacity</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The opacity of the plot. Default is 0.3.</p>
              </div>
            </td>
            <td>
                  <code>0.3</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>colorscale</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The colorscale for the plot. Default is 'PuBuGn'.</p>
              </div>
            </td>
            <td>
                  <code>&#39;PuBuGn&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>override_resolution_with</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The resolution to use for plotting. You can change the resolution just for the plot, but the simulation will still use the value set in the <strong>init</strong> method. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>periods</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of periods to plot. Default is 1.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="plotly.graph_objects.Figure">Figure</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>go.Figure: The Plotly figure object.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/photonic_crystal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span>
<span class="normal">1422</span>
<span class="normal">1423</span>
<span class="normal">1424</span>
<span class="normal">1425</span>
<span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span>
<span class="normal">1433</span>
<span class="normal">1434</span>
<span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span>
<span class="normal">1442</span>
<span class="normal">1443</span>
<span class="normal">1444</span>
<span class="normal">1445</span>
<span class="normal">1446</span>
<span class="normal">1447</span>
<span class="normal">1448</span>
<span class="normal">1449</span>
<span class="normal">1450</span>
<span class="normal">1451</span>
<span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span>
<span class="normal">1456</span>
<span class="normal">1457</span>
<span class="normal">1458</span>
<span class="normal">1459</span>
<span class="normal">1460</span>
<span class="normal">1461</span>
<span class="normal">1462</span>
<span class="normal">1463</span>
<span class="normal">1464</span>
<span class="normal">1465</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">plot_epsilon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                <span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                <span class="n">opacity</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> 
                <span class="n">colorscale</span><span class="o">=</span><span class="s1">&#39;PuBuGn&#39;</span><span class="p">,</span> 
                <span class="n">override_resolution_with</span><span class="p">:</span> <span class="kc">None</span><span class="o">|</span><span class="nb">int</span><span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                <span class="n">periods</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                <span class="p">)</span><span class="o">-&gt;</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the epsilon values obtained from the simulation using Plotly.</span>

<span class="sd">    Args:</span>
<span class="sd">        fig (go.Figure, optional): The Plotly figure to add the epsilon plot to. Default is None.</span>
<span class="sd">        opacity (float, optional): The opacity of the plot. Default is 0.3.</span>
<span class="sd">        colorscale (str, optional): The colorscale for the plot. Default is &#39;PuBuGn&#39;.</span>
<span class="sd">        override_resolution_with (int, optional): The resolution to use for plotting. You can change the resolution just for the plot, but the simulation will still use the value set in the __init__ method. Default is None.</span>
<span class="sd">        periods (int, optional): The number of periods to plot. Default is 1.</span>

<span class="sd">    Returns:</span>
<span class="sd">        go.Figure: The Plotly figure object.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">override_resolution_with</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">resolution</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">resolution</span> <span class="o">=</span> <span class="n">override_resolution_with</span>
        <span class="n">md</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">MPBData</span><span class="p">(</span><span class="n">rectify</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="n">periods</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">)</span>


        <span class="n">converted_eps</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_epsilon</span><span class="p">())</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">converted_eps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span> <span class="o">=</span> <span class="n">converted_eps</span>
    <span class="k">if</span> <span class="n">fig</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>

    <span class="n">z_points</span> <span class="o">=</span> <span class="n">converted_eps</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">//</span><span class="n">periods</span>
    <span class="n">z_mid</span> <span class="o">=</span> <span class="n">converted_eps</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">//</span><span class="mi">2</span>
    <span class="n">epsilon</span> <span class="o">=</span> <span class="n">converted_eps</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">z_mid</span><span class="o">-</span><span class="n">z_points</span><span class="o">//</span><span class="mi">2</span><span class="p">:</span><span class="n">z_mid</span><span class="o">+</span><span class="n">z_points</span><span class="o">//</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> 
    <span class="nb">print</span><span class="p">(</span><span class="n">epsilon</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">epsilon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">epsilon</span><span class="p">,(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span> 

    <span class="c1"># Create indices for x, y, z axes (meshgrid)</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">epsilon</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">epsilon</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">epsilon</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>

    <span class="c1"># Flatten the arrays for Plotly</span>
    <span class="n">x_flat</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">y_flat</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">z_flat</span> <span class="o">=</span> <span class="n">z</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">epsilon_flat</span> <span class="o">=</span> <span class="n">epsilon</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

    <span class="c1"># Get the minimum and maximum values from the epsilon array (ensure they are floats)</span>
    <span class="n">isomin_value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">epsilon_flat</span><span class="p">))</span>
    <span class="n">isomax_value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">epsilon_flat</span><span class="p">))</span>

    <span class="c1"># Create the 3D volume plot using Plotly</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">go</span><span class="o">.</span><span class="n">Volume</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">x_flat</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y_flat</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="n">z_flat</span><span class="p">,</span>
        <span class="n">value</span><span class="o">=</span><span class="n">epsilon_flat</span><span class="p">,</span>  <span class="c1"># Use the dielectric function values</span>
        <span class="n">isomin</span><span class="o">=</span><span class="n">isomin_value</span><span class="p">,</span>
        <span class="n">isomax</span><span class="o">=</span><span class="n">isomax_value</span><span class="p">,</span>
        <span class="n">opacity</span><span class="o">=</span><span class="n">opacity</span><span class="p">,</span>  <span class="c1"># Adjust opacity to visualize internal structure</span>
        <span class="n">surface_count</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>  <span class="c1"># Number of surfaces to display</span>
        <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscale</span><span class="p">,</span>  <span class="c1"># Color scale for the dielectric function</span>
        <span class="n">colorbar</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Dielectric Constant&#39;</span><span class="p">)</span>
    <span class="p">))</span>

    <span class="c1"># Add layout details</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="s1">&#39;3D Volume Plot of Dielectric Function&#39;</span><span class="p">,</span>
        <span class="n">scene</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="n">xaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="n">yaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="n">zaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fig</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.photonic_crystal.CrystalSlab.plot_field" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_field</span><span class="p">(</span><span class="n">target_polarization</span><span class="p">,</span> <span class="n">target_k_point</span><span class="p">,</span> <span class="n">target_frequency</span><span class="p">,</span> <span class="n">frequency_tolerance</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">k_point_max_distance</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">component</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">quantity</span><span class="o">=</span><span class="s1">&#39;real&#39;</span><span class="p">,</span> <span class="n">colorscale</span><span class="o">=</span><span class="s1">&#39;RdBu&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Plot the field for a specific mode based on the given parameters.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>target_polarization</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The polarization of the target mode.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>target_k_point</code>
            </td>
            <td>
                  <code>tuple</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The k-point of the target mode.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>target_frequency</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The frequency of the target mode.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>frequency_tolerance</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The tolerance for frequency similarity.</p>
              </div>
            </td>
            <td>
                  <code>0.01</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>periods</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of periods to extract. Default is 1.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>component</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The component of the field to plot (0 for x, 1 for y, 2 for z). Default is 2.</p>
              </div>
            </td>
            <td>
                  <code>2</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>quantity</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The quantity to plot ('real', 'imag', or 'abs'). Default is 'real'.</p>
              </div>
            </td>
            <td>
                  <code>&#39;real&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>colorscale</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The colorscale to use for the plot. Default is 'RdBu'.</p>
              </div>
            </td>
            <td>
                  <code>&#39;RdBu&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>tuple</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tuple containing the electric field figure and the magnetic field figure.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/photonic_crystal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1724</span>
<span class="normal">1725</span>
<span class="normal">1726</span>
<span class="normal">1727</span>
<span class="normal">1728</span>
<span class="normal">1729</span>
<span class="normal">1730</span>
<span class="normal">1731</span>
<span class="normal">1732</span>
<span class="normal">1733</span>
<span class="normal">1734</span>
<span class="normal">1735</span>
<span class="normal">1736</span>
<span class="normal">1737</span>
<span class="normal">1738</span>
<span class="normal">1739</span>
<span class="normal">1740</span>
<span class="normal">1741</span>
<span class="normal">1742</span>
<span class="normal">1743</span>
<span class="normal">1744</span>
<span class="normal">1745</span>
<span class="normal">1746</span>
<span class="normal">1747</span>
<span class="normal">1748</span>
<span class="normal">1749</span>
<span class="normal">1750</span>
<span class="normal">1751</span>
<span class="normal">1752</span>
<span class="normal">1753</span>
<span class="normal">1754</span>
<span class="normal">1755</span>
<span class="normal">1756</span>
<span class="normal">1757</span>
<span class="normal">1758</span>
<span class="normal">1759</span>
<span class="normal">1760</span>
<span class="normal">1761</span>
<span class="normal">1762</span>
<span class="normal">1763</span>
<span class="normal">1764</span>
<span class="normal">1765</span>
<span class="normal">1766</span>
<span class="normal">1767</span>
<span class="normal">1768</span>
<span class="normal">1769</span>
<span class="normal">1770</span>
<span class="normal">1771</span>
<span class="normal">1772</span>
<span class="normal">1773</span>
<span class="normal">1774</span>
<span class="normal">1775</span>
<span class="normal">1776</span>
<span class="normal">1777</span>
<span class="normal">1778</span>
<span class="normal">1779</span>
<span class="normal">1780</span>
<span class="normal">1781</span>
<span class="normal">1782</span>
<span class="normal">1783</span>
<span class="normal">1784</span>
<span class="normal">1785</span>
<span class="normal">1786</span>
<span class="normal">1787</span>
<span class="normal">1788</span>
<span class="normal">1789</span>
<span class="normal">1790</span>
<span class="normal">1791</span>
<span class="normal">1792</span>
<span class="normal">1793</span>
<span class="normal">1794</span>
<span class="normal">1795</span>
<span class="normal">1796</span>
<span class="normal">1797</span>
<span class="normal">1798</span>
<span class="normal">1799</span>
<span class="normal">1800</span>
<span class="normal">1801</span>
<span class="normal">1802</span>
<span class="normal">1803</span>
<span class="normal">1804</span>
<span class="normal">1805</span>
<span class="normal">1806</span>
<span class="normal">1807</span>
<span class="normal">1808</span>
<span class="normal">1809</span>
<span class="normal">1810</span>
<span class="normal">1811</span>
<span class="normal">1812</span>
<span class="normal">1813</span>
<span class="normal">1814</span>
<span class="normal">1815</span>
<span class="normal">1816</span>
<span class="normal">1817</span>
<span class="normal">1818</span>
<span class="normal">1819</span>
<span class="normal">1820</span>
<span class="normal">1821</span>
<span class="normal">1822</span>
<span class="normal">1823</span>
<span class="normal">1824</span>
<span class="normal">1825</span>
<span class="normal">1826</span>
<span class="normal">1827</span>
<span class="normal">1828</span>
<span class="normal">1829</span>
<span class="normal">1830</span>
<span class="normal">1831</span>
<span class="normal">1832</span>
<span class="normal">1833</span>
<span class="normal">1834</span>
<span class="normal">1835</span>
<span class="normal">1836</span>
<span class="normal">1837</span>
<span class="normal">1838</span>
<span class="normal">1839</span>
<span class="normal">1840</span>
<span class="normal">1841</span>
<span class="normal">1842</span>
<span class="normal">1843</span>
<span class="normal">1844</span>
<span class="normal">1845</span>
<span class="normal">1846</span>
<span class="normal">1847</span>
<span class="normal">1848</span>
<span class="normal">1849</span>
<span class="normal">1850</span>
<span class="normal">1851</span>
<span class="normal">1852</span>
<span class="normal">1853</span>
<span class="normal">1854</span>
<span class="normal">1855</span>
<span class="normal">1856</span>
<span class="normal">1857</span>
<span class="normal">1858</span>
<span class="normal">1859</span>
<span class="normal">1860</span>
<span class="normal">1861</span>
<span class="normal">1862</span>
<span class="normal">1863</span>
<span class="normal">1864</span>
<span class="normal">1865</span>
<span class="normal">1866</span>
<span class="normal">1867</span>
<span class="normal">1868</span>
<span class="normal">1869</span>
<span class="normal">1870</span>
<span class="normal">1871</span>
<span class="normal">1872</span>
<span class="normal">1873</span>
<span class="normal">1874</span>
<span class="normal">1875</span>
<span class="normal">1876</span>
<span class="normal">1877</span>
<span class="normal">1878</span>
<span class="normal">1879</span>
<span class="normal">1880</span>
<span class="normal">1881</span>
<span class="normal">1882</span>
<span class="normal">1883</span>
<span class="normal">1884</span>
<span class="normal">1885</span>
<span class="normal">1886</span>
<span class="normal">1887</span>
<span class="normal">1888</span>
<span class="normal">1889</span>
<span class="normal">1890</span>
<span class="normal">1891</span>
<span class="normal">1892</span>
<span class="normal">1893</span>
<span class="normal">1894</span>
<span class="normal">1895</span>
<span class="normal">1896</span>
<span class="normal">1897</span>
<span class="normal">1898</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">plot_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
        <span class="n">target_polarization</span><span class="p">,</span> 
        <span class="n">target_k_point</span><span class="p">,</span> 
        <span class="n">target_frequency</span><span class="p">,</span> 
        <span class="n">frequency_tolerance</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span> 
        <span class="n">k_point_max_distance</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">periods</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> 
        <span class="n">component</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> 
        <span class="n">quantity</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;real&quot;</span><span class="p">,</span> 
        <span class="n">colorscale</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;RdBu&#39;</span><span class="p">,</span>                  
        <span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the field for a specific mode based on the given parameters.</span>

<span class="sd">    Args:</span>
<span class="sd">        target_polarization (str): The polarization of the target mode.</span>
<span class="sd">        target_k_point (tuple): The k-point of the target mode.</span>
<span class="sd">        target_frequency (float): The frequency of the target mode.</span>
<span class="sd">        frequency_tolerance (float): The tolerance for frequency similarity.</span>
<span class="sd">        periods (int): The number of periods to extract. Default is 1.</span>
<span class="sd">        component (int): The component of the field to plot (0 for x, 1 for y, 2 for z). Default is 2.</span>
<span class="sd">        quantity (str): The quantity to plot (&#39;real&#39;, &#39;imag&#39;, or &#39;abs&#39;). Default is &#39;real&#39;.</span>
<span class="sd">        colorscale (str): The colorscale to use for the plot. Default is &#39;RdBu&#39;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: A tuple containing the electric field figure and the magnetic field figure.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">target_modes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">look_for_mode</span><span class="p">(</span><span class="n">target_polarization</span><span class="p">,</span> <span class="n">target_k_point</span><span class="p">,</span> <span class="n">target_frequency</span><span class="p">,</span> <span class="n">freq_tolerance</span> <span class="o">=</span> <span class="n">frequency_tolerance</span><span class="p">,</span> <span class="n">k_point_max_distance</span> <span class="o">=</span> <span class="n">k_point_max_distance</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">))</span>

    <span class="k">with</span> <span class="n">suppress_output</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_dumb_simulation</span><span class="p">()</span>
        <span class="n">md</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">MPBData</span><span class="p">(</span><span class="n">rectify</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="n">periods</span><span class="p">,</span> <span class="n">lattice</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_lattice</span><span class="p">())</span>
        <span class="n">eps</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_epsilon</span><span class="p">())</span> 

    <span class="n">z_points</span> <span class="o">=</span> <span class="n">eps</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">//</span> <span class="n">periods</span>
    <span class="n">z_mid</span> <span class="o">=</span> <span class="n">eps</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span>

    <span class="c1"># Now take only epsilon in the center of the slab</span>
    <span class="n">eps</span> <span class="o">=</span> <span class="n">eps</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">z_mid</span><span class="p">]</span>
    <span class="c1"># Calculate the midpoint between min and max of the permittivity (eps)</span>
    <span class="n">min_eps</span><span class="p">,</span> <span class="n">max_eps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">eps</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">eps</span><span class="p">)</span>
    <span class="n">midpoint</span> <span class="o">=</span> <span class="p">(</span><span class="n">min_eps</span> <span class="o">+</span> <span class="n">max_eps</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>  <span class="c1"># The level to be plotted</span>

    <span class="n">fig_e</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
    <span class="n">fig_h</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
    <span class="n">dropdown_buttons_e</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">dropdown_buttons_h</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">num_plots</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">mode</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">target_modes</span><span class="p">):</span>
        <span class="c1"># Initialize visibility status: False for all traces</span>
        <span class="n">visible_status_e</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">num_plots</span><span class="p">)</span>  <span class="c1"># Each mode adds two traces</span>
        <span class="n">visible_status_h</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">num_plots</span><span class="p">)</span>

        <span class="n">visible_status_e</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Set the contour plot visible</span>
        <span class="n">visible_status_h</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">visible_status_e</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Set the heatmap visible</span>
        <span class="n">visible_status_h</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Set the heatmap visible</span>

        <span class="n">k_point</span> <span class="o">=</span> <span class="n">mode</span><span class="p">[</span><span class="s2">&quot;k_point&quot;</span><span class="p">]</span>
        <span class="n">freq</span>    <span class="o">=</span> <span class="n">mode</span><span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">]</span>
        <span class="n">polarization</span> <span class="o">=</span> <span class="n">mode</span><span class="p">[</span><span class="s2">&quot;polarization&quot;</span><span class="p">]</span>

        <span class="c1"># Take the specified component of the fields in the center of the slab</span>

        <span class="n">e_field</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">MPBArray</span><span class="p">(</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;e_field&quot;</span><span class="p">],</span> <span class="n">lattice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_lattice</span><span class="p">(),</span>  <span class="n">kpoint</span> <span class="o">=</span> <span class="n">mode</span><span class="p">[</span><span class="s2">&quot;k_point&quot;</span><span class="p">]</span> <span class="p">)</span>
        <span class="n">h_field</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">MPBArray</span><span class="p">(</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;h_field&quot;</span><span class="p">],</span> <span class="n">lattice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_lattice</span><span class="p">(),</span>  <span class="n">kpoint</span> <span class="o">=</span> <span class="n">mode</span><span class="p">[</span><span class="s2">&quot;k_point&quot;</span><span class="p">])</span>
        <span class="n">e_field</span> <span class="o">=</span> <span class="n">e_field</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">z_points</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">component</span><span class="p">]</span>
        <span class="n">h_field</span> <span class="o">=</span> <span class="n">h_field</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">z_points</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">component</span><span class="p">]</span>
        <span class="k">with</span> <span class="n">suppress_output</span><span class="p">():</span>
            <span class="n">e_field</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">e_field</span><span class="p">)</span> 
            <span class="n">h_field</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">h_field</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s2">&quot;real&quot;</span><span class="p">:</span>
            <span class="n">e_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">e_field</span><span class="p">)</span>
            <span class="n">h_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">h_field</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s2">&quot;imag&quot;</span><span class="p">:</span>
            <span class="n">e_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">e_field</span><span class="p">)</span>
            <span class="n">h_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">h_field</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s2">&quot;abs&quot;</span><span class="p">:</span>
            <span class="n">e_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">e_field</span><span class="p">)</span>
            <span class="n">h_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">h_field</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid quantity. Choose &#39;real&#39;, &#39;imag&#39;, or &#39;abs&#39;.&quot;</span><span class="p">)</span>

        <span class="c1"># Add the contour plot for permittivity (eps) at the midpoint</span>
        <span class="n">contour_e</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Contour</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">eps</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
                            <span class="n">contours</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                                <span class="n">start</span><span class="o">=</span><span class="n">midpoint</span><span class="p">,</span>  <span class="c1"># Start and end at the midpoint to ensure a single level</span>
                                <span class="n">end</span><span class="o">=</span><span class="n">midpoint</span><span class="p">,</span>
                                <span class="n">size</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>  <span class="c1"># A small size to keep it as a single contour</span>
                                <span class="n">coloring</span><span class="o">=</span><span class="s1">&#39;none&#39;</span>  <span class="c1"># No filling</span>
                            <span class="p">),</span>
                            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>
                            <span class="n">showscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">opacity</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
                            <span class="n">visible</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span>  <span class="mi">0</span>  <span class="k">else</span> <span class="kc">False</span><span class="p">)</span>  <span class="c1"># Only the first mode is visible</span>
        <span class="n">contour_h</span> <span class="o">=</span> <span class="n">contour_e</span>  <span class="c1"># Same contour for H-field figure</span>

        <span class="c1"># Add the contour trace</span>
        <span class="n">fig_e</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">contour_e</span><span class="p">)</span>
        <span class="n">fig_h</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">contour_h</span><span class="p">)</span>

        <span class="c1"># Add the heatmap for the electric field</span>
        <span class="n">heatmap_e</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Heatmap</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">e_field</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscale</span><span class="p">,</span> <span class="n">zsmooth</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span>
                                <span class="n">showscale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">False</span><span class="p">)</span>
        <span class="c1"># Add the heatmap for the magnetic field</span>
        <span class="n">heatmap_h</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Heatmap</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">h_field</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscale</span><span class="p">,</span> <span class="n">zsmooth</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span>
                                <span class="n">showscale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Add the heatmap trace</span>
        <span class="n">fig_e</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">heatmap_e</span><span class="p">)</span>
        <span class="n">fig_h</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">heatmap_h</span><span class="p">)</span>



        <span class="n">data_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Mode </span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2"> &lt;br&gt; k = [</span><span class="si">{</span><span class="n">k_point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">0.2f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">k_point</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">0.2f</span><span class="si">}</span><span class="s2">], freq=</span><span class="si">{</span><span class="n">freq</span><span class="si">:</span><span class="s2">0.3f</span><span class="si">}</span><span class="s2">, polarization=</span><span class="si">{</span><span class="n">polarization</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="n">component</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> 
            <span class="n">component_str</span> <span class="o">=</span> <span class="s2">&quot;x-component&quot;</span>
        <span class="k">elif</span> <span class="n">component</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">component_str</span> <span class="o">=</span> <span class="s2">&quot;y-component&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">component_str</span> <span class="o">=</span> <span class="s2">&quot;z-component&quot;</span>
        <span class="n">subtitle_e</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;E-field, </span><span class="si">{</span><span class="n">component_str</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">quantity</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">subtitle_h</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;H-field, </span><span class="si">{</span><span class="n">component_str</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">quantity</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="c1"># Create a button for each field dataset for the dropdown</span>
        <span class="n">dropdown_buttons_e</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mode </span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                                    <span class="n">method</span><span class="o">=</span><span class="s1">&#39;update&#39;</span><span class="p">,</span>
                                    <span class="n">args</span><span class="o">=</span><span class="p">[{</span><span class="s1">&#39;visible&#39;</span><span class="p">:</span> <span class="n">visible_status_e</span><span class="p">},</span>  <span class="c1"># Update visibility for both eps and field</span>
                                        <span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">data_str</span><span class="si">}</span><span class="s2">:&lt;br&gt; </span><span class="si">{</span><span class="n">subtitle_e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}</span>
                                    <span class="p">]))</span>
        <span class="n">dropdown_buttons_h</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mode </span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                                    <span class="n">method</span><span class="o">=</span><span class="s1">&#39;update&#39;</span><span class="p">,</span>
                                    <span class="n">args</span><span class="o">=</span><span class="p">[{</span><span class="s1">&#39;visible&#39;</span><span class="p">:</span> <span class="n">visible_status_h</span><span class="p">},</span>  <span class="c1"># Update visibility for both eps and field</span>
                                        <span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">data_str</span><span class="si">}</span><span class="s2">:&lt;br&gt; </span><span class="si">{</span><span class="n">subtitle_h</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}</span>
                                    <span class="p">]))</span>

    <span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">))</span>
    <span class="n">k_point</span> <span class="o">=</span> <span class="n">target_modes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;k_point&quot;</span><span class="p">]</span>
    <span class="n">freq</span>    <span class="o">=</span> <span class="n">target_modes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;freq&quot;</span><span class="p">]</span>
    <span class="n">data_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Mode </span><span class="si">{</span><span class="mi">0</span><span class="si">}</span><span class="s2"> &lt;br&gt; k = [</span><span class="si">{</span><span class="n">k_point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">0.2f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">k_point</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">0.2f</span><span class="si">}</span><span class="s2">], freq=</span><span class="si">{</span><span class="n">freq</span><span class="si">:</span><span class="s2">0.3f</span><span class="si">}</span><span class="s2">, polarization=</span><span class="si">{</span><span class="n">polarization</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">fig_e</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
        <span class="n">updatemenus</span><span class="o">=</span><span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="n">active</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                        <span class="n">buttons</span><span class="o">=</span><span class="n">dropdown_buttons_e</span><span class="p">,</span>
                        <span class="n">x</span><span class="o">=</span><span class="mf">1.15</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.15</span><span class="p">,</span>
                        <span class="n">xanchor</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">yanchor</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)],</span>
        <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">data_str</span><span class="si">}</span><span class="s2">:&lt;br&gt; </span><span class="si">{</span><span class="n">subtitle_e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">xaxis_showgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">yaxis_showgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">xaxis_zeroline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">yaxis_zeroline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">xaxis_visible</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">yaxis_visible</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">hovermode</span><span class="o">=</span><span class="s2">&quot;closest&quot;</span><span class="p">,</span>
        <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
        <span class="n">xaxis_title</span><span class="o">=</span><span class="s2">&quot;X&quot;</span><span class="p">,</span>
        <span class="n">yaxis_title</span><span class="o">=</span><span class="s2">&quot;Y&quot;</span>

    <span class="p">)</span>

    <span class="n">fig_h</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
        <span class="n">updatemenus</span><span class="o">=</span><span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="n">active</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                        <span class="n">buttons</span><span class="o">=</span><span class="n">dropdown_buttons_h</span><span class="p">,</span>
                        <span class="n">x</span><span class="o">=</span><span class="mf">1.15</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.15</span><span class="p">,</span>
                        <span class="n">xanchor</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">yanchor</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)],</span>
        <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">data_str</span><span class="si">}</span><span class="s2">:&lt;br&gt; </span><span class="si">{</span><span class="n">subtitle_h</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">xaxis_showgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">yaxis_showgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">xaxis_zeroline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">yaxis_zeroline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">xaxis_visible</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">yaxis_visible</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">hovermode</span><span class="o">=</span><span class="s2">&quot;closest&quot;</span><span class="p">,</span>
        <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
        <span class="n">xaxis_title</span><span class="o">=</span><span class="s2">&quot;X&quot;</span><span class="p">,</span>
        <span class="n">yaxis_title</span><span class="o">=</span><span class="s2">&quot;Y&quot;</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">fig_e</span><span class="p">,</span> <span class="n">fig_h</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.photonic_crystal.CrystalSlab.plot_field_components" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_field_components</span><span class="p">(</span><span class="n">target_polarization</span><span class="p">,</span> <span class="n">target_k_point</span><span class="p">,</span> <span class="n">target_frequency</span><span class="p">,</span> <span class="n">frequency_tolerance</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">k_point_max_distance</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">quantity</span><span class="o">=</span><span class="s1">&#39;real&#39;</span><span class="p">,</span> <span class="n">colorscale</span><span class="o">=</span><span class="s1">&#39;RdBu&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Plot the field components (Ex, Ey, Ez) and (Hx, Hy, Hz) for specific modes with consistent color scales.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>target_polarization</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The polarization of the target mode.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>target_k_point</code>
            </td>
            <td>
                  <code>tuple</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The k-point of the target mode.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>target_frequency</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The frequency of the target mode.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>frequency_tolerance</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The tolerance for frequency similarity.</p>
              </div>
            </td>
            <td>
                  <code>0.01</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>periods</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of periods to extract. Default is 1.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>quantity</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The quantity to plot ('real', 'imag', or 'abs'). Default is 'real'.</p>
              </div>
            </td>
            <td>
                  <code>&#39;real&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>colorscale</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The colorscale to use for the plot. Default is 'RdBu'.</p>
              </div>
            </td>
            <td>
                  <code>&#39;RdBu&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>tuple</code></td>            <td>
                  <code>tuple</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tuple containing the electric field figure and the magnetic field figure.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/photonic_crystal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1902</span>
<span class="normal">1903</span>
<span class="normal">1904</span>
<span class="normal">1905</span>
<span class="normal">1906</span>
<span class="normal">1907</span>
<span class="normal">1908</span>
<span class="normal">1909</span>
<span class="normal">1910</span>
<span class="normal">1911</span>
<span class="normal">1912</span>
<span class="normal">1913</span>
<span class="normal">1914</span>
<span class="normal">1915</span>
<span class="normal">1916</span>
<span class="normal">1917</span>
<span class="normal">1918</span>
<span class="normal">1919</span>
<span class="normal">1920</span>
<span class="normal">1921</span>
<span class="normal">1922</span>
<span class="normal">1923</span>
<span class="normal">1924</span>
<span class="normal">1925</span>
<span class="normal">1926</span>
<span class="normal">1927</span>
<span class="normal">1928</span>
<span class="normal">1929</span>
<span class="normal">1930</span>
<span class="normal">1931</span>
<span class="normal">1932</span>
<span class="normal">1933</span>
<span class="normal">1934</span>
<span class="normal">1935</span>
<span class="normal">1936</span>
<span class="normal">1937</span>
<span class="normal">1938</span>
<span class="normal">1939</span>
<span class="normal">1940</span>
<span class="normal">1941</span>
<span class="normal">1942</span>
<span class="normal">1943</span>
<span class="normal">1944</span>
<span class="normal">1945</span>
<span class="normal">1946</span>
<span class="normal">1947</span>
<span class="normal">1948</span>
<span class="normal">1949</span>
<span class="normal">1950</span>
<span class="normal">1951</span>
<span class="normal">1952</span>
<span class="normal">1953</span>
<span class="normal">1954</span>
<span class="normal">1955</span>
<span class="normal">1956</span>
<span class="normal">1957</span>
<span class="normal">1958</span>
<span class="normal">1959</span>
<span class="normal">1960</span>
<span class="normal">1961</span>
<span class="normal">1962</span>
<span class="normal">1963</span>
<span class="normal">1964</span>
<span class="normal">1965</span>
<span class="normal">1966</span>
<span class="normal">1967</span>
<span class="normal">1968</span>
<span class="normal">1969</span>
<span class="normal">1970</span>
<span class="normal">1971</span>
<span class="normal">1972</span>
<span class="normal">1973</span>
<span class="normal">1974</span>
<span class="normal">1975</span>
<span class="normal">1976</span>
<span class="normal">1977</span>
<span class="normal">1978</span>
<span class="normal">1979</span>
<span class="normal">1980</span>
<span class="normal">1981</span>
<span class="normal">1982</span>
<span class="normal">1983</span>
<span class="normal">1984</span>
<span class="normal">1985</span>
<span class="normal">1986</span>
<span class="normal">1987</span>
<span class="normal">1988</span>
<span class="normal">1989</span>
<span class="normal">1990</span>
<span class="normal">1991</span>
<span class="normal">1992</span>
<span class="normal">1993</span>
<span class="normal">1994</span>
<span class="normal">1995</span>
<span class="normal">1996</span>
<span class="normal">1997</span>
<span class="normal">1998</span>
<span class="normal">1999</span>
<span class="normal">2000</span>
<span class="normal">2001</span>
<span class="normal">2002</span>
<span class="normal">2003</span>
<span class="normal">2004</span>
<span class="normal">2005</span>
<span class="normal">2006</span>
<span class="normal">2007</span>
<span class="normal">2008</span>
<span class="normal">2009</span>
<span class="normal">2010</span>
<span class="normal">2011</span>
<span class="normal">2012</span>
<span class="normal">2013</span>
<span class="normal">2014</span>
<span class="normal">2015</span>
<span class="normal">2016</span>
<span class="normal">2017</span>
<span class="normal">2018</span>
<span class="normal">2019</span>
<span class="normal">2020</span>
<span class="normal">2021</span>
<span class="normal">2022</span>
<span class="normal">2023</span>
<span class="normal">2024</span>
<span class="normal">2025</span>
<span class="normal">2026</span>
<span class="normal">2027</span>
<span class="normal">2028</span>
<span class="normal">2029</span>
<span class="normal">2030</span>
<span class="normal">2031</span>
<span class="normal">2032</span>
<span class="normal">2033</span>
<span class="normal">2034</span>
<span class="normal">2035</span>
<span class="normal">2036</span>
<span class="normal">2037</span>
<span class="normal">2038</span>
<span class="normal">2039</span>
<span class="normal">2040</span>
<span class="normal">2041</span>
<span class="normal">2042</span>
<span class="normal">2043</span>
<span class="normal">2044</span>
<span class="normal">2045</span>
<span class="normal">2046</span>
<span class="normal">2047</span>
<span class="normal">2048</span>
<span class="normal">2049</span>
<span class="normal">2050</span>
<span class="normal">2051</span>
<span class="normal">2052</span>
<span class="normal">2053</span>
<span class="normal">2054</span>
<span class="normal">2055</span>
<span class="normal">2056</span>
<span class="normal">2057</span>
<span class="normal">2058</span>
<span class="normal">2059</span>
<span class="normal">2060</span>
<span class="normal">2061</span>
<span class="normal">2062</span>
<span class="normal">2063</span>
<span class="normal">2064</span>
<span class="normal">2065</span>
<span class="normal">2066</span>
<span class="normal">2067</span>
<span class="normal">2068</span>
<span class="normal">2069</span>
<span class="normal">2070</span>
<span class="normal">2071</span>
<span class="normal">2072</span>
<span class="normal">2073</span>
<span class="normal">2074</span>
<span class="normal">2075</span>
<span class="normal">2076</span>
<span class="normal">2077</span>
<span class="normal">2078</span>
<span class="normal">2079</span>
<span class="normal">2080</span>
<span class="normal">2081</span>
<span class="normal">2082</span>
<span class="normal">2083</span>
<span class="normal">2084</span>
<span class="normal">2085</span>
<span class="normal">2086</span>
<span class="normal">2087</span>
<span class="normal">2088</span>
<span class="normal">2089</span>
<span class="normal">2090</span>
<span class="normal">2091</span>
<span class="normal">2092</span>
<span class="normal">2093</span>
<span class="normal">2094</span>
<span class="normal">2095</span>
<span class="normal">2096</span>
<span class="normal">2097</span>
<span class="normal">2098</span>
<span class="normal">2099</span>
<span class="normal">2100</span>
<span class="normal">2101</span>
<span class="normal">2102</span>
<span class="normal">2103</span>
<span class="normal">2104</span>
<span class="normal">2105</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">plot_field_components</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                        <span class="n">target_polarization</span><span class="p">,</span>
                        <span class="n">target_k_point</span><span class="p">,</span>
                        <span class="n">target_frequency</span><span class="p">,</span>
                        <span class="n">frequency_tolerance</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
                        <span class="n">k_point_max_distance</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">periods</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                        <span class="n">quantity</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;real&quot;</span><span class="p">,</span>
                        <span class="n">colorscale</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;RdBu&#39;</span><span class="p">,</span>
                        <span class="p">)</span><span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the field components (Ex, Ey, Ez) and (Hx, Hy, Hz) for specific modes with consistent color scales.</span>

<span class="sd">    Args:</span>
<span class="sd">        target_polarization (str): The polarization of the target mode.</span>
<span class="sd">        target_k_point (tuple): The k-point of the target mode.</span>
<span class="sd">        target_frequency (float): The frequency of the target mode.</span>
<span class="sd">        frequency_tolerance (float): The tolerance for frequency similarity.</span>
<span class="sd">        periods (int): The number of periods to extract. Default is 1.</span>
<span class="sd">        quantity (str): The quantity to plot (&#39;real&#39;, &#39;imag&#39;, or &#39;abs&#39;). Default is &#39;real&#39;.</span>
<span class="sd">        colorscale (str): The colorscale to use for the plot. Default is &#39;RdBu&#39;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: A tuple containing the electric field figure and the magnetic field figure.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">target_modes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">look_for_mode</span><span class="p">(</span><span class="n">target_polarization</span><span class="p">,</span> <span class="n">target_k_point</span><span class="p">,</span> <span class="n">target_frequency</span><span class="p">,</span>
                                    <span class="n">freq_tolerance</span><span class="o">=</span><span class="n">frequency_tolerance</span><span class="p">,</span> <span class="n">k_point_max_distance</span><span class="o">=</span><span class="n">k_point_max_distance</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of target modes found: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">suppress_output</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_dumb_simulation</span><span class="p">()</span>
        <span class="n">md</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">MPBData</span><span class="p">(</span><span class="n">rectify</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="n">periods</span><span class="p">,</span> <span class="n">lattice</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_lattice</span><span class="p">())</span>
        <span class="n">eps</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_epsilon</span><span class="p">())</span>

    <span class="n">z_points</span> <span class="o">=</span> <span class="n">eps</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">//</span> <span class="n">periods</span>
    <span class="n">z_mid</span> <span class="o">=</span> <span class="n">eps</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span>

    <span class="c1"># Now take only epsilon in the center of the slab</span>
    <span class="n">eps</span> <span class="o">=</span> <span class="n">eps</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">z_mid</span><span class="p">]</span>
    <span class="c1"># Calculate the midpoint between min and max of the permittivity (eps)</span>
    <span class="n">min_eps</span><span class="p">,</span> <span class="n">max_eps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">eps</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">eps</span><span class="p">)</span>
    <span class="n">midpoint</span> <span class="o">=</span> <span class="p">(</span><span class="n">min_eps</span> <span class="o">+</span> <span class="n">max_eps</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>  <span class="c1"># The level to be plotted</span>

    <span class="n">fig_e</span> <span class="o">=</span> <span class="n">make_subplots</span><span class="p">(</span><span class="n">rows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">subplot_titles</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Ex&quot;</span><span class="p">,</span> <span class="s2">&quot;Ey&quot;</span><span class="p">,</span> <span class="s2">&quot;Ez&quot;</span><span class="p">))</span>
    <span class="n">fig_h</span> <span class="o">=</span> <span class="n">make_subplots</span><span class="p">(</span><span class="n">rows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">subplot_titles</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Hx&quot;</span><span class="p">,</span> <span class="s2">&quot;Hy&quot;</span><span class="p">,</span> <span class="s2">&quot;Hz&quot;</span><span class="p">))</span>
    <span class="n">dropdown_buttons_e</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">dropdown_buttons_h</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># For each mode, calculate separate min and max values for Ex, Ey, Ez (and similarly Hx, Hy, Hz)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">mode</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">target_modes</span><span class="p">):</span>
        <span class="c1"># Get field arrays for this mode</span>
        <span class="n">e_field_array</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">MPBArray</span><span class="p">(</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;e_field&quot;</span><span class="p">],</span> <span class="n">lattice</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_lattice</span><span class="p">(),</span> <span class="n">kpoint</span><span class="o">=</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;k_point&quot;</span><span class="p">])</span>
        <span class="n">h_field_array</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">MPBArray</span><span class="p">(</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;h_field&quot;</span><span class="p">],</span> <span class="n">lattice</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_lattice</span><span class="p">(),</span> <span class="n">kpoint</span><span class="o">=</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;k_point&quot;</span><span class="p">])</span>

        <span class="c1"># Extract field components in the center of the slab</span>
        <span class="n">e_field_x</span> <span class="o">=</span> <span class="n">e_field_array</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">z_points</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>  <span class="c1"># Shape (Nx, Ny)</span>
        <span class="n">e_field_y</span> <span class="o">=</span> <span class="n">e_field_array</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">z_points</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># Shape (Nx, Ny)</span>
        <span class="n">e_field_z</span> <span class="o">=</span> <span class="n">e_field_array</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">z_points</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>  <span class="c1"># Shape (Nx, Ny)</span>
        <span class="n">h_field_x</span> <span class="o">=</span> <span class="n">h_field_array</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">z_points</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>  <span class="c1"># Shape (Nx, Ny)</span>
        <span class="n">h_field_y</span> <span class="o">=</span> <span class="n">h_field_array</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">z_points</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># Shape (Nx, Ny)</span>
        <span class="n">h_field_z</span> <span class="o">=</span> <span class="n">h_field_array</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">z_points</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>  <span class="c1"># Shape (Nx, Ny)</span>

        <span class="k">with</span> <span class="n">suppress_output</span><span class="p">():</span>
            <span class="n">e_field_x</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">e_field_x</span><span class="p">)</span>
            <span class="n">e_field_y</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">e_field_y</span><span class="p">)</span>
            <span class="n">e_field_z</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">e_field_z</span><span class="p">)</span>
            <span class="n">h_field_x</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">h_field_x</span><span class="p">)</span>
            <span class="n">h_field_y</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">h_field_y</span><span class="p">)</span>
            <span class="n">h_field_z</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">h_field_z</span><span class="p">)</span>

        <span class="n">e_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">e_field_x</span><span class="p">,</span> <span class="n">e_field_y</span><span class="p">,</span> <span class="n">e_field_z</span><span class="p">],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">h_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">h_field_x</span><span class="p">,</span> <span class="n">h_field_y</span><span class="p">,</span> <span class="n">h_field_z</span><span class="p">],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>                                    

        <span class="c1"># Select quantity to display (real, imag, abs)</span>
        <span class="k">if</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s2">&quot;real&quot;</span><span class="p">:</span>
            <span class="n">e_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">e_field</span><span class="p">)</span>
            <span class="n">h_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">h_field</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s2">&quot;imag&quot;</span><span class="p">:</span>
            <span class="n">e_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">e_field</span><span class="p">)</span>
            <span class="n">h_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">h_field</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s2">&quot;abs&quot;</span><span class="p">:</span>
            <span class="n">e_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">e_field</span><span class="p">)</span>
            <span class="n">h_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">h_field</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid quantity. Choose &#39;real&#39;, &#39;imag&#39;, or &#39;abs&#39;.&quot;</span><span class="p">)</span>

        <span class="c1"># Calculate the component-specific min/max for E and H fields of this mode</span>
        <span class="n">e_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">e_field</span><span class="p">)</span>
        <span class="n">e_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">e_field</span><span class="p">)</span>
        <span class="n">h_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">h_field</span><span class="p">)</span>
        <span class="n">h_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">h_field</span><span class="p">)</span>

        <span class="c1"># Components of the E and H fields</span>
        <span class="n">Ex</span><span class="p">,</span> <span class="n">Ey</span><span class="p">,</span> <span class="n">Ez</span> <span class="o">=</span> <span class="n">e_field</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">e_field</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">e_field</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
        <span class="n">Hx</span><span class="p">,</span> <span class="n">Hy</span><span class="p">,</span> <span class="n">Hz</span> <span class="o">=</span> <span class="n">h_field</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">h_field</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">h_field</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>

        <span class="c1"># Define visibility settings per mode, including contours as always visible</span>
        <span class="n">visible_status_e</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span> <span class="o">*</span> <span class="mi">6</span><span class="p">)</span>  <span class="c1"># 3 components per mode, with contour for each</span>
        <span class="n">visible_status_h</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span> <span class="o">*</span> <span class="mi">6</span><span class="p">)</span>
        <span class="c1"># Make the contour visible by default</span>




        <span class="c1"># Make this mode&#39;s components and the corresponding contour visible in the initial layout </span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span>
            <span class="n">visible_status_e</span><span class="p">[</span><span class="mi">6</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">visible_status_h</span><span class="p">[</span><span class="mi">6</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>


        <span class="c1"># Add contour traces for permittivity to each subplot of fig_e and fig_h for this mode</span>
        <span class="n">fig_e</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Contour</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">eps</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">contours</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">midpoint</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">midpoint</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">coloring</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">),</span> <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span> <span class="n">showscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="kc">False</span><span class="p">),</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">fig_e</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Contour</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">eps</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">contours</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">midpoint</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">midpoint</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">coloring</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">),</span> <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span> <span class="n">showscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="kc">False</span><span class="p">),</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">fig_e</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Contour</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">eps</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">contours</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">midpoint</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">midpoint</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">coloring</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">),</span> <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span> <span class="n">showscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="kc">False</span><span class="p">),</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

        <span class="n">fig_h</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Contour</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">eps</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">contours</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">midpoint</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">midpoint</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">coloring</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">),</span> <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span> <span class="n">showscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="kc">False</span><span class="p">),</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">fig_h</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Contour</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">eps</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">contours</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">midpoint</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">midpoint</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">coloring</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">),</span> <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span> <span class="n">showscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="kc">False</span><span class="p">),</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">fig_h</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Contour</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">eps</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">contours</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">midpoint</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">midpoint</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">coloring</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">),</span> <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span> <span class="n">showscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="kc">False</span><span class="p">),</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

        <span class="c1"># Add Ex, Ey, Ez with shared colorbar limits for the E field of this mode</span>
        <span class="n">fig_e</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Heatmap</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">Ex</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscale</span><span class="p">,</span> <span class="n">showscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">zmin</span><span class="o">=</span><span class="n">e_min</span><span class="p">,</span> <span class="n">zmax</span><span class="o">=</span><span class="n">e_max</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="kc">False</span><span class="p">,</span> <span class="n">zsmooth</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.8</span><span class="p">),</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">fig_e</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Heatmap</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">Ey</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscale</span><span class="p">,</span> <span class="n">showscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">zmin</span><span class="o">=</span><span class="n">e_min</span><span class="p">,</span> <span class="n">zmax</span><span class="o">=</span><span class="n">e_max</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="kc">False</span><span class="p">,</span> <span class="n">zsmooth</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.8</span><span class="p">),</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">fig_e</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Heatmap</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">Ez</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscale</span><span class="p">,</span> <span class="n">showscale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;E-field&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">thickness</span><span class="o">=</span><span class="mi">15</span><span class="p">),</span> <span class="n">zmin</span><span class="o">=</span><span class="n">e_min</span><span class="p">,</span> <span class="n">zmax</span><span class="o">=</span><span class="n">e_max</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="kc">False</span><span class="p">,</span> <span class="n">zsmooth</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.8</span><span class="p">),</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

        <span class="c1"># Add Hx, Hy, Hz with shared colorbar limits for the H field of this mode</span>
        <span class="n">fig_h</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Heatmap</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">Hx</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscale</span><span class="p">,</span> <span class="n">showscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">zmin</span><span class="o">=</span><span class="n">h_min</span><span class="p">,</span> <span class="n">zmax</span><span class="o">=</span><span class="n">h_max</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="kc">False</span><span class="p">,</span> <span class="n">zsmooth</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.8</span><span class="p">),</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">fig_h</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Heatmap</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">Hy</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscale</span><span class="p">,</span> <span class="n">showscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">zmin</span><span class="o">=</span><span class="n">h_min</span><span class="p">,</span> <span class="n">zmax</span><span class="o">=</span><span class="n">h_max</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="kc">False</span><span class="p">,</span> <span class="n">zsmooth</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.8</span><span class="p">),</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">fig_h</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Heatmap</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">Hz</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscale</span><span class="p">,</span> <span class="n">showscale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;H-field&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">thickness</span><span class="o">=</span><span class="mi">15</span><span class="p">),</span> <span class="n">zmin</span><span class="o">=</span><span class="n">h_min</span><span class="p">,</span> <span class="n">zmax</span><span class="o">=</span><span class="n">h_max</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="kc">False</span><span class="p">,</span> <span class="n">zsmooth</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.8</span><span class="p">),</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>



        <span class="c1"># Dropdown data for E-field</span>
        <span class="n">k_point</span> <span class="o">=</span> <span class="n">mode</span><span class="p">[</span><span class="s2">&quot;k_point&quot;</span><span class="p">]</span>
        <span class="n">freq</span> <span class="o">=</span> <span class="n">mode</span><span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">]</span>
        <span class="n">polarization</span> <span class="o">=</span> <span class="n">mode</span><span class="p">[</span><span class="s2">&quot;polarization&quot;</span><span class="p">]</span>
        <span class="n">mode_description</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Mode </span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&lt;br&gt;k = [</span><span class="si">{</span><span class="n">k_point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">0.2f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">k_point</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">0.2f</span><span class="si">}</span><span class="s2">], freq=</span><span class="si">{</span><span class="n">freq</span><span class="si">:</span><span class="s2">0.3f</span><span class="si">}</span><span class="s2">, polarization=</span><span class="si">{</span><span class="n">polarization</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">dropdown_buttons_e</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="nb">dict</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Mode </span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">method</span><span class="o">=</span><span class="s1">&#39;update&#39;</span><span class="p">,</span>
                <span class="n">args</span><span class="o">=</span><span class="p">[{</span><span class="s1">&#39;visible&#39;</span><span class="p">:</span> <span class="n">visible_status_e</span><span class="p">},</span>
                    <span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mode_description</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">quantity</span><span class="si">}</span><span class="s2"> of E-field components&quot;</span><span class="p">}]))</span>

        <span class="n">dropdown_buttons_h</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="nb">dict</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Mode </span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">method</span><span class="o">=</span><span class="s1">&#39;update&#39;</span><span class="p">,</span>
                <span class="n">args</span><span class="o">=</span><span class="p">[{</span><span class="s1">&#39;visible&#39;</span><span class="p">:</span> <span class="n">visible_status_h</span><span class="p">},</span>
                    <span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mode_description</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">quantity</span><span class="si">}</span><span class="s2"> of H-field components&quot;</span><span class="p">}]))</span>

    <span class="c1"># Layout and color settings</span>
    <span class="n">fig_e</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mode_description</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">quantity</span><span class="si">}</span><span class="s2"> of E-field components&quot;</span><span class="p">,</span>
        <span class="n">updatemenus</span><span class="o">=</span><span class="p">[</span><span class="nb">dict</span><span class="p">(</span>
            <span class="n">active</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">buttons</span><span class="o">=</span><span class="n">dropdown_buttons_e</span><span class="p">)],</span>
        <span class="n">coloraxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">colorbar</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)),</span>
        <span class="n">width</span><span class="o">=</span><span class="mi">1200</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span>
        <span class="n">xaxis_showgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">yaxis_showgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">xaxis_zeroline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">yaxis_zeroline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">hovermode</span><span class="o">=</span><span class="s2">&quot;closest&quot;</span>
    <span class="p">)</span>

    <span class="n">fig_h</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mode_description</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">quantity</span><span class="si">}</span><span class="s2"> of H-field components&quot;</span><span class="p">,</span>
        <span class="n">updatemenus</span><span class="o">=</span><span class="p">[</span><span class="nb">dict</span><span class="p">(</span>
            <span class="n">active</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">buttons</span><span class="o">=</span><span class="n">dropdown_buttons_h</span><span class="p">)],</span>
        <span class="n">coloraxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">colorbar</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)),</span>
        <span class="n">width</span><span class="o">=</span><span class="mi">1200</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span>
        <span class="n">xaxis_showgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">yaxis_showgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">xaxis_zeroline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">yaxis_zeroline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">hovermode</span><span class="o">=</span><span class="s2">&quot;closest&quot;</span>
    <span class="p">)</span>

    <span class="c1"># Final adjustments</span>
    <span class="n">fig_e</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">showticklabels</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">fig_e</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">showticklabels</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">fig_h</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">showticklabels</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">fig_h</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">showticklabels</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">fig_e</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">yaxis_scaleanchor</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">yaxis_scaleratio</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">fig_h</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">yaxis_scaleanchor</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">yaxis_scaleratio</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">fig_e</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">yaxis2_scaleanchor</span><span class="o">=</span><span class="s2">&quot;x2&quot;</span><span class="p">,</span> <span class="n">yaxis2_scaleratio</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">fig_h</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">yaxis2_scaleanchor</span><span class="o">=</span><span class="s2">&quot;x2&quot;</span><span class="p">,</span> <span class="n">yaxis2_scaleratio</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">fig_e</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">yaxis3_scaleanchor</span><span class="o">=</span><span class="s2">&quot;x3&quot;</span><span class="p">,</span> <span class="n">yaxis3_scaleratio</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">fig_h</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">yaxis3_scaleanchor</span><span class="o">=</span><span class="s2">&quot;x3&quot;</span><span class="p">,</span> <span class="n">yaxis3_scaleratio</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>


    <span class="n">fig_e</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;X-axis&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">fig_e</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;Y-axis&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">fig_e</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;X-axis&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">fig_e</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;Y-axis&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">fig_e</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;X-axis&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">fig_e</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;Y-axis&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

    <span class="n">fig_h</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;X-axis&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">fig_h</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;Y-axis&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">fig_h</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;X-axis&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">fig_h</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;Y-axis&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">fig_h</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;X-axis&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">fig_h</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;Y-axis&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fig_e</span><span class="p">,</span> <span class="n">fig_h</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.photonic_crystal.CrystalSlab.square_lattice" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">square_lattice</span><span class="p">(</span><span class="n">height_supercell</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Define the square lattice for the photonic crystal.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>tuple</code></td>            <td>
                  <code>tuple[<span title="meep.Lattice">Lattice</span>, list[<span title="meep.Vector3">Vector3</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tuple containing the lattice object representing the square lattice and a list of k-points for the simulation.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/photonic_crystal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1487</span>
<span class="normal">1488</span>
<span class="normal">1489</span>
<span class="normal">1490</span>
<span class="normal">1491</span>
<span class="normal">1492</span>
<span class="normal">1493</span>
<span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span>
<span class="normal">1497</span>
<span class="normal">1498</span>
<span class="normal">1499</span>
<span class="normal">1500</span>
<span class="normal">1501</span>
<span class="normal">1502</span>
<span class="normal">1503</span>
<span class="normal">1504</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">square_lattice</span><span class="p">(</span><span class="n">height_supercell</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span><span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">mp</span><span class="o">.</span><span class="n">Lattice</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Define the square lattice for the photonic crystal.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: A tuple containing the lattice object representing the square lattice and a list of k-points for the simulation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lattice</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Lattice</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">height_supercell</span><span class="p">),</span>
                      <span class="n">basis1</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                      <span class="n">basis2</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">k_points</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(),</span>               <span class="c1"># Gamma</span>
        <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mf">0.5</span><span class="p">),</span>          <span class="c1"># M</span>
        <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>       <span class="c1"># X</span>
        <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(),</span>               <span class="c1"># Gamma</span>
    <span class="p">]</span>
    <span class="k">return</span> <span class="n">lattice</span><span class="p">,</span> <span class="n">k_points</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.photonic_crystal.CrystalSlab.triangular_lattice" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">triangular_lattice</span><span class="p">(</span><span class="n">height_supercell</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Define the triangular lattice for the photonic crystal.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>tuple</code></td>            <td>
                  <code>tuple[<span title="meep.Lattice">Lattice</span>, list[<span title="meep.Vector3">Vector3</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tuple containing the lattice object representing the triangular lattice and a list of k-points for the simulation.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/photonic_crystal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1506</span>
<span class="normal">1507</span>
<span class="normal">1508</span>
<span class="normal">1509</span>
<span class="normal">1510</span>
<span class="normal">1511</span>
<span class="normal">1512</span>
<span class="normal">1513</span>
<span class="normal">1514</span>
<span class="normal">1515</span>
<span class="normal">1516</span>
<span class="normal">1517</span>
<span class="normal">1518</span>
<span class="normal">1519</span>
<span class="normal">1520</span>
<span class="normal">1521</span>
<span class="normal">1522</span>
<span class="normal">1523</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">triangular_lattice</span><span class="p">(</span><span class="n">height_supercell</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span><span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">mp</span><span class="o">.</span><span class="n">Lattice</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Define the triangular lattice for the photonic crystal.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: A tuple containing the lattice object representing the triangular lattice and a list of k-points for the simulation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lattice</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Lattice</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">height_supercell</span><span class="p">),</span>
                      <span class="n">basis1</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                      <span class="n">basis2</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">k_points</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(),</span>               <span class="c1"># Gamma</span>
        <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mf">0.5</span><span class="p">),</span>          <span class="c1"># K</span>
        <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="o">-</span><span class="mf">1.</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span> <span class="mf">1.</span><span class="o">/</span><span class="mi">3</span><span class="p">),</span>    <span class="c1"># M</span>
        <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(),</span>               <span class="c1"># Gamma</span>
    <span class="p">]</span>
    <span class="k">return</span> <span class="n">lattice</span><span class="p">,</span> <span class="n">k_points</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="src.photonic_crystal.PhotonicCrystal" class="doc doc-heading">
            <code>PhotonicCrystal</code>


</h2>


    <div class="doc doc-contents ">


        <p>A class to represent a photonic crystal and perform simulations using MPB (MIT Photonic Bands).</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.photonic_crystal.PhotonicCrystal.lattice_type">lattice_type</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The type of lattice (e.g., 'square', 'triangular').</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.photonic_crystal.PhotonicCrystal.num_bands">num_bands</span></code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of bands to calculate.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.photonic_crystal.PhotonicCrystal.resolution">resolution</span></code></td>
            <td>
                  <code>tuple[int, int] | int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The resolution of the simulation.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.photonic_crystal.PhotonicCrystal.interp">interp</span></code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The interpolation factor for k-points.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.photonic_crystal.PhotonicCrystal.periods">periods</span></code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of periods for the simulation.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.photonic_crystal.PhotonicCrystal.k_points">k_points</span></code></td>
            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The list of k-points for the simulation.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.photonic_crystal.PhotonicCrystal.use_XY">use_XY</span></code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to use X and Y directions for the x-axis in plots.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.photonic_crystal.PhotonicCrystal.geometry_lattice">geometry_lattice</span></code></td>
            <td>
                  <code><span title="meep.Lattice">Lattice</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The lattice geometry.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.photonic_crystal.PhotonicCrystal.k_points_interpolated">k_points_interpolated</span></code></td>
            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The interpolated k-points.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="src.photonic_crystal.PhotonicCrystal.basic_geometry" href="#src.photonic_crystal.PhotonicCrystal.basic_geometry">basic_geometry</a></code></td>
            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The basic geometry of the photonic crystal.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.photonic_crystal.PhotonicCrystal.ms">ms</span></code></td>
            <td>
                  <code><span title="meep.mpb.ModeSolver">ModeSolver</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The mode solver for the simulation.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.photonic_crystal.PhotonicCrystal.md">md</span></code></td>
            <td>
                  <code><span title="meep.mpb.MPBData">MPBData</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The MPB data object.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.photonic_crystal.PhotonicCrystal.freqs">freqs</span></code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The calculated frequencies for different polarizations.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.photonic_crystal.PhotonicCrystal.gaps">gaps</span></code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The calculated band gaps for different polarizations.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.photonic_crystal.PhotonicCrystal.epsilon">epsilon</span></code></td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The dielectric constant distribution.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.photonic_crystal.PhotonicCrystal.modes">modes</span></code></td>
            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The list of calculated modes.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.photonic_crystal.PhotonicCrystal.has_been_run">has_been_run</span></code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the simulation has been run.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Methods:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><span title="src.photonic_crystal.PhotonicCrystal.__getstate__">__getstate__</span></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Get the state for pickling.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><span title="src.photonic_crystal.PhotonicCrystal.__setstate__">__setstate__</span></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Set the state after unpickling.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="src.photonic_crystal.PhotonicCrystal.pickle_photonic_crystal" href="#src.photonic_crystal.PhotonicCrystal.pickle_photonic_crystal">pickle_photonic_crystal</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Pickle the photonic crystal object.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="src.photonic_crystal.PhotonicCrystal.load_photonic_crystal" href="#src.photonic_crystal.PhotonicCrystal.load_photonic_crystal">load_photonic_crystal</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Load a pickled photonic crystal object.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="src.photonic_crystal.PhotonicCrystal.set_solver" href="#src.photonic_crystal.PhotonicCrystal.set_solver">set_solver</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Set the mode solver for the simulation.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="src.photonic_crystal.PhotonicCrystal.run_simulation" href="#src.photonic_crystal.PhotonicCrystal.run_simulation">run_simulation</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Run the simulation to calculate the frequencies and gaps.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="src.photonic_crystal.PhotonicCrystal.run_dumb_simulation" href="#src.photonic_crystal.PhotonicCrystal.run_dumb_simulation">run_dumb_simulation</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Run a dumb simulation to quickly extract some values.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="src.photonic_crystal.PhotonicCrystal.convert_mode_fields" href="#src.photonic_crystal.PhotonicCrystal.convert_mode_fields">convert_mode_fields</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Convert the mode fields to arrays for visualization.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="src.photonic_crystal.PhotonicCrystal.extract_data" href="#src.photonic_crystal.PhotonicCrystal.extract_data">extract_data</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Extract the data from the simulation.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="src.photonic_crystal.PhotonicCrystal.plot_epsilon" href="#src.photonic_crystal.PhotonicCrystal.plot_epsilon">plot_epsilon</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Plot the epsilon of the photonic crystal interactively using Plotly.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="src.photonic_crystal.PhotonicCrystal.plot_bands" href="#src.photonic_crystal.PhotonicCrystal.plot_bands">plot_bands</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Plot the bands of the photonic crystal using Plotly.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="src.photonic_crystal.PhotonicCrystal.get_XY_k_points_near_gamma" href="#src.photonic_crystal.PhotonicCrystal.get_XY_k_points_near_gamma">get_XY_k_points_near_gamma</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Get the relevant k-points near the gamma point for the X and Y directions.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="src.photonic_crystal.PhotonicCrystal.get_high_symmetry_points" href="#src.photonic_crystal.PhotonicCrystal.get_high_symmetry_points">get_high_symmetry_points</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Get the high symmetry points for the photonic crystal lattice.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><span title="src.photonic_crystal.PhotonicCrystal.plot_field">plot_field</span></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Plot the field visualization.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="src.photonic_crystal.PhotonicCrystal.look_for_mode" href="#src.photonic_crystal.PhotonicCrystal.look_for_mode">look_for_mode</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Look for modes within the specified criteria.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="src.photonic_crystal.PhotonicCrystal.find_modes_symmetries" href="#src.photonic_crystal.PhotonicCrystal.find_modes_symmetries">find_modes_symmetries</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Find the symmetries of the modes.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="src.photonic_crystal.PhotonicCrystal.plot_modes_vectorial_fields" href="#src.photonic_crystal.PhotonicCrystal.plot_modes_vectorial_fields">plot_modes_vectorial_fields</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Plot the vectorial fields of the modes.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="src.photonic_crystal.PhotonicCrystal.plot_mode_fields_normal_to_k" href="#src.photonic_crystal.PhotonicCrystal.plot_mode_fields_normal_to_k">plot_mode_fields_normal_to_k</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Plot the fields perpendicular to the wavevector k for the mode.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="src.photonic_crystal.PhotonicCrystal.plot_vectorial_fields" href="#src.photonic_crystal.PhotonicCrystal.plot_vectorial_fields">plot_vectorial_fields</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Plot the vectorial fields of the modes.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><span title="src.photonic_crystal.PhotonicCrystal._field_to_cones">_field_to_cones</span></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Convert a field to cones for visualization.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><span title="src.photonic_crystal.PhotonicCrystal._fields_to_cones">_fields_to_cones</span></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Convert a list of fields to cones for visualization.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><span title="src.photonic_crystal.PhotonicCrystal._calculate_field_norm_to_k">_calculate_field_norm_to_k</span></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Calculate the components of the field perpendicular to the wavevector k.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><span title="src.photonic_crystal.PhotonicCrystal._get_direction">_get_direction</span></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Determine the primary direction of the wavevector k.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><span title="src.photonic_crystal.PhotonicCrystal._calculate_effective_parameter">_calculate_effective_parameter</span></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Calculate the effective parameters of the mode.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="src.photonic_crystal.PhotonicCrystal.basic_geometry" href="#src.photonic_crystal.PhotonicCrystal.basic_geometry">basic_geometry</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Define the basic geometry of the photonic crystal.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="src.photonic_crystal.PhotonicCrystal.basic_lattice" href="#src.photonic_crystal.PhotonicCrystal.basic_lattice">basic_lattice</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Define the basic lattice of the photonic crystal.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>src/photonic_crystal.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">PhotonicCrystal</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class to represent a photonic crystal and perform simulations using MPB (MIT Photonic Bands).</span>

<span class="sd">    Attributes:</span>
<span class="sd">        lattice_type (str): The type of lattice (e.g., &#39;square&#39;, &#39;triangular&#39;).</span>
<span class="sd">        num_bands (int): The number of bands to calculate.</span>
<span class="sd">        resolution (tuple[int, int] | int): The resolution of the simulation.</span>
<span class="sd">        interp (int): The interpolation factor for k-points.</span>
<span class="sd">        periods (int): The number of periods for the simulation.</span>
<span class="sd">        k_points (list): The list of k-points for the simulation.</span>
<span class="sd">        use_XY (bool): Whether to use X and Y directions for the x-axis in plots.</span>
<span class="sd">        geometry_lattice (mp.Lattice): The lattice geometry.</span>
<span class="sd">        k_points_interpolated (list): The interpolated k-points.</span>
<span class="sd">        basic_geometry (list): The basic geometry of the photonic crystal.</span>
<span class="sd">        ms (mpb.ModeSolver): The mode solver for the simulation.</span>
<span class="sd">        md (mpb.MPBData): The MPB data object.</span>
<span class="sd">        freqs (dict): The calculated frequencies for different polarizations.</span>
<span class="sd">        gaps (dict): The calculated band gaps for different polarizations.</span>
<span class="sd">        epsilon (np.ndarray): The dielectric constant distribution.</span>
<span class="sd">        modes (list): The list of calculated modes.</span>
<span class="sd">        has_been_run (bool): Whether the simulation has been run.</span>

<span class="sd">    Methods:</span>
<span class="sd">        __getstate__(): Get the state for pickling.</span>
<span class="sd">        __setstate__(state): Set the state after unpickling.</span>
<span class="sd">        pickle_photonic_crystal(pickle_id): Pickle the photonic crystal object.</span>
<span class="sd">        load_photonic_crystal(pickle_id): Load a pickled photonic crystal object.</span>
<span class="sd">        set_solver(k_point): Set the mode solver for the simulation.</span>
<span class="sd">        run_simulation(runner, polarization): Run the simulation to calculate the frequencies and gaps.</span>
<span class="sd">        run_dumb_simulation(): Run a dumb simulation to quickly extract some values.</span>
<span class="sd">        convert_mode_fields(mode, periods): Convert the mode fields to arrays for visualization.</span>
<span class="sd">        extract_data(periods): Extract the data from the simulation.</span>
<span class="sd">        plot_epsilon(fig, title): Plot the epsilon of the photonic crystal interactively using Plotly.</span>
<span class="sd">        plot_bands(polarization, title, fig, color): Plot the bands of the photonic crystal using Plotly.</span>
<span class="sd">        get_XY_k_points_near_gamma(distance): Get the relevant k-points near the gamma point for the X and Y directions.</span>
<span class="sd">        get_high_symmetry_points(): Get the high symmetry points for the photonic crystal lattice.</span>
<span class="sd">        plot_field(runner, k_point, frequency, periods, resolution, fig, title, colorscale): Plot the field visualization.</span>
<span class="sd">        look_for_mode(polarization, k_point, freq, freq_tolerance, k_point_max_distance): Look for modes within the specified criteria.</span>
<span class="sd">        find_modes_symmetries(): Find the symmetries of the modes.</span>
<span class="sd">        plot_modes_vectorial_fields(modes, sizemode, names): Plot the vectorial fields of the modes.</span>
<span class="sd">        plot_mode_fields_normal_to_k(mode, k): Plot the fields perpendicular to the wavevector k for the mode.</span>
<span class="sd">        plot_vectorial_fields(fields, colorscales, names): Plot the vectorial fields of the modes.</span>
<span class="sd">        _field_to_cones(field, colorscale, sizemode, sizeref, clim): Convert a field to cones for visualization.</span>
<span class="sd">        _fields_to_cones(fields, colorscale, sizemode, sizeref, clim, colorscales): Convert a list of fields to cones for visualization.</span>
<span class="sd">        _calculate_field_norm_to_k(fields, k): Calculate the components of the field perpendicular to the wavevector k.</span>
<span class="sd">        _get_direction(k_vector): Determine the primary direction of the wavevector k.</span>
<span class="sd">        _calculate_effective_parameter(mode): Calculate the effective parameters of the mode.</span>
<span class="sd">        basic_geometry(): Define the basic geometry of the photonic crystal.</span>
<span class="sd">        basic_lattice(): Define the basic lattice of the photonic crystal.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                <span class="n">lattice_type</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">num_bands</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span>
                <span class="n">resolution</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">32</span><span class="p">,</span>
                <span class="n">interp</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
                <span class="n">periods</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> 
                <span class="n">pickle_id</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                <span class="n">k_points</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">use_XY</span>  <span class="o">=</span> <span class="kc">True</span>
                <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes the PhotonicCrystal class with the given parameters.</span>
<span class="sd">                Args:</span>
<span class="sd">                    lattice_type (str, optional): Type of the lattice. Defaults to None.</span>
<span class="sd">                    num_bands (int, optional): Number of bands. Defaults to 6.</span>
<span class="sd">                    resolution (tuple[int, int] | int, optional): Resolution of the simulation. Defaults to 32.</span>
<span class="sd">                    interp (int, optional): Interpolation factor for k-points. Defaults to 4.</span>
<span class="sd">                    periods (int, optional): Number of periods. Defaults to 3.</span>
<span class="sd">                    pickle_id (str, optional): Identifier for pickling. Defaults to None.</span>
<span class="sd">                    k_points (list, optional): List of k-points. Defaults to None.</span>
<span class="sd">                    use_XY (bool, optional): Flag to use XY plane. Defaults to True.</span>
<span class="sd">                Attributes:</span>
<span class="sd">                    lattice_type (str): Type of the lattice.</span>
<span class="sd">                    num_bands (int): Number of bands.</span>
<span class="sd">                    resolution (tuple[int, int] | int): Resolution of the simulation.</span>
<span class="sd">                    interp (int): Interpolation factor for k-points.</span>
<span class="sd">                    periods (int): Number of periods.</span>
<span class="sd">                    pickle_id (str): Identifier for pickling.</span>
<span class="sd">                    has_been_run (bool): Flag indicating if the simulation has been run.</span>
<span class="sd">                    geometry_lattice (None): Geometry lattice, set with basic lattice method.</span>
<span class="sd">                    k_points (list): List of k-points.</span>
<span class="sd">                    k_points_interpolated (list): Interpolated k-points.</span>
<span class="sd">                    basic_geometry (None): Basic geometry, set with basic geometry method.</span>
<span class="sd">                    ms (None): Placeholder for ms attribute.</span>
<span class="sd">                    md (None): Placeholder for md attribute.</span>
<span class="sd">                    freqs (dict): Dictionary to store frequencies.</span>
<span class="sd">                    gaps (dict): Dictionary to store gaps.</span>
<span class="sd">                    epsilon (None): Placeholder for epsilon attribute.</span>
<span class="sd">                    modes (list): List to store modes.</span>
<span class="sd">                    use_XY (bool): Flag to use XY plane.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lattice_type</span> <span class="o">=</span> <span class="n">lattice_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_bands</span> <span class="o">=</span> <span class="n">num_bands</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span> <span class="o">=</span> <span class="n">resolution</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interp</span> <span class="o">=</span> <span class="n">interp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">periods</span> <span class="o">=</span> <span class="n">periods</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pickle_id</span> <span class="o">=</span> <span class="n">pickle_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">has_been_run</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1">#update this manually</span>

        <span class="c1">#this values are set with basic lattice method</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">geometry_lattice</span><span class="o">=</span> <span class="kc">None</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">k_points</span> <span class="o">=</span> <span class="n">k_points</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_points</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">k_points_interpolated</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">interp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_points</span><span class="p">)</span>

        <span class="c1">#slef.geometry_lattice, self.k_points = self.basic_lattice()</span>

        <span class="c1">#this values are set with basic geometry method</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basic_geometry</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#self.geometry = self.basic_geometry()</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">ms</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">md</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">freqs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gaps</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_XY</span> <span class="o">=</span> <span class="n">use_XY</span>

    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="c1"># Exclude the non-picklable SWIG objects</span>
        <span class="n">state</span><span class="p">[</span><span class="s1">&#39;ms&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">state</span><span class="p">[</span><span class="s1">&#39;md&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">state</span>

    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
        <span class="c1"># You may want to reinitialize &#39;ms&#39; and &#39;md&#39; if needed after loading.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ms</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">md</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">pickle_photonic_crystal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pickle_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Pickle the photonic crystal object.</span>

<span class="sd">        Args:</span>
<span class="sd">            pickle_id (str): The identifier for the pickle file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pickle_id</span><span class="si">}</span><span class="s2">.pkl&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">load_photonic_crystal</span><span class="p">(</span><span class="n">pickle_id</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;PhotonicCrystal&#39;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load a pickled photonic crystal object.</span>

<span class="sd">        Args:</span>
<span class="sd">            pickle_id (str): The identifier for the pickle file.</span>

<span class="sd">        Returns:</span>
<span class="sd">            PhotonicCrystal: The loaded photonic crystal object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pickle_id</span><span class="si">}</span><span class="s2">.pkl&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_solver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k_point</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the mode solver for the simulation. </span>
<span class="sd">        For how MPB works, it is better to call this method each time you want to run a simulation.</span>
<span class="sd">        This method initializes the mode solver (ms) with the geometry, geometry lattice, </span>
<span class="sd">        k-points, resolution, and number of bands. If a specific k-point is provided, </span>
<span class="sd">        the solver is set up for that k-point. Otherwise, it uses the interpolated k-points.</span>

<span class="sd">        Args:</span>
<span class="sd">            k_point (mp.Vector3, optional): The k-point for the simulation. Default is None.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">k_point</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ms</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">ModeSolver</span><span class="p">(</span><span class="n">geometry</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">geometry</span><span class="p">,</span>
                                  <span class="n">geometry_lattice</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">geometry_lattice</span><span class="p">,</span>
                                  <span class="n">k_points</span><span class="o">=</span><span class="p">[</span><span class="n">k_point</span><span class="p">],</span>
                                  <span class="n">resolution</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">resolution</span><span class="p">,</span>
                                  <span class="n">num_bands</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_bands</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ms</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">ModeSolver</span><span class="p">(</span><span class="n">geometry</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">geometry</span><span class="p">,</span>
                                    <span class="n">geometry_lattice</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">geometry_lattice</span><span class="p">,</span>
                                    <span class="n">k_points</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">k_points_interpolated</span><span class="p">,</span>
                                    <span class="n">resolution</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">resolution</span><span class="p">,</span>
                                    <span class="n">num_bands</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_bands</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">run_simulation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">runner</span><span class="o">=</span><span class="s2">&quot;run_zeven&quot;</span><span class="p">,</span> <span class="n">polarization</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Run the simulation to calculate the frequencies and gaps.</span>

<span class="sd">        Args:</span>
<span class="sd">            runner (str): The name of the function to run the simulation. Default is &#39;run_zeven&#39;. </span>
<span class="sd">            polarization (str, optional): The polarization of the simulation. Default is None. If None, it uses the runner name.</span>

<span class="sd">        runner must correspond to an MPB runner. For example: \n</span>
<span class="sd">        -&#39;run_zeven&#39;: Run the simulation for even parity modes in z-axis.\n</span>
<span class="sd">        -&#39;run_zodd&#39;: Run the simulation for odd parity modes in z-axis.\n</span>
<span class="sd">        -&#39;run_tm&#39;: Run the simulation for transverse magnetic modes.\n</span>
<span class="sd">        -&#39;run_te&#39;: Run the simulation for transverse electric modes.\n</span>
<span class="sd">        -&#39;run&#39;: Do not consider symmetry.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Solver is not set. Call set_solver() before running the simulation.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">polarization</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">polarization</span> <span class="o">=</span> <span class="n">polarization</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">runner</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;run_&quot;</span><span class="p">):</span>
                <span class="n">polarization</span> <span class="o">=</span> <span class="n">runner</span><span class="p">[</span><span class="mi">4</span><span class="p">:]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">polarization</span> <span class="o">=</span> <span class="n">runner</span>

        <span class="c1"># This is a custom mpb output function that stores the fields and frequencies</span>
        <span class="k">def</span> <span class="nf">get_mode_data</span><span class="p">(</span><span class="n">ms</span><span class="p">,</span> <span class="n">band</span><span class="p">):</span>
            <span class="n">mode</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;h_field&quot;</span><span class="p">:</span> <span class="n">ms</span><span class="o">.</span><span class="n">get_hfield</span><span class="p">(</span><span class="n">band</span><span class="p">,</span> <span class="n">bloch_phase</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                <span class="s2">&quot;e_field&quot;</span><span class="p">:</span> <span class="n">ms</span><span class="o">.</span><span class="n">get_efield</span><span class="p">(</span><span class="n">band</span><span class="p">,</span> <span class="n">bloch_phase</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                <span class="s2">&quot;freq&quot;</span><span class="p">:</span> <span class="n">ms</span><span class="o">.</span><span class="n">freqs</span><span class="p">[</span><span class="n">band</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                <span class="s2">&quot;k_point&quot;</span><span class="p">:</span> <span class="n">ms</span><span class="o">.</span><span class="n">current_k</span><span class="p">,</span>
                <span class="s2">&quot;polarization&quot;</span><span class="p">:</span> <span class="n">polarization</span>
            <span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k_points_interpolated</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">suppress_output</span><span class="p">():</span>
            <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="p">,</span> <span class="n">runner</span><span class="p">)(</span><span class="n">get_mode_data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">freqs</span><span class="p">[</span><span class="n">polarization</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">all_freqs</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gaps</span><span class="p">[</span><span class="n">polarization</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">gap_list</span>



    <span class="k">def</span> <span class="nf">run_dumb_simulation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">mpb</span><span class="o">.</span><span class="n">ModeSolver</span><span class="p">:</span>    
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Run a dumb simulation. </span>
<span class="sd">        This is used to quickly extract some values from the simulation later. </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1">#run the simulation in the gamma point, find one mode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ms</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">ModeSolver</span><span class="p">(</span><span class="n">geometry</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">geometry</span><span class="p">,</span>
                                  <span class="n">geometry_lattice</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">geometry_lattice</span><span class="p">,</span>
                                  <span class="n">k_points</span><span class="o">=</span><span class="p">[</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">()],</span>
                                  <span class="n">resolution</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">resolution</span><span class="p">,</span>
                                  <span class="n">num_bands</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
        <span class="n">ms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms</span>
        <span class="k">return</span> <span class="n">ms</span>

    <span class="k">def</span> <span class="nf">convert_mode_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">mpb</span><span class="o">.</span><span class="n">MPBArray</span><span class="p">,</span> <span class="n">mpb</span><span class="o">.</span><span class="n">MPBArray</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert the mode fields to arrays for visualization.</span>
<span class="sd">        Apparently this is necessary to visualize the fields if crystal is restored from pickle.</span>

<span class="sd">        Args:</span>
<span class="sd">        - mode: The mode dictionary.</span>
<span class="sd">        - periods: The number of periods to extract. Default is 1.</span>

<span class="sd">        Returns:</span>
<span class="sd">        - e_field_array: The electric field array for visualization.</span>
<span class="sd">        - h_field_array: The magnetic field array for visualization.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">with</span> <span class="n">suppress_output</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">run_dumb_simulation</span><span class="p">()</span>
            <span class="n">md</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">MPBData</span><span class="p">(</span><span class="n">rectify</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="n">periods</span><span class="p">,</span> <span class="n">lattice</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_lattice</span><span class="p">())</span>
            <span class="n">e_field_array</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">MPBArray</span><span class="p">(</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;e_field&quot;</span><span class="p">],</span> <span class="n">lattice</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_lattice</span><span class="p">(),</span> <span class="n">kpoint</span><span class="o">=</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;k_point&quot;</span><span class="p">])</span>
            <span class="n">h_field_array</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">MPBArray</span><span class="p">(</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;h_field&quot;</span><span class="p">],</span> <span class="n">lattice</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_lattice</span><span class="p">(),</span> <span class="n">kpoint</span><span class="o">=</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;k_point&quot;</span><span class="p">])</span>

            <span class="n">e_field</span> <span class="o">=</span>  <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">e_field_array</span><span class="p">)</span>
            <span class="n">h_field</span> <span class="o">=</span>  <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">h_field_array</span><span class="p">)</span>            
            <span class="k">return</span> <span class="n">e_field</span><span class="p">,</span> <span class="n">h_field</span> 



    <span class="k">def</span> <span class="nf">extract_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">periods</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="mi">5</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extract the data from the simulation.</span>

<span class="sd">        Args:</span>
<span class="sd">            periods (int, optional): The number of periods to extract. Default is 5.</span>

<span class="sd">        Returns:</span>
<span class="sd">            mpb.MPBData: The MPB data object.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Solver is not set. Call set_solver() before extracting data.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">md</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">MPBData</span><span class="p">(</span><span class="n">rectify</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="n">periods</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">resolution</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">md</span>


    <span class="k">def</span> <span class="nf">plot_epsilon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Epsilon&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the epsilon of the photonic crystal interactively using Plotly.</span>
<span class="sd">        Not implemented in the base class. Must be implemented in the derived class.</span>

<span class="sd">        Args:</span>
<span class="sd">            fig (go.Figure, optional): The Plotly figure to add the epsilon plot to. Default is None.</span>
<span class="sd">            title (str, optional): The title of the plot. Default is &#39;Epsilon&#39;.</span>

<span class="sd">        Returns:</span>
<span class="sd">            go.Figure: The Plotly figure object.(Not woroking yet, error is thrown)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="k">def</span> <span class="nf">plot_bands</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">polarization</span><span class="o">=</span><span class="s2">&quot;te&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Bands&#39;</span><span class="p">,</span> <span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span><span class="o">-&gt;</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the bands of the photonic crystal using Plotly.</span>
<span class="sd">        This method plots the bands for the specified polarization.</span>
<span class="sd">        In Dash and Jupyther Notebook, the plot is interactive and data are shown on hover.        </span>

<span class="sd">        Args:</span>
<span class="sd">            polarization (str, optional): The polarization of the bands. Default is &#39;te&#39;.</span>
<span class="sd">            title (str, optional): The title of the plot. Default is &#39;Bands&#39;.</span>
<span class="sd">            fig (go.Figure, optional): The Plotly figure to add the bands plot to. Default is None.</span>
<span class="sd">            color (str, optional): The color of the bands. Default is &#39;blue&#39;.</span>

<span class="sd">        Returns:</span>
<span class="sd">            go.Figure: The Plotly figure object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">freqs</span><span class="p">[</span><span class="n">polarization</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Simulation not run yet. Please run the simulation first.&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">freqs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">freqs</span><span class="p">[</span><span class="n">polarization</span><span class="p">]</span>
        <span class="n">gaps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gaps</span><span class="p">[</span><span class="n">polarization</span><span class="p">]</span>

        <span class="n">xs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">freqs</span><span class="p">)))</span>

        <span class="c1"># Extract the interpolated k-points as vectors and format them for hover and click</span>
        <span class="n">k_points_interpolated</span> <span class="o">=</span> <span class="p">[</span><span class="n">kp</span> <span class="k">for</span> <span class="n">kp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_points_interpolated</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">fig</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>

        <span class="c1"># Iterate through each frequency band and add them to the plot</span>
        <span class="k">for</span> <span class="n">band_index</span><span class="p">,</span> <span class="n">band</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">freqs</span><span class="p">)):</span>
            <span class="c1"># Generate hover text with the corresponding k-point and frequency</span>
            <span class="n">hover_texts</span> <span class="o">=</span> <span class="p">[</span>
                <span class="sa">f</span><span class="s2">&quot;k-point: (</span><span class="si">{</span><span class="n">kp</span><span class="o">.</span><span class="n">x</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">kp</span><span class="o">.</span><span class="n">y</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">kp</span><span class="o">.</span><span class="n">z</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">)&lt;br&gt;frequency: </span><span class="si">{</span><span class="n">f</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">for</span> <span class="n">kp</span><span class="p">,</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">k_points_interpolated</span><span class="p">,</span> <span class="n">band</span><span class="p">)</span>
            <span class="p">]</span>
            <span class="c1"># Add the line trace with hover info</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
                <span class="n">x</span><span class="o">=</span><span class="n">xs</span><span class="p">,</span> 
                <span class="n">y</span><span class="o">=</span><span class="n">band</span><span class="p">,</span> 
                <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span> 
                <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">),</span>
                <span class="n">text</span><span class="o">=</span><span class="n">hover_texts</span><span class="p">,</span>  <span class="c1"># Custom hover text</span>
                <span class="n">hoverinfo</span><span class="o">=</span><span class="s1">&#39;text&#39;</span><span class="p">,</span>  <span class="c1"># Display only the custom hover text</span>
                <span class="n">customdata</span><span class="o">=</span><span class="p">[(</span><span class="n">kp</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">kp</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">kp</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">kp</span><span class="p">,</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">k_points_interpolated</span><span class="p">,</span> <span class="n">band</span><span class="p">)],</span>  <span class="c1"># Attach k-points and frequency as custom data</span>
                <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># Hide from legend (we’ll add a separate legend entry)</span>
                <span class="n">legendgroup</span><span class="o">=</span><span class="n">polarization</span><span class="p">,</span>  <span class="c1"># Group traces by polarization for toggling visibility</span>
                <span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># Initially visible</span>
                <span class="n">selectedpoints</span><span class="o">=</span><span class="p">[],</span>  <span class="c1"># Placeholder for selected points</span>
                <span class="n">selected</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">marker</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">)),</span>  <span class="c1"># Change color and size of selected points</span>
                <span class="n">unselected</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">marker</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">opacity</span><span class="o">=</span><span class="mf">0.3</span><span class="p">))</span>  <span class="c1"># Make unselected points more transparent</span>
            <span class="p">))</span>

        <span class="c1"># Add bandgap shading (optional, grouped with the polarization for toggling visibility)</span>
        <span class="k">for</span> <span class="n">gap</span> <span class="ow">in</span> <span class="n">gaps</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">gap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">add_shape</span><span class="p">(</span>
                    <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;rect&quot;</span><span class="p">,</span>
                    <span class="n">x0</span><span class="o">=</span><span class="n">xs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> 
                    <span class="n">x1</span><span class="o">=</span><span class="n">xs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                    <span class="n">y0</span><span class="o">=</span><span class="n">gap</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> 
                    <span class="n">y1</span><span class="o">=</span><span class="n">gap</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                    <span class="n">fillcolor</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> 
                    <span class="n">opacity</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> 
                    <span class="n">line_width</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                    <span class="n">layer</span><span class="o">=</span><span class="s2">&quot;below&quot;</span><span class="p">,</span>
                    <span class="n">legendgroup</span><span class="o">=</span><span class="n">polarization</span><span class="p">,</span>  <span class="c1"># Group shading with the same polarization</span>
                    <span class="n">visible</span><span class="o">=</span><span class="kc">True</span>  <span class="c1"># Initially visible</span>
                <span class="p">)</span>

        <span class="c1"># Add a single legend entry for toggling visibility</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="kc">None</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="kc">None</span><span class="p">],</span>
            <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span>
            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">),</span>
            <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">polarization</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>  <span class="c1"># Legend entry for the polarization</span>
            <span class="n">legendgroup</span><span class="o">=</span><span class="n">polarization</span><span class="p">,</span>  <span class="c1"># Group with the same polarization traces</span>
            <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># Show the legend entry</span>
            <span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># Initially visible</span>
        <span class="p">))</span>

        <span class="c1"># Customize the x-axis </span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_XY</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>  <span class="c1"># Use X and Y directions for the x-axis</span>
            <span class="n">relevant_k_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_XY_k_points_near_gamma</span><span class="p">()</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
                <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
                <span class="n">xaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                    <span class="n">tickmode</span><span class="o">=</span><span class="s1">&#39;array&#39;</span><span class="p">,</span>
                    <span class="n">tickvals</span><span class="o">=</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">freqs</span><span class="p">)</span> <span class="o">-</span> <span class="mi">3</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)],</span>
                    <span class="n">ticktext</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">relevant_k_points</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>  <span class="c1"># Only three values, no repetition</span>
                <span class="p">),</span>
                <span class="n">yaxis_title</span><span class="o">=</span><span class="s1">&#39;frequency (c/a)&#39;</span><span class="p">,</span>
                <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">dragmode</span><span class="o">=</span><span class="s1">&#39;select&#39;</span><span class="p">,</span>  <span class="c1"># Enables rectangular selection</span>
                <span class="n">clickmode</span><span class="o">=</span><span class="s1">&#39;event+select&#39;</span><span class="p">,</span>  <span class="c1"># Enable click events and selection events</span>
                <span class="n">legend</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>  <span class="c1"># This ensures that clicking the legend will toggle visibility</span>
                    <span class="n">itemclick</span><span class="o">=</span><span class="s2">&quot;toggle&quot;</span><span class="p">,</span>  <span class="c1"># Toggle visibility when clicked</span>
                    <span class="n">itemdoubleclick</span><span class="o">=</span><span class="s2">&quot;toggleothers&quot;</span>  <span class="c1"># Double-click to hide/show other entries</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">relevant_k_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_high_symmetry_points</span><span class="p">()</span> <span class="c1"># Use high symmetry points for the x-axis </span>
                                                                <span class="c1"># Gamma, X, M for square lattice and</span>
                                                                <span class="c1"># Gamma, K, M for triangular lattice                                                   </span>
            <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
                <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
                <span class="n">xaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                    <span class="n">tickmode</span><span class="o">=</span><span class="s1">&#39;array&#39;</span><span class="p">,</span>
                    <span class="n">tickvals</span><span class="o">=</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">freqs</span><span class="p">)</span> <span class="o">-</span> <span class="mi">4</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">+</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)],</span>
                    <span class="n">ticktext</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">relevant_k_points</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">+</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">relevant_k_points</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]]</span>  <span class="c1"># Repeat the first element at the end</span>
                <span class="p">),</span>
                <span class="n">yaxis_title</span><span class="o">=</span><span class="s1">&#39;frequency (c/a)&#39;</span><span class="p">,</span>
                <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">dragmode</span><span class="o">=</span><span class="s1">&#39;select&#39;</span><span class="p">,</span>  <span class="c1"># Enables rectangular selection</span>
                <span class="n">clickmode</span><span class="o">=</span><span class="s1">&#39;event+select&#39;</span><span class="p">,</span>  <span class="c1"># Enable click events and selection events</span>
                <span class="n">legend</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>  <span class="c1"># This ensures that clicking the legend will toggle visibility</span>
                    <span class="n">itemclick</span><span class="o">=</span><span class="s2">&quot;toggle&quot;</span><span class="p">,</span>  <span class="c1"># Toggle visibility when clicked</span>
                    <span class="n">itemdoubleclick</span><span class="o">=</span><span class="s2">&quot;toggleothers&quot;</span>  <span class="c1"># Double-click to hide/show other entries</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">fig</span>


    <span class="k">def</span> <span class="nf">get_XY_k_points_near_gamma</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">distance</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the relevant k-points near the gamma point for the X and Y directions.</span>
<span class="sd">        This is useful for plotting the bands with the X and Y directions on the x-axis.</span>

<span class="sd">        Args:</span>
<span class="sd">            distance (float): The distance from the gamma point. Default is 0.1.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: A dictionary with the relevant k-points for the X and Y directions.</span>
<span class="sd">            with the k-point names as keys and the k-point vectors as values.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">distance</span> <span class="o">&gt;=</span> <span class="mf">0.5</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Distance must be less than 0.5&quot;</span><span class="p">)</span>
        <span class="n">relevant_k_points</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;X&#39;</span><span class="p">:</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="s1">&#39;Γ&#39;</span><span class="p">:</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="s1">&#39;Y&#39;</span><span class="p">:</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">relevant_k_points</span>

    <span class="k">def</span> <span class="nf">get_high_symmetry_points</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the high symmetry points for the photonic crystal lattice.</span>
<span class="sd">        This is useful for plotting the bands with the high symmetry points on the x-axis.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: A dictionary with the high symmetry points for the lattice.</span>
<span class="sd">            with the k-point names as keys and the k-point vectors as values.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">k_high_sym</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice_type</span> <span class="o">==</span> <span class="s1">&#39;square&#39;</span><span class="p">:</span>
            <span class="n">k_high_sym</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;Γ&#39;</span><span class="p">:</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="s1">&#39;X&#39;</span><span class="p">:</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="s1">&#39;M&#39;</span><span class="p">:</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice_type</span> <span class="o">==</span> <span class="s1">&#39;triangular&#39;</span><span class="p">:</span>
            <span class="n">k_high_sym</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;Γ&#39;</span><span class="p">:</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="s1">&#39;K&#39;</span><span class="p">:</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="s1">&#39;M&#39;</span><span class="p">:</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="k">return</span> <span class="n">k_high_sym</span>


    <span class="k">def</span> <span class="nf">plot_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">runner</span><span class="o">=</span><span class="s2">&quot;run_tm&quot;</span><span class="p">,</span> <span class="n">k_point</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">3</span><span class="p">),</span> <span class="n">frequency</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Field Visualization&quot;</span><span class="p">,</span> <span class="n">colorscale</span><span class="o">=</span><span class="s1">&#39;RdBu&#39;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>


    <span class="k">def</span> <span class="nf">look_for_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">polarization</span><span class="p">,</span> <span class="n">k_point</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span>  <span class="n">freq_tolerance</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">k_point_max_distance</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Look for modes within the specified criteria.</span>

<span class="sd">        Args:</span>
<span class="sd">            polarization (str): The polarization of the mode.</span>
<span class="sd">            k_point (tuple): The k-point of the mode.</span>
<span class="sd">            freq (float): The frequency of the mode.</span>
<span class="sd">            freq_tolerance (float): The tolerance for frequency similarity.</span>
<span class="sd">            k_point_max_distance (float, optional): The maximum distance for k-point similarity. Default is None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: A list of mode dictionaries that match the criteria.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">target_modes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">k_point_max_distance</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">mode</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">mode</span><span class="p">[</span><span class="s2">&quot;polarization&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">polarization</span> <span class="ow">and</span> <span class="n">mode</span><span class="p">[</span><span class="s2">&quot;k_point&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">k_point</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">freq</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">freq_tolerance</span><span class="p">:</span>
                    <span class="n">target_modes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">mode</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">mode</span><span class="p">[</span><span class="s2">&quot;polarization&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">polarization</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;k_point&quot;</span><span class="p">])</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">k_point</span><span class="p">))</span> <span class="o">&lt;=</span> <span class="n">k_point_max_distance</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">freq</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">freq_tolerance</span><span class="p">:</span>
                    <span class="n">target_modes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">target_modes</span>



    <span class="k">def</span> <span class="nf">find_modes_symmetries</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find the symmetries of the modes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;find_modes_symmetries method not implemented yet.&quot;</span><span class="p">)</span>



    <span class="k">def</span> <span class="nf">plot_modes_vectorial_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modes</span><span class="p">,</span> <span class="n">sizemode</span><span class="o">=</span><span class="s2">&quot;scaled&quot;</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Electric Field&quot;</span><span class="p">,</span> <span class="s2">&quot;Magnetic Field&quot;</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the vectorial fields of the modes.</span>
<span class="sd">        Has to be checked, Half working, not tested yet.</span>

<span class="sd">        Args:</span>
<span class="sd">        - modes: The list of modes to plot.</span>
<span class="sd">        - sizemode: The sizemode for the cones. Default is &#39;scaled&#39;.</span>
<span class="sd">        - names: The names of the fields. Default is [&#39;Electric Field&#39;, &#39;Magnetic Field&#39;].</span>

<span class="sd">        Returns:</span>
<span class="sd">        - fig_e: The Plotly figure for the electric field.</span>
<span class="sd">        - fig_h: The Plotly figure for the magnetic field.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">colorscales</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;blues&quot;</span><span class="p">,</span> <span class="s2">&quot;reds&quot;</span><span class="p">,</span> <span class="s2">&quot;greens&quot;</span><span class="p">,</span> <span class="s2">&quot;purples&quot;</span><span class="p">,</span> <span class="s2">&quot;oranges&quot;</span><span class="p">,</span> <span class="s2">&quot;ylorbr&quot;</span><span class="p">]</span>

        <span class="n">h_fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;h_field&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">mode</span> <span class="ow">in</span> <span class="n">modes</span><span class="p">]</span>
        <span class="n">e_fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;e_field&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">mode</span> <span class="ow">in</span> <span class="n">modes</span><span class="p">]</span>

        <span class="n">max_norm_h</span> <span class="o">=</span> <span class="n">PhotonicCrystal</span><span class="o">.</span><span class="n">_calculate_fields_max_norms</span><span class="p">(</span><span class="n">h_fields</span><span class="p">)</span>
        <span class="n">max_norm_e</span> <span class="o">=</span> <span class="n">PhotonicCrystal</span><span class="o">.</span><span class="n">_calculate_fields_max_norms</span><span class="p">(</span><span class="n">e_fields</span><span class="p">)</span>

        <span class="n">e_sizeref</span> <span class="o">=</span> <span class="n">max_norm_e</span>
        <span class="n">h_sizeref</span> <span class="o">=</span> <span class="n">max_norm_h</span>

        <span class="n">e_clim</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_norm_e</span><span class="p">)</span>
        <span class="n">h_clim</span><span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_norm_h</span><span class="p">)</span>


        <span class="n">e_fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
        <span class="n">h_fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>

        <span class="n">e_cones</span> <span class="o">=</span> <span class="n">PhotonicCrystal</span><span class="o">.</span><span class="n">_fields_to_cones</span><span class="p">(</span><span class="n">e_fields</span><span class="p">,</span> <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscales</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sizemode</span><span class="o">=</span><span class="n">sizemode</span><span class="p">,</span> <span class="n">sizeref</span><span class="o">=</span><span class="n">e_sizeref</span><span class="p">,</span> <span class="n">clim</span><span class="o">=</span><span class="n">e_clim</span><span class="p">,</span> <span class="n">colorscales</span><span class="o">=</span><span class="n">colorscales</span><span class="p">)</span>
        <span class="n">h_cones</span> <span class="o">=</span> <span class="n">PhotonicCrystal</span><span class="o">.</span><span class="n">_fields_to_cones</span><span class="p">(</span><span class="n">h_fields</span><span class="p">,</span> <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscales</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">sizemode</span><span class="o">=</span><span class="n">sizemode</span><span class="p">,</span> <span class="n">sizeref</span><span class="o">=</span><span class="n">h_sizeref</span><span class="p">,</span> <span class="n">clim</span><span class="o">=</span><span class="n">h_clim</span><span class="p">,</span> <span class="n">colorscales</span><span class="o">=</span><span class="n">colorscales</span><span class="p">)</span> 


        <span class="k">for</span> <span class="n">e_cone</span> <span class="ow">in</span> <span class="n">e_cones</span><span class="p">:</span>  
            <span class="n">e_fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">e_cone</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">h_cone</span> <span class="ow">in</span> <span class="n">h_cones</span><span class="p">:</span>
            <span class="n">h_fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">h_cone</span><span class="p">)</span>


        <span class="n">e_fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="n">names</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">scene</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
            <span class="n">xaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">),</span>
            <span class="n">yaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Y&#39;</span><span class="p">),</span>
            <span class="n">zaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span>
            <span class="p">),</span>
            <span class="n">margin</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="mi">40</span><span class="p">),</span>
            <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>

        <span class="n">h_fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="n">names</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">scene</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
            <span class="n">xaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">),</span>
            <span class="n">yaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Y&#39;</span><span class="p">),</span>
            <span class="n">zaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span>
            <span class="p">),</span>
            <span class="n">margin</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="mi">40</span><span class="p">),</span>
            <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">e_fig</span><span class="p">,</span> <span class="n">h_fig</span>





    <span class="k">def</span> <span class="nf">plot_mode_fields_normal_to_k</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the fields perpendicular to the wavevector k for the mode.</span>
<span class="sd">        To be tested, not sure if works correctly.</span>

<span class="sd">        Args:</span>
<span class="sd">        - mode: The mode dictionary.</span>
<span class="sd">        - k: The wavevector [kx, ky, kz].</span>

<span class="sd">        Returns:</span>
<span class="sd">        - fig_e: The Plotly figure for the electric field.</span>
<span class="sd">        - fig_h: The Plotly figure for the magnetic field.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;e_field&quot;</span><span class="p">],</span> <span class="n">mode</span><span class="p">[</span><span class="s2">&quot;h_field&quot;</span><span class="p">]]</span>
        <span class="n">fields_norm_to_k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_field_norm_to_k</span><span class="p">(</span><span class="n">fields</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
        <span class="n">fig_e</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
        <span class="n">fig_h</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>


        <span class="n">fig_e</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_field_to_cones</span><span class="p">(</span><span class="n">fields_norm_to_k</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">colorscale</span><span class="o">=</span><span class="s2">&quot;blues&quot;</span><span class="p">))</span>
        <span class="n">fig_h</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_field_to_cones</span><span class="p">(</span><span class="n">fields_norm_to_k</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">colorscale</span><span class="o">=</span><span class="s2">&quot;reds&quot;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">fig_e</span><span class="p">,</span> <span class="n">fig_h</span> 

    <span class="k">def</span> <span class="nf">plot_vectorial_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">colorscales</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Viridis&quot;</span><span class="p">,</span><span class="s2">&quot;Viridis&quot;</span><span class="p">],</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Field 1&quot;</span><span class="p">,</span> <span class="s2">&quot;Field 2&quot;</span><span class="p">]):</span> 
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the vectorial fields of the modes.</span>
<span class="sd">        Not sure if it is working properly. To be tested.</span>

<span class="sd">        Args:</span>
<span class="sd">        - fields: The list of fields to plot.</span>
<span class="sd">        - colorscales: The colorscales for the cones. Default is [&quot;Viridis&quot;, &quot;Viridis&quot;].</span>
<span class="sd">        - names: The names of the fields. Default is [&quot;Field 1&quot;, &quot;Field 2&quot;].</span>

<span class="sd">        Returns:</span>
<span class="sd">        - fig_e: The Plotly figure for the electric field.</span>
<span class="sd">        - fig_h: The Plotly figure for the magnetic field.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">fig_e</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
        <span class="n">fig_h</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
        <span class="n">fig_e</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_field_to_cones</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscales</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">fig_h</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_field_to_cones</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscales</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">fig_e</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="n">names</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">scene</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
            <span class="n">xaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Y&#39;</span><span class="p">),</span>
            <span class="n">yaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">),</span>
            <span class="n">zaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span>
            <span class="p">),</span>
            <span class="n">margin</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="mi">40</span><span class="p">),</span>
            <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>

        <span class="n">fig_h</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="n">names</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">scene</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
            <span class="n">xaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Y&#39;</span><span class="p">),</span>
            <span class="n">yaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">),</span>
            <span class="n">zaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span>
            <span class="p">),</span>
            <span class="n">margin</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="mi">40</span><span class="p">),</span>
            <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">fig_e</span><span class="p">,</span> <span class="n">fig_h</span>




    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_field_to_cones</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">colorscale</span><span class="o">=</span><span class="s2">&quot;Viridis&quot;</span><span class="p">,</span> <span class="n">sizemode</span><span class="o">=</span><span class="s1">&#39;absolute&#39;</span><span class="p">,</span> <span class="n">sizeref</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">clim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span><span class="o">-&gt;</span> <span class="n">go</span><span class="o">.</span><span class="n">Cone</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert a field to cones for visualization.</span>
<span class="sd">        Auxiliar method for plotting the fields.  </span>

<span class="sd">        Args:</span>
<span class="sd">        - field: The field to convert.</span>
<span class="sd">        - colorscale: The colorscale for the cones. Default is &#39;Viridis&#39;.</span>
<span class="sd">        - sizemode: The sizemode for the cones. Default is &#39;absolute&#39;.</span>
<span class="sd">        - sizeref: The sizeref for the cones. Default is 1.</span>
<span class="sd">        - clim: The color limits for the cones. Default is (0, 1). (Not used now)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">field_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">field</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">field_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">field</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">field_z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">field</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>

        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>


        <span class="n">cone</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Cone</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
            <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
            <span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
            <span class="n">u</span><span class="o">=</span><span class="n">field_x</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
            <span class="n">v</span><span class="o">=</span><span class="n">field_y</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
            <span class="n">w</span><span class="o">=</span><span class="n">field_z</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
            <span class="n">anchor</span><span class="o">=</span><span class="s1">&#39;tail&#39;</span><span class="p">,</span>
            <span class="n">sizemode</span><span class="o">=</span><span class="n">sizemode</span><span class="p">,</span>
            <span class="n">sizeref</span><span class="o">=</span><span class="n">sizeref</span><span class="p">,</span>
            <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscale</span><span class="p">,</span>
            <span class="c1">#cmin = clim[0],</span>
            <span class="c1">#cmax = clim[1],</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">cone</span>


    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_fields_to_cones</span><span class="p">(</span><span class="n">fields</span><span class="p">,</span> <span class="n">colorscale</span><span class="o">=</span><span class="s2">&quot;Viridis&quot;</span><span class="p">,</span> <span class="n">sizemode</span><span class="o">=</span><span class="s1">&#39;absolute&#39;</span><span class="p">,</span> <span class="n">sizeref</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">clim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">colorscales</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span><span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert a list of fields to cones for visualization.</span>
<span class="sd">        Auxiliar method for plotting the fields.</span>

<span class="sd">        Args:</span>
<span class="sd">        - fields: The list of fields to convert.</span>
<span class="sd">        - colorscale: The colorscale for the cones. Default is &#39;Viridis&#39;.</span>
<span class="sd">        - sizemode: The sizemode for the cones. Default is &#39;absolute&#39;.</span>
<span class="sd">        - sizeref: The sizeref for the cones. Default is 1.</span>
<span class="sd">        - clim: The color limits for the cones. Default is (0, 1).</span>
<span class="sd">        - colorscales: The colorscales for the cones. Default is None.</span>

<span class="sd">        Returns:</span>
<span class="sd">        - cones: The list of cones for the fields.</span>
<span class="sd">        &quot;&quot;&quot;</span>


        <span class="n">cones</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">colorscales</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">colorscales</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;blues&quot;</span><span class="p">,</span> <span class="s2">&quot;reds&quot;</span><span class="p">,</span> <span class="s2">&quot;greens&quot;</span><span class="p">,</span> <span class="s2">&quot;purples&quot;</span><span class="p">,</span> <span class="s2">&quot;oranges&quot;</span><span class="p">,</span> <span class="s2">&quot;ylorbr&quot;</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">field</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span> <span class="n">fields</span><span class="p">):</span>
            <span class="n">cone</span> <span class="o">=</span> <span class="n">PhotonicCrystal</span><span class="o">.</span><span class="n">_field_to_cones</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscales</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">sizemode</span><span class="o">=</span><span class="n">sizemode</span><span class="p">,</span> <span class="n">sizeref</span><span class="o">=</span><span class="n">sizeref</span><span class="p">,</span> <span class="n">clim</span><span class="o">=</span><span class="n">clim</span><span class="p">)</span>
            <span class="n">cones</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cone</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cones</span>


    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_calculate_field_norm_to_k</span><span class="p">(</span><span class="n">fields</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the components of the field perpendicular to the wavevector k for each field in the list.</span>

<span class="sd">        Args:</span>
<span class="sd">        - fields: A list of numpy arrays, each of shape (Nx, Ny, Nz, 3), where the last dimension contains the x, y, z components of the field.</span>
<span class="sd">        - k: A numpy array of shape (3,), representing the wavevector [kx, ky, kz].</span>

<span class="sd">        Returns:</span>
<span class="sd">        - fields_norm_to_k: A list of numpy arrays, each of shape (Nx, Ny, Nz, 3), representing the field perpendicular to k for each input field.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fields_norm_to_k</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
            <span class="c1"># Normalize the wavevector k</span>
            <span class="n">k_norm</span> <span class="o">=</span> <span class="n">k</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>

            <span class="c1"># Compute the dot product of each field vector with the normalized k</span>
            <span class="n">dot_product</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ijkl,l-&gt;ijk&#39;</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">k_norm</span><span class="p">)</span>  <span class="c1"># Efficiently computes the dot product</span>

            <span class="c1"># Compute the parallel component of the field: (dot_product * k_norm)</span>
            <span class="n">field_parallel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">dot_product</span><span class="p">,</span> <span class="n">k_norm</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

            <span class="c1"># Subtract the parallel component to get the perpendicular component</span>
            <span class="n">field_norm_to_k</span> <span class="o">=</span> <span class="n">field</span> <span class="o">-</span> <span class="n">field_parallel</span>

            <span class="n">fields_norm_to_k</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">field_norm_to_k</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fields_norm_to_k</span>





    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_direction</span><span class="p">(</span><span class="n">k_vector</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Determine the primary direction of the wavevector k.</span>

<span class="sd">        Args:</span>
<span class="sd">        - k_vector: A numpy array or list of shape (3,), representing the wavevector [kx, ky, kz].</span>

<span class="sd">        Returns:</span>
<span class="sd">        - int: 0 for x-direction, 1 for y-direction, 2 for z-direction.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">k_vector</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">k_vector</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">k_vector</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>  <span class="c1"># x-direction</span>
        <span class="k">elif</span> <span class="n">k_vector</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">k_vector</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">k_vector</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">1</span>  <span class="c1"># y-direction</span>
        <span class="k">elif</span> <span class="n">k_vector</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">k_vector</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">k_vector</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">2</span>  <span class="c1"># z-direction</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The wavevector k does not align with a primary axis.&quot;</span><span class="p">)</span>




    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_calculate_effective_parameter</span><span class="p">(</span><span class="n">mode</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the effective parameters of the mode.</span>

<span class="sd">        Args:</span>
<span class="sd">        - mode: The mode dictionary.</span>

<span class="sd">        Returns:</span>
<span class="sd">        - dict: A dictionary with the effective parameters of the mode.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;calculate_effective_parameter method not implemented yet.&quot;</span><span class="p">)</span>  



    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">basic_geometry</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Define the basic geometry of the photonic crystal.</span>
<span class="sd">        Must be implemented in the derived class.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">basic_lattice</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Define the basic lattice of the photonic crystal.</span>
<span class="sd">        Must be implemented in the derived class.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="src.photonic_crystal.PhotonicCrystal.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">lattice_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">num_bands</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">interp</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">pickle_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">k_points</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">use_XY</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Initializes the PhotonicCrystal class with the given parameters.
        Args:
            lattice_type (str, optional): Type of the lattice. Defaults to None.
            num_bands (int, optional): Number of bands. Defaults to 6.
            resolution (tuple[int, int] | int, optional): Resolution of the simulation. Defaults to 32.
            interp (int, optional): Interpolation factor for k-points. Defaults to 4.
            periods (int, optional): Number of periods. Defaults to 3.
            pickle_id (str, optional): Identifier for pickling. Defaults to None.
            k_points (list, optional): List of k-points. Defaults to None.
            use_XY (bool, optional): Flag to use XY plane. Defaults to True.
        Attributes:
            lattice_type (str): Type of the lattice.
            num_bands (int): Number of bands.
            resolution (tuple[int, int] | int): Resolution of the simulation.
            interp (int): Interpolation factor for k-points.
            periods (int): Number of periods.
            pickle_id (str): Identifier for pickling.
            has_been_run (bool): Flag indicating if the simulation has been run.
            geometry_lattice (None): Geometry lattice, set with basic lattice method.
            k_points (list): List of k-points.
            k_points_interpolated (list): Interpolated k-points.
            basic_geometry (None): Basic geometry, set with basic geometry method.
            ms (None): Placeholder for ms attribute.
            md (None): Placeholder for md attribute.
            freqs (dict): Dictionary to store frequencies.
            gaps (dict): Dictionary to store gaps.
            epsilon (None): Placeholder for epsilon attribute.
            modes (list): List to store modes.
            use_XY (bool): Flag to use XY plane.</p>

            <details class="quote">
              <summary>Source code in <code>src/photonic_crystal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">lattice_type</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">num_bands</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span>
            <span class="n">resolution</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">32</span><span class="p">,</span>
            <span class="n">interp</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
            <span class="n">periods</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> 
            <span class="n">pickle_id</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
            <span class="n">k_points</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">use_XY</span>  <span class="o">=</span> <span class="kc">True</span>
            <span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initializes the PhotonicCrystal class with the given parameters.</span>
<span class="sd">            Args:</span>
<span class="sd">                lattice_type (str, optional): Type of the lattice. Defaults to None.</span>
<span class="sd">                num_bands (int, optional): Number of bands. Defaults to 6.</span>
<span class="sd">                resolution (tuple[int, int] | int, optional): Resolution of the simulation. Defaults to 32.</span>
<span class="sd">                interp (int, optional): Interpolation factor for k-points. Defaults to 4.</span>
<span class="sd">                periods (int, optional): Number of periods. Defaults to 3.</span>
<span class="sd">                pickle_id (str, optional): Identifier for pickling. Defaults to None.</span>
<span class="sd">                k_points (list, optional): List of k-points. Defaults to None.</span>
<span class="sd">                use_XY (bool, optional): Flag to use XY plane. Defaults to True.</span>
<span class="sd">            Attributes:</span>
<span class="sd">                lattice_type (str): Type of the lattice.</span>
<span class="sd">                num_bands (int): Number of bands.</span>
<span class="sd">                resolution (tuple[int, int] | int): Resolution of the simulation.</span>
<span class="sd">                interp (int): Interpolation factor for k-points.</span>
<span class="sd">                periods (int): Number of periods.</span>
<span class="sd">                pickle_id (str): Identifier for pickling.</span>
<span class="sd">                has_been_run (bool): Flag indicating if the simulation has been run.</span>
<span class="sd">                geometry_lattice (None): Geometry lattice, set with basic lattice method.</span>
<span class="sd">                k_points (list): List of k-points.</span>
<span class="sd">                k_points_interpolated (list): Interpolated k-points.</span>
<span class="sd">                basic_geometry (None): Basic geometry, set with basic geometry method.</span>
<span class="sd">                ms (None): Placeholder for ms attribute.</span>
<span class="sd">                md (None): Placeholder for md attribute.</span>
<span class="sd">                freqs (dict): Dictionary to store frequencies.</span>
<span class="sd">                gaps (dict): Dictionary to store gaps.</span>
<span class="sd">                epsilon (None): Placeholder for epsilon attribute.</span>
<span class="sd">                modes (list): List to store modes.</span>
<span class="sd">                use_XY (bool): Flag to use XY plane.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lattice_type</span> <span class="o">=</span> <span class="n">lattice_type</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">num_bands</span> <span class="o">=</span> <span class="n">num_bands</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span> <span class="o">=</span> <span class="n">resolution</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">interp</span> <span class="o">=</span> <span class="n">interp</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">periods</span> <span class="o">=</span> <span class="n">periods</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pickle_id</span> <span class="o">=</span> <span class="n">pickle_id</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">has_been_run</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1">#update this manually</span>

    <span class="c1">#this values are set with basic lattice method</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">geometry_lattice</span><span class="o">=</span> <span class="kc">None</span> 
    <span class="bp">self</span><span class="o">.</span><span class="n">k_points</span> <span class="o">=</span> <span class="n">k_points</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_points</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k_points_interpolated</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">interp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_points</span><span class="p">)</span>

    <span class="c1">#slef.geometry_lattice, self.k_points = self.basic_lattice()</span>

    <span class="c1">#this values are set with basic geometry method</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">basic_geometry</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="c1">#self.geometry = self.basic_geometry()</span>


    <span class="bp">self</span><span class="o">.</span><span class="n">ms</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">md</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">freqs</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">gaps</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">use_XY</span> <span class="o">=</span> <span class="n">use_XY</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.photonic_crystal.PhotonicCrystal.basic_geometry" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">basic_geometry</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Define the basic geometry of the photonic crystal.
Must be implemented in the derived class.</p>

            <details class="quote">
              <summary>Source code in <code>src/photonic_crystal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">basic_geometry</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    Define the basic geometry of the photonic crystal.</span>
<span class="sd">    Must be implemented in the derived class.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.photonic_crystal.PhotonicCrystal.basic_lattice" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">basic_lattice</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Define the basic lattice of the photonic crystal.
Must be implemented in the derived class.</p>

            <details class="quote">
              <summary>Source code in <code>src/photonic_crystal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">basic_lattice</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Define the basic lattice of the photonic crystal.</span>
<span class="sd">    Must be implemented in the derived class.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.photonic_crystal.PhotonicCrystal.convert_mode_fields" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">convert_mode_fields</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Convert the mode fields to arrays for visualization.
Apparently this is necessary to visualize the fields if crystal is restored from pickle.</p>
<p>Args:
- mode: The mode dictionary.
- periods: The number of periods to extract. Default is 1.</p>
<p>Returns:
- e_field_array: The electric field array for visualization.
- h_field_array: The magnetic field array for visualization.</p>

            <details class="quote">
              <summary>Source code in <code>src/photonic_crystal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">convert_mode_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">mpb</span><span class="o">.</span><span class="n">MPBArray</span><span class="p">,</span> <span class="n">mpb</span><span class="o">.</span><span class="n">MPBArray</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert the mode fields to arrays for visualization.</span>
<span class="sd">    Apparently this is necessary to visualize the fields if crystal is restored from pickle.</span>

<span class="sd">    Args:</span>
<span class="sd">    - mode: The mode dictionary.</span>
<span class="sd">    - periods: The number of periods to extract. Default is 1.</span>

<span class="sd">    Returns:</span>
<span class="sd">    - e_field_array: The electric field array for visualization.</span>
<span class="sd">    - h_field_array: The magnetic field array for visualization.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">with</span> <span class="n">suppress_output</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_dumb_simulation</span><span class="p">()</span>
        <span class="n">md</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">MPBData</span><span class="p">(</span><span class="n">rectify</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="n">periods</span><span class="p">,</span> <span class="n">lattice</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_lattice</span><span class="p">())</span>
        <span class="n">e_field_array</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">MPBArray</span><span class="p">(</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;e_field&quot;</span><span class="p">],</span> <span class="n">lattice</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_lattice</span><span class="p">(),</span> <span class="n">kpoint</span><span class="o">=</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;k_point&quot;</span><span class="p">])</span>
        <span class="n">h_field_array</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">MPBArray</span><span class="p">(</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;h_field&quot;</span><span class="p">],</span> <span class="n">lattice</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_lattice</span><span class="p">(),</span> <span class="n">kpoint</span><span class="o">=</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;k_point&quot;</span><span class="p">])</span>

        <span class="n">e_field</span> <span class="o">=</span>  <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">e_field_array</span><span class="p">)</span>
        <span class="n">h_field</span> <span class="o">=</span>  <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">h_field_array</span><span class="p">)</span>            
        <span class="k">return</span> <span class="n">e_field</span><span class="p">,</span> <span class="n">h_field</span> 
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.photonic_crystal.PhotonicCrystal.extract_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">extract_data</span><span class="p">(</span><span class="n">periods</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Extract the data from the simulation.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>periods</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of periods to extract. Default is 5.</p>
              </div>
            </td>
            <td>
                  <code>5</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>mpb.MPBData: The MPB data object.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/photonic_crystal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">extract_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">periods</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="mi">5</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extract the data from the simulation.</span>

<span class="sd">    Args:</span>
<span class="sd">        periods (int, optional): The number of periods to extract. Default is 5.</span>

<span class="sd">    Returns:</span>
<span class="sd">        mpb.MPBData: The MPB data object.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Solver is not set. Call set_solver() before extracting data.&quot;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">md</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">MPBData</span><span class="p">(</span><span class="n">rectify</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="n">periods</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">resolution</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">md</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.photonic_crystal.PhotonicCrystal.find_modes_symmetries" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">find_modes_symmetries</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Find the symmetries of the modes.</p>

            <details class="quote">
              <summary>Source code in <code>src/photonic_crystal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">find_modes_symmetries</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Find the symmetries of the modes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;find_modes_symmetries method not implemented yet.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.photonic_crystal.PhotonicCrystal.get_XY_k_points_near_gamma" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_XY_k_points_near_gamma</span><span class="p">(</span><span class="n">distance</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get the relevant k-points near the gamma point for the X and Y directions.
This is useful for plotting the bands with the X and Y directions on the x-axis.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>distance</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The distance from the gamma point. Default is 0.1.</p>
              </div>
            </td>
            <td>
                  <code>0.1</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>dict</code></td>            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary with the relevant k-points for the X and Y directions.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td></td>            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>with the k-point names as keys and the k-point vectors as values.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/photonic_crystal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_XY_k_points_near_gamma</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">distance</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the relevant k-points near the gamma point for the X and Y directions.</span>
<span class="sd">    This is useful for plotting the bands with the X and Y directions on the x-axis.</span>

<span class="sd">    Args:</span>
<span class="sd">        distance (float): The distance from the gamma point. Default is 0.1.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: A dictionary with the relevant k-points for the X and Y directions.</span>
<span class="sd">        with the k-point names as keys and the k-point vectors as values.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">distance</span> <span class="o">&gt;=</span> <span class="mf">0.5</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Distance must be less than 0.5&quot;</span><span class="p">)</span>
    <span class="n">relevant_k_points</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;X&#39;</span><span class="p">:</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="s1">&#39;Γ&#39;</span><span class="p">:</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="s1">&#39;Y&#39;</span><span class="p">:</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">relevant_k_points</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.photonic_crystal.PhotonicCrystal.get_high_symmetry_points" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_high_symmetry_points</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get the high symmetry points for the photonic crystal lattice.
This is useful for plotting the bands with the high symmetry points on the x-axis.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>dict</code></td>            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary with the high symmetry points for the lattice.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td></td>            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>with the k-point names as keys and the k-point vectors as values.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/photonic_crystal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_high_symmetry_points</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the high symmetry points for the photonic crystal lattice.</span>
<span class="sd">    This is useful for plotting the bands with the high symmetry points on the x-axis.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: A dictionary with the high symmetry points for the lattice.</span>
<span class="sd">        with the k-point names as keys and the k-point vectors as values.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">k_high_sym</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice_type</span> <span class="o">==</span> <span class="s1">&#39;square&#39;</span><span class="p">:</span>
        <span class="n">k_high_sym</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;Γ&#39;</span><span class="p">:</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="s1">&#39;X&#39;</span><span class="p">:</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="s1">&#39;M&#39;</span><span class="p">:</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice_type</span> <span class="o">==</span> <span class="s1">&#39;triangular&#39;</span><span class="p">:</span>
        <span class="n">k_high_sym</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;Γ&#39;</span><span class="p">:</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="s1">&#39;K&#39;</span><span class="p">:</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="s1">&#39;M&#39;</span><span class="p">:</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="k">return</span> <span class="n">k_high_sym</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.photonic_crystal.PhotonicCrystal.load_photonic_crystal" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_photonic_crystal</span><span class="p">(</span><span class="n">pickle_id</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Load a pickled photonic crystal object.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>pickle_id</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The identifier for the pickle file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>PhotonicCrystal</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="src.photonic_crystal.PhotonicCrystal" href="#src.photonic_crystal.PhotonicCrystal">PhotonicCrystal</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The loaded photonic crystal object.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/photonic_crystal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">load_photonic_crystal</span><span class="p">(</span><span class="n">pickle_id</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;PhotonicCrystal&#39;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load a pickled photonic crystal object.</span>

<span class="sd">    Args:</span>
<span class="sd">        pickle_id (str): The identifier for the pickle file.</span>

<span class="sd">    Returns:</span>
<span class="sd">        PhotonicCrystal: The loaded photonic crystal object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pickle_id</span><span class="si">}</span><span class="s2">.pkl&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.photonic_crystal.PhotonicCrystal.look_for_mode" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">look_for_mode</span><span class="p">(</span><span class="n">polarization</span><span class="p">,</span> <span class="n">k_point</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">freq_tolerance</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">k_point_max_distance</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Look for modes within the specified criteria.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>polarization</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The polarization of the mode.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>k_point</code>
            </td>
            <td>
                  <code>tuple</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The k-point of the mode.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>freq</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The frequency of the mode.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>freq_tolerance</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The tolerance for frequency similarity.</p>
              </div>
            </td>
            <td>
                  <code>0.01</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>k_point_max_distance</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The maximum distance for k-point similarity. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>list</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of mode dictionaries that match the criteria.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/photonic_crystal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">look_for_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">polarization</span><span class="p">,</span> <span class="n">k_point</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span>  <span class="n">freq_tolerance</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">k_point_max_distance</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Look for modes within the specified criteria.</span>

<span class="sd">    Args:</span>
<span class="sd">        polarization (str): The polarization of the mode.</span>
<span class="sd">        k_point (tuple): The k-point of the mode.</span>
<span class="sd">        freq (float): The frequency of the mode.</span>
<span class="sd">        freq_tolerance (float): The tolerance for frequency similarity.</span>
<span class="sd">        k_point_max_distance (float, optional): The maximum distance for k-point similarity. Default is None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: A list of mode dictionaries that match the criteria.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">target_modes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">k_point_max_distance</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">mode</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">mode</span><span class="p">[</span><span class="s2">&quot;polarization&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">polarization</span> <span class="ow">and</span> <span class="n">mode</span><span class="p">[</span><span class="s2">&quot;k_point&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">k_point</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">freq</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">freq_tolerance</span><span class="p">:</span>
                <span class="n">target_modes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">mode</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">mode</span><span class="p">[</span><span class="s2">&quot;polarization&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">polarization</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;k_point&quot;</span><span class="p">])</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">k_point</span><span class="p">))</span> <span class="o">&lt;=</span> <span class="n">k_point_max_distance</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">freq</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">freq_tolerance</span><span class="p">:</span>
                <span class="n">target_modes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">target_modes</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.photonic_crystal.PhotonicCrystal.pickle_photonic_crystal" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pickle_photonic_crystal</span><span class="p">(</span><span class="n">pickle_id</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Pickle the photonic crystal object.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>pickle_id</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The identifier for the pickle file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/photonic_crystal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">pickle_photonic_crystal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pickle_id</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Pickle the photonic crystal object.</span>

<span class="sd">    Args:</span>
<span class="sd">        pickle_id (str): The identifier for the pickle file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pickle_id</span><span class="si">}</span><span class="s2">.pkl&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.photonic_crystal.PhotonicCrystal.plot_bands" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_bands</span><span class="p">(</span><span class="n">polarization</span><span class="o">=</span><span class="s1">&#39;te&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Bands&#39;</span><span class="p">,</span> <span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Plot the bands of the photonic crystal using Plotly.
This method plots the bands for the specified polarization.
In Dash and Jupyther Notebook, the plot is interactive and data are shown on hover.        </p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>polarization</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The polarization of the bands. Default is 'te'.</p>
              </div>
            </td>
            <td>
                  <code>&#39;te&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>title</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The title of the plot. Default is 'Bands'.</p>
              </div>
            </td>
            <td>
                  <code>&#39;Bands&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fig</code>
            </td>
            <td>
                  <code><span title="plotly.graph_objects.Figure">Figure</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The Plotly figure to add the bands plot to. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>color</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The color of the bands. Default is 'blue'.</p>
              </div>
            </td>
            <td>
                  <code>&#39;blue&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="plotly.graph_objects.Figure">Figure</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>go.Figure: The Plotly figure object.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/photonic_crystal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">plot_bands</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">polarization</span><span class="o">=</span><span class="s2">&quot;te&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Bands&#39;</span><span class="p">,</span> <span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span><span class="o">-&gt;</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the bands of the photonic crystal using Plotly.</span>
<span class="sd">    This method plots the bands for the specified polarization.</span>
<span class="sd">    In Dash and Jupyther Notebook, the plot is interactive and data are shown on hover.        </span>

<span class="sd">    Args:</span>
<span class="sd">        polarization (str, optional): The polarization of the bands. Default is &#39;te&#39;.</span>
<span class="sd">        title (str, optional): The title of the plot. Default is &#39;Bands&#39;.</span>
<span class="sd">        fig (go.Figure, optional): The Plotly figure to add the bands plot to. Default is None.</span>
<span class="sd">        color (str, optional): The color of the bands. Default is &#39;blue&#39;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        go.Figure: The Plotly figure object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">freqs</span><span class="p">[</span><span class="n">polarization</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Simulation not run yet. Please run the simulation first.&quot;</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="n">freqs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">freqs</span><span class="p">[</span><span class="n">polarization</span><span class="p">]</span>
    <span class="n">gaps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gaps</span><span class="p">[</span><span class="n">polarization</span><span class="p">]</span>

    <span class="n">xs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">freqs</span><span class="p">)))</span>

    <span class="c1"># Extract the interpolated k-points as vectors and format them for hover and click</span>
    <span class="n">k_points_interpolated</span> <span class="o">=</span> <span class="p">[</span><span class="n">kp</span> <span class="k">for</span> <span class="n">kp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_points_interpolated</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">fig</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>

    <span class="c1"># Iterate through each frequency band and add them to the plot</span>
    <span class="k">for</span> <span class="n">band_index</span><span class="p">,</span> <span class="n">band</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">freqs</span><span class="p">)):</span>
        <span class="c1"># Generate hover text with the corresponding k-point and frequency</span>
        <span class="n">hover_texts</span> <span class="o">=</span> <span class="p">[</span>
            <span class="sa">f</span><span class="s2">&quot;k-point: (</span><span class="si">{</span><span class="n">kp</span><span class="o">.</span><span class="n">x</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">kp</span><span class="o">.</span><span class="n">y</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">kp</span><span class="o">.</span><span class="n">z</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">)&lt;br&gt;frequency: </span><span class="si">{</span><span class="n">f</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">for</span> <span class="n">kp</span><span class="p">,</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">k_points_interpolated</span><span class="p">,</span> <span class="n">band</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="c1"># Add the line trace with hover info</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">xs</span><span class="p">,</span> 
            <span class="n">y</span><span class="o">=</span><span class="n">band</span><span class="p">,</span> 
            <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span> 
            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">),</span>
            <span class="n">text</span><span class="o">=</span><span class="n">hover_texts</span><span class="p">,</span>  <span class="c1"># Custom hover text</span>
            <span class="n">hoverinfo</span><span class="o">=</span><span class="s1">&#39;text&#39;</span><span class="p">,</span>  <span class="c1"># Display only the custom hover text</span>
            <span class="n">customdata</span><span class="o">=</span><span class="p">[(</span><span class="n">kp</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">kp</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">kp</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">kp</span><span class="p">,</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">k_points_interpolated</span><span class="p">,</span> <span class="n">band</span><span class="p">)],</span>  <span class="c1"># Attach k-points and frequency as custom data</span>
            <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># Hide from legend (we’ll add a separate legend entry)</span>
            <span class="n">legendgroup</span><span class="o">=</span><span class="n">polarization</span><span class="p">,</span>  <span class="c1"># Group traces by polarization for toggling visibility</span>
            <span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># Initially visible</span>
            <span class="n">selectedpoints</span><span class="o">=</span><span class="p">[],</span>  <span class="c1"># Placeholder for selected points</span>
            <span class="n">selected</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">marker</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">)),</span>  <span class="c1"># Change color and size of selected points</span>
            <span class="n">unselected</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">marker</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">opacity</span><span class="o">=</span><span class="mf">0.3</span><span class="p">))</span>  <span class="c1"># Make unselected points more transparent</span>
        <span class="p">))</span>

    <span class="c1"># Add bandgap shading (optional, grouped with the polarization for toggling visibility)</span>
    <span class="k">for</span> <span class="n">gap</span> <span class="ow">in</span> <span class="n">gaps</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">gap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">add_shape</span><span class="p">(</span>
                <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;rect&quot;</span><span class="p">,</span>
                <span class="n">x0</span><span class="o">=</span><span class="n">xs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> 
                <span class="n">x1</span><span class="o">=</span><span class="n">xs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                <span class="n">y0</span><span class="o">=</span><span class="n">gap</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> 
                <span class="n">y1</span><span class="o">=</span><span class="n">gap</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                <span class="n">fillcolor</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> 
                <span class="n">opacity</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> 
                <span class="n">line_width</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">layer</span><span class="o">=</span><span class="s2">&quot;below&quot;</span><span class="p">,</span>
                <span class="n">legendgroup</span><span class="o">=</span><span class="n">polarization</span><span class="p">,</span>  <span class="c1"># Group shading with the same polarization</span>
                <span class="n">visible</span><span class="o">=</span><span class="kc">True</span>  <span class="c1"># Initially visible</span>
            <span class="p">)</span>

    <span class="c1"># Add a single legend entry for toggling visibility</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="kc">None</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="kc">None</span><span class="p">],</span>
        <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span>
        <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">),</span>
        <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">polarization</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>  <span class="c1"># Legend entry for the polarization</span>
        <span class="n">legendgroup</span><span class="o">=</span><span class="n">polarization</span><span class="p">,</span>  <span class="c1"># Group with the same polarization traces</span>
        <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># Show the legend entry</span>
        <span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># Initially visible</span>
    <span class="p">))</span>

    <span class="c1"># Customize the x-axis </span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_XY</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>  <span class="c1"># Use X and Y directions for the x-axis</span>
        <span class="n">relevant_k_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_XY_k_points_near_gamma</span><span class="p">()</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
            <span class="n">xaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">tickmode</span><span class="o">=</span><span class="s1">&#39;array&#39;</span><span class="p">,</span>
                <span class="n">tickvals</span><span class="o">=</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">freqs</span><span class="p">)</span> <span class="o">-</span> <span class="mi">3</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)],</span>
                <span class="n">ticktext</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">relevant_k_points</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>  <span class="c1"># Only three values, no repetition</span>
            <span class="p">),</span>
            <span class="n">yaxis_title</span><span class="o">=</span><span class="s1">&#39;frequency (c/a)&#39;</span><span class="p">,</span>
            <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">dragmode</span><span class="o">=</span><span class="s1">&#39;select&#39;</span><span class="p">,</span>  <span class="c1"># Enables rectangular selection</span>
            <span class="n">clickmode</span><span class="o">=</span><span class="s1">&#39;event+select&#39;</span><span class="p">,</span>  <span class="c1"># Enable click events and selection events</span>
            <span class="n">legend</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>  <span class="c1"># This ensures that clicking the legend will toggle visibility</span>
                <span class="n">itemclick</span><span class="o">=</span><span class="s2">&quot;toggle&quot;</span><span class="p">,</span>  <span class="c1"># Toggle visibility when clicked</span>
                <span class="n">itemdoubleclick</span><span class="o">=</span><span class="s2">&quot;toggleothers&quot;</span>  <span class="c1"># Double-click to hide/show other entries</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">relevant_k_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_high_symmetry_points</span><span class="p">()</span> <span class="c1"># Use high symmetry points for the x-axis </span>
                                                            <span class="c1"># Gamma, X, M for square lattice and</span>
                                                            <span class="c1"># Gamma, K, M for triangular lattice                                                   </span>
        <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
            <span class="n">xaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">tickmode</span><span class="o">=</span><span class="s1">&#39;array&#39;</span><span class="p">,</span>
                <span class="n">tickvals</span><span class="o">=</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">freqs</span><span class="p">)</span> <span class="o">-</span> <span class="mi">4</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">+</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)],</span>
                <span class="n">ticktext</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">relevant_k_points</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">+</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">relevant_k_points</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]]</span>  <span class="c1"># Repeat the first element at the end</span>
            <span class="p">),</span>
            <span class="n">yaxis_title</span><span class="o">=</span><span class="s1">&#39;frequency (c/a)&#39;</span><span class="p">,</span>
            <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">dragmode</span><span class="o">=</span><span class="s1">&#39;select&#39;</span><span class="p">,</span>  <span class="c1"># Enables rectangular selection</span>
            <span class="n">clickmode</span><span class="o">=</span><span class="s1">&#39;event+select&#39;</span><span class="p">,</span>  <span class="c1"># Enable click events and selection events</span>
            <span class="n">legend</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>  <span class="c1"># This ensures that clicking the legend will toggle visibility</span>
                <span class="n">itemclick</span><span class="o">=</span><span class="s2">&quot;toggle&quot;</span><span class="p">,</span>  <span class="c1"># Toggle visibility when clicked</span>
                <span class="n">itemdoubleclick</span><span class="o">=</span><span class="s2">&quot;toggleothers&quot;</span>  <span class="c1"># Double-click to hide/show other entries</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">fig</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.photonic_crystal.PhotonicCrystal.plot_epsilon" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_epsilon</span><span class="p">(</span><span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Epsilon&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Plot the epsilon of the photonic crystal interactively using Plotly.
Not implemented in the base class. Must be implemented in the derived class.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>fig</code>
            </td>
            <td>
                  <code><span title="plotly.graph_objects.Figure">Figure</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The Plotly figure to add the epsilon plot to. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>title</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The title of the plot. Default is 'Epsilon'.</p>
              </div>
            </td>
            <td>
                  <code>&#39;Epsilon&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>go.Figure: The Plotly figure object.(Not woroking yet, error is thrown)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/photonic_crystal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">plot_epsilon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Epsilon&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the epsilon of the photonic crystal interactively using Plotly.</span>
<span class="sd">    Not implemented in the base class. Must be implemented in the derived class.</span>

<span class="sd">    Args:</span>
<span class="sd">        fig (go.Figure, optional): The Plotly figure to add the epsilon plot to. Default is None.</span>
<span class="sd">        title (str, optional): The title of the plot. Default is &#39;Epsilon&#39;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        go.Figure: The Plotly figure object.(Not woroking yet, error is thrown)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.photonic_crystal.PhotonicCrystal.plot_mode_fields_normal_to_k" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_mode_fields_normal_to_k</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Plot the fields perpendicular to the wavevector k for the mode.
To be tested, not sure if works correctly.</p>
<p>Args:
- mode: The mode dictionary.
- k: The wavevector [kx, ky, kz].</p>
<p>Returns:
- fig_e: The Plotly figure for the electric field.
- fig_h: The Plotly figure for the magnetic field.</p>

            <details class="quote">
              <summary>Source code in <code>src/photonic_crystal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">plot_mode_fields_normal_to_k</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the fields perpendicular to the wavevector k for the mode.</span>
<span class="sd">    To be tested, not sure if works correctly.</span>

<span class="sd">    Args:</span>
<span class="sd">    - mode: The mode dictionary.</span>
<span class="sd">    - k: The wavevector [kx, ky, kz].</span>

<span class="sd">    Returns:</span>
<span class="sd">    - fig_e: The Plotly figure for the electric field.</span>
<span class="sd">    - fig_h: The Plotly figure for the magnetic field.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;e_field&quot;</span><span class="p">],</span> <span class="n">mode</span><span class="p">[</span><span class="s2">&quot;h_field&quot;</span><span class="p">]]</span>
    <span class="n">fields_norm_to_k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_field_norm_to_k</span><span class="p">(</span><span class="n">fields</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
    <span class="n">fig_e</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
    <span class="n">fig_h</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>


    <span class="n">fig_e</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_field_to_cones</span><span class="p">(</span><span class="n">fields_norm_to_k</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">colorscale</span><span class="o">=</span><span class="s2">&quot;blues&quot;</span><span class="p">))</span>
    <span class="n">fig_h</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_field_to_cones</span><span class="p">(</span><span class="n">fields_norm_to_k</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">colorscale</span><span class="o">=</span><span class="s2">&quot;reds&quot;</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">fig_e</span><span class="p">,</span> <span class="n">fig_h</span> 
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.photonic_crystal.PhotonicCrystal.plot_modes_vectorial_fields" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_modes_vectorial_fields</span><span class="p">(</span><span class="n">modes</span><span class="p">,</span> <span class="n">sizemode</span><span class="o">=</span><span class="s1">&#39;scaled&#39;</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Electric Field&#39;</span><span class="p">,</span> <span class="s1">&#39;Magnetic Field&#39;</span><span class="p">])</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Plot the vectorial fields of the modes.
Has to be checked, Half working, not tested yet.</p>
<p>Args:
- modes: The list of modes to plot.
- sizemode: The sizemode for the cones. Default is 'scaled'.
- names: The names of the fields. Default is ['Electric Field', 'Magnetic Field'].</p>
<p>Returns:
- fig_e: The Plotly figure for the electric field.
- fig_h: The Plotly figure for the magnetic field.</p>

            <details class="quote">
              <summary>Source code in <code>src/photonic_crystal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">plot_modes_vectorial_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modes</span><span class="p">,</span> <span class="n">sizemode</span><span class="o">=</span><span class="s2">&quot;scaled&quot;</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Electric Field&quot;</span><span class="p">,</span> <span class="s2">&quot;Magnetic Field&quot;</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the vectorial fields of the modes.</span>
<span class="sd">    Has to be checked, Half working, not tested yet.</span>

<span class="sd">    Args:</span>
<span class="sd">    - modes: The list of modes to plot.</span>
<span class="sd">    - sizemode: The sizemode for the cones. Default is &#39;scaled&#39;.</span>
<span class="sd">    - names: The names of the fields. Default is [&#39;Electric Field&#39;, &#39;Magnetic Field&#39;].</span>

<span class="sd">    Returns:</span>
<span class="sd">    - fig_e: The Plotly figure for the electric field.</span>
<span class="sd">    - fig_h: The Plotly figure for the magnetic field.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">colorscales</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;blues&quot;</span><span class="p">,</span> <span class="s2">&quot;reds&quot;</span><span class="p">,</span> <span class="s2">&quot;greens&quot;</span><span class="p">,</span> <span class="s2">&quot;purples&quot;</span><span class="p">,</span> <span class="s2">&quot;oranges&quot;</span><span class="p">,</span> <span class="s2">&quot;ylorbr&quot;</span><span class="p">]</span>

    <span class="n">h_fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;h_field&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">mode</span> <span class="ow">in</span> <span class="n">modes</span><span class="p">]</span>
    <span class="n">e_fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;e_field&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">mode</span> <span class="ow">in</span> <span class="n">modes</span><span class="p">]</span>

    <span class="n">max_norm_h</span> <span class="o">=</span> <span class="n">PhotonicCrystal</span><span class="o">.</span><span class="n">_calculate_fields_max_norms</span><span class="p">(</span><span class="n">h_fields</span><span class="p">)</span>
    <span class="n">max_norm_e</span> <span class="o">=</span> <span class="n">PhotonicCrystal</span><span class="o">.</span><span class="n">_calculate_fields_max_norms</span><span class="p">(</span><span class="n">e_fields</span><span class="p">)</span>

    <span class="n">e_sizeref</span> <span class="o">=</span> <span class="n">max_norm_e</span>
    <span class="n">h_sizeref</span> <span class="o">=</span> <span class="n">max_norm_h</span>

    <span class="n">e_clim</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_norm_e</span><span class="p">)</span>
    <span class="n">h_clim</span><span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_norm_h</span><span class="p">)</span>


    <span class="n">e_fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
    <span class="n">h_fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>

    <span class="n">e_cones</span> <span class="o">=</span> <span class="n">PhotonicCrystal</span><span class="o">.</span><span class="n">_fields_to_cones</span><span class="p">(</span><span class="n">e_fields</span><span class="p">,</span> <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscales</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sizemode</span><span class="o">=</span><span class="n">sizemode</span><span class="p">,</span> <span class="n">sizeref</span><span class="o">=</span><span class="n">e_sizeref</span><span class="p">,</span> <span class="n">clim</span><span class="o">=</span><span class="n">e_clim</span><span class="p">,</span> <span class="n">colorscales</span><span class="o">=</span><span class="n">colorscales</span><span class="p">)</span>
    <span class="n">h_cones</span> <span class="o">=</span> <span class="n">PhotonicCrystal</span><span class="o">.</span><span class="n">_fields_to_cones</span><span class="p">(</span><span class="n">h_fields</span><span class="p">,</span> <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscales</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">sizemode</span><span class="o">=</span><span class="n">sizemode</span><span class="p">,</span> <span class="n">sizeref</span><span class="o">=</span><span class="n">h_sizeref</span><span class="p">,</span> <span class="n">clim</span><span class="o">=</span><span class="n">h_clim</span><span class="p">,</span> <span class="n">colorscales</span><span class="o">=</span><span class="n">colorscales</span><span class="p">)</span> 


    <span class="k">for</span> <span class="n">e_cone</span> <span class="ow">in</span> <span class="n">e_cones</span><span class="p">:</span>  
        <span class="n">e_fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">e_cone</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">h_cone</span> <span class="ow">in</span> <span class="n">h_cones</span><span class="p">:</span>
        <span class="n">h_fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">h_cone</span><span class="p">)</span>


    <span class="n">e_fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="n">names</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="n">scene</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="n">xaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">),</span>
        <span class="n">yaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Y&#39;</span><span class="p">),</span>
        <span class="n">zaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span>
        <span class="p">),</span>
        <span class="n">margin</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="mi">40</span><span class="p">),</span>
        <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>

    <span class="n">h_fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="n">names</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="n">scene</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="n">xaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">),</span>
        <span class="n">yaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Y&#39;</span><span class="p">),</span>
        <span class="n">zaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span>
        <span class="p">),</span>
        <span class="n">margin</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="mi">40</span><span class="p">),</span>
        <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">e_fig</span><span class="p">,</span> <span class="n">h_fig</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.photonic_crystal.PhotonicCrystal.plot_vectorial_fields" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_vectorial_fields</span><span class="p">(</span><span class="n">fields</span><span class="p">,</span> <span class="n">colorscales</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Viridis&#39;</span><span class="p">,</span> <span class="s1">&#39;Viridis&#39;</span><span class="p">],</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Field 1&#39;</span><span class="p">,</span> <span class="s1">&#39;Field 2&#39;</span><span class="p">])</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Plot the vectorial fields of the modes.
Not sure if it is working properly. To be tested.</p>
<p>Args:
- fields: The list of fields to plot.
- colorscales: The colorscales for the cones. Default is ["Viridis", "Viridis"].
- names: The names of the fields. Default is ["Field 1", "Field 2"].</p>
<p>Returns:
- fig_e: The Plotly figure for the electric field.
- fig_h: The Plotly figure for the magnetic field.</p>

            <details class="quote">
              <summary>Source code in <code>src/photonic_crystal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">plot_vectorial_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">colorscales</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Viridis&quot;</span><span class="p">,</span><span class="s2">&quot;Viridis&quot;</span><span class="p">],</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Field 1&quot;</span><span class="p">,</span> <span class="s2">&quot;Field 2&quot;</span><span class="p">]):</span> 
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the vectorial fields of the modes.</span>
<span class="sd">    Not sure if it is working properly. To be tested.</span>

<span class="sd">    Args:</span>
<span class="sd">    - fields: The list of fields to plot.</span>
<span class="sd">    - colorscales: The colorscales for the cones. Default is [&quot;Viridis&quot;, &quot;Viridis&quot;].</span>
<span class="sd">    - names: The names of the fields. Default is [&quot;Field 1&quot;, &quot;Field 2&quot;].</span>

<span class="sd">    Returns:</span>
<span class="sd">    - fig_e: The Plotly figure for the electric field.</span>
<span class="sd">    - fig_h: The Plotly figure for the magnetic field.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">fig_e</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
    <span class="n">fig_h</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
    <span class="n">fig_e</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_field_to_cones</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscales</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">fig_h</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_field_to_cones</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscales</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">fig_e</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="n">names</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="n">scene</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="n">xaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Y&#39;</span><span class="p">),</span>
        <span class="n">yaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">),</span>
        <span class="n">zaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span>
        <span class="p">),</span>
        <span class="n">margin</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="mi">40</span><span class="p">),</span>
        <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>

    <span class="n">fig_h</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="n">names</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="n">scene</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="n">xaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Y&#39;</span><span class="p">),</span>
        <span class="n">yaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">),</span>
        <span class="n">zaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span>
        <span class="p">),</span>
        <span class="n">margin</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="mi">40</span><span class="p">),</span>
        <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">fig_e</span><span class="p">,</span> <span class="n">fig_h</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.photonic_crystal.PhotonicCrystal.run_dumb_simulation" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">run_dumb_simulation</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Run a dumb simulation. 
This is used to quickly extract some values from the simulation later.</p>

            <details class="quote">
              <summary>Source code in <code>src/photonic_crystal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">run_dumb_simulation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">mpb</span><span class="o">.</span><span class="n">ModeSolver</span><span class="p">:</span>    
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Run a dumb simulation. </span>
<span class="sd">    This is used to quickly extract some values from the simulation later. </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">#run the simulation in the gamma point, find one mode</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ms</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">ModeSolver</span><span class="p">(</span><span class="n">geometry</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">geometry</span><span class="p">,</span>
                              <span class="n">geometry_lattice</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">geometry_lattice</span><span class="p">,</span>
                              <span class="n">k_points</span><span class="o">=</span><span class="p">[</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">()],</span>
                              <span class="n">resolution</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">resolution</span><span class="p">,</span>
                              <span class="n">num_bands</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">ms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms</span>
    <span class="k">return</span> <span class="n">ms</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.photonic_crystal.PhotonicCrystal.run_simulation" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">run_simulation</span><span class="p">(</span><span class="n">runner</span><span class="o">=</span><span class="s1">&#39;run_zeven&#39;</span><span class="p">,</span> <span class="n">polarization</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Run the simulation to calculate the frequencies and gaps.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>runner</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the function to run the simulation. Default is 'run_zeven'. </p>
              </div>
            </td>
            <td>
                  <code>&#39;run_zeven&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>polarization</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The polarization of the simulation. Default is None. If None, it uses the runner name.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>
        <p>runner must correspond to an MPB runner. For example: </p>
<p>-'run_zeven': Run the simulation for even parity modes in z-axis.</p>
<p>-'run_zodd': Run the simulation for odd parity modes in z-axis.</p>
<p>-'run_tm': Run the simulation for transverse magnetic modes.</p>
<p>-'run_te': Run the simulation for transverse electric modes.</p>
<p>-'run': Do not consider symmetry.</p>

            <details class="quote">
              <summary>Source code in <code>src/photonic_crystal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">run_simulation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">runner</span><span class="o">=</span><span class="s2">&quot;run_zeven&quot;</span><span class="p">,</span> <span class="n">polarization</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Run the simulation to calculate the frequencies and gaps.</span>

<span class="sd">    Args:</span>
<span class="sd">        runner (str): The name of the function to run the simulation. Default is &#39;run_zeven&#39;. </span>
<span class="sd">        polarization (str, optional): The polarization of the simulation. Default is None. If None, it uses the runner name.</span>

<span class="sd">    runner must correspond to an MPB runner. For example: \n</span>
<span class="sd">    -&#39;run_zeven&#39;: Run the simulation for even parity modes in z-axis.\n</span>
<span class="sd">    -&#39;run_zodd&#39;: Run the simulation for odd parity modes in z-axis.\n</span>
<span class="sd">    -&#39;run_tm&#39;: Run the simulation for transverse magnetic modes.\n</span>
<span class="sd">    -&#39;run_te&#39;: Run the simulation for transverse electric modes.\n</span>
<span class="sd">    -&#39;run&#39;: Do not consider symmetry.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Solver is not set. Call set_solver() before running the simulation.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">polarization</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">polarization</span> <span class="o">=</span> <span class="n">polarization</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">runner</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;run_&quot;</span><span class="p">):</span>
            <span class="n">polarization</span> <span class="o">=</span> <span class="n">runner</span><span class="p">[</span><span class="mi">4</span><span class="p">:]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">polarization</span> <span class="o">=</span> <span class="n">runner</span>

    <span class="c1"># This is a custom mpb output function that stores the fields and frequencies</span>
    <span class="k">def</span> <span class="nf">get_mode_data</span><span class="p">(</span><span class="n">ms</span><span class="p">,</span> <span class="n">band</span><span class="p">):</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;h_field&quot;</span><span class="p">:</span> <span class="n">ms</span><span class="o">.</span><span class="n">get_hfield</span><span class="p">(</span><span class="n">band</span><span class="p">,</span> <span class="n">bloch_phase</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
            <span class="s2">&quot;e_field&quot;</span><span class="p">:</span> <span class="n">ms</span><span class="o">.</span><span class="n">get_efield</span><span class="p">(</span><span class="n">band</span><span class="p">,</span> <span class="n">bloch_phase</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
            <span class="s2">&quot;freq&quot;</span><span class="p">:</span> <span class="n">ms</span><span class="o">.</span><span class="n">freqs</span><span class="p">[</span><span class="n">band</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
            <span class="s2">&quot;k_point&quot;</span><span class="p">:</span> <span class="n">ms</span><span class="o">.</span><span class="n">current_k</span><span class="p">,</span>
            <span class="s2">&quot;polarization&quot;</span><span class="p">:</span> <span class="n">polarization</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k_points_interpolated</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">suppress_output</span><span class="p">():</span>
        <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="p">,</span> <span class="n">runner</span><span class="p">)(</span><span class="n">get_mode_data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">freqs</span><span class="p">[</span><span class="n">polarization</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">all_freqs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gaps</span><span class="p">[</span><span class="n">polarization</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">gap_list</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="src.photonic_crystal.PhotonicCrystal.set_solver" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">set_solver</span><span class="p">(</span><span class="n">k_point</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Set the mode solver for the simulation. 
For how MPB works, it is better to call this method each time you want to run a simulation.
This method initializes the mode solver (ms) with the geometry, geometry lattice, 
k-points, resolution, and number of bands. If a specific k-point is provided, 
the solver is set up for that k-point. Otherwise, it uses the interpolated k-points.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>k_point</code>
            </td>
            <td>
                  <code><span title="meep.Vector3">Vector3</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The k-point for the simulation. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/photonic_crystal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">set_solver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k_point</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Set the mode solver for the simulation. </span>
<span class="sd">    For how MPB works, it is better to call this method each time you want to run a simulation.</span>
<span class="sd">    This method initializes the mode solver (ms) with the geometry, geometry lattice, </span>
<span class="sd">    k-points, resolution, and number of bands. If a specific k-point is provided, </span>
<span class="sd">    the solver is set up for that k-point. Otherwise, it uses the interpolated k-points.</span>

<span class="sd">    Args:</span>
<span class="sd">        k_point (mp.Vector3, optional): The k-point for the simulation. Default is None.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">k_point</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ms</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">ModeSolver</span><span class="p">(</span><span class="n">geometry</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">geometry</span><span class="p">,</span>
                              <span class="n">geometry_lattice</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">geometry_lattice</span><span class="p">,</span>
                              <span class="n">k_points</span><span class="o">=</span><span class="p">[</span><span class="n">k_point</span><span class="p">],</span>
                              <span class="n">resolution</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">resolution</span><span class="p">,</span>
                              <span class="n">num_bands</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_bands</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ms</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">ModeSolver</span><span class="p">(</span><span class="n">geometry</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">geometry</span><span class="p">,</span>
                                <span class="n">geometry_lattice</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">geometry_lattice</span><span class="p">,</span>
                                <span class="n">k_points</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">k_points_interpolated</span><span class="p">,</span>
                                <span class="n">resolution</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">resolution</span><span class="p">,</span>
                                <span class="n">num_bands</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_bands</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h2 id="src.photonic_crystal.suppress_output" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">suppress_output</span><span class="p">()</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Context manager to suppress stdout and stderr.</p>
<p>This context manager redirects the standard output (stdout) and standard error (stderr)
to os.devnull, effectively suppressing any output within its context.</p>


    <p><span class="doc-section-title">Yields:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>None</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>This context manager does not return any value.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>with suppress_output():
...     print("This will not be printed")
...     raise ValueError("This error will not be shown")</p>
</blockquote>
</blockquote>
</blockquote>
</details>
            <details class="quote">
              <summary>Source code in <code>src/photonic_crystal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@contextlib</span><span class="o">.</span><span class="n">contextmanager</span>
<span class="k">def</span> <span class="nf">suppress_output</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Context manager to suppress stdout and stderr.</span>

<span class="sd">    This context manager redirects the standard output (stdout) and standard error (stderr)</span>
<span class="sd">    to os.devnull, effectively suppressing any output within its context.</span>

<span class="sd">    Yields:</span>
<span class="sd">        None: This context manager does not return any value.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; with suppress_output():</span>
<span class="sd">        ...     print(&quot;This will not be printed&quot;)</span>
<span class="sd">        ...     raise ValueError(&quot;This error will not be shown&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">devnull</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">devnull</span><span class="p">:</span>
        <span class="n">old_stdout</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
        <span class="n">old_stderr</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">devnull</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span> <span class="o">=</span> <span class="n">devnull</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">yield</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">old_stdout</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span> <span class="o">=</span> <span class="n">old_stderr</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.83f73b43.min.js"></script>
      
    
  </body>
</html>